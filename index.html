<!DOCTYPE html>
<html lang="es" class="loading">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme-color" content="#9333ea">
  <meta name="description" content="ARGENTORES - El juego del impostor. Encuentra al impostor entre los jugadores.">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ARGENTORES">
  <meta name="browsermode" content="application">
  <title>ARGENTORES</title>
  <link rel="manifest" href="manifest.json?v=0.14.1&t=2024">
  <!-- Estilos cr√≠ticos para pantalla de carga inmediata -->
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000000;
    }
    html.loading, body.loading {
      overflow: hidden;
    }
    #root {
      margin: 0;
      padding: 0;
    }
  </style>
  <link rel="apple-touch-icon" href="icon-192.png?v=1.0" id="apple-touch-icon">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet" onerror="this.onerror=null; document.documentElement.style.setProperty('--font-russo', 'Arial, sans-serif');">
  <script>
    // Suprimir advertencias de producci√≥n de Tailwind y Babel
    const originalWarn = console.warn;
    console.warn = function(...args) {
      const message = args.join(' ');
      // Filtrar advertencias de Tailwind CDN y Babel en navegador
      if (message.includes('cdn.tailwindcss.com should not be used in production') ||
          message.includes('in-browser Babel transformer') ||
          message.includes('precompile your scripts for production')) {
        return; // No mostrar estas advertencias
      }
      originalWarn.apply(console, args);
    };
  </script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js" onload="console.log('‚úÖ React cargado')" onerror="console.error('‚ùå Failed to load React')"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" onload="console.log('‚úÖ ReactDOM cargado')" onerror="console.error('‚ùå Failed to load ReactDOM')"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" onload="console.log('‚úÖ Babel cargado')" onerror="console.error('‚ùå Failed to load Babel')"></script>
  <script src="https://cdn.tailwindcss.com" onload="console.log('‚úÖ Tailwind cargado')" onerror="console.error('‚ùå Failed to load Tailwind')"></script>
  <noscript>
    <style>
      body { display: none; }
      body::before { content: 'JavaScript est√° deshabilitado. Por favor, habil√≠talo para usar esta aplicaci√≥n.'; display: block; padding: 20px; }
    </style>
  </noscript>
  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    
    html {
      -webkit-text-size-adjust: 100%;
      -ms-text-size-adjust: 100%;
      text-size-adjust: 100%;
      height: 100%;
      height: -webkit-fill-available;
    }
    
    body {
      font-family: 'Russo One', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Arial Black', 'Impact', sans-serif;
      margin: 0;
      padding: 0;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
      min-height: 100%;
      min-height: -webkit-fill-available;
      width: 100%;
      letter-spacing: 0.5px;
      font-weight: 400;
    }
    
    /* Aplicar Russo One a todos los elementos de texto */
    h1, h2, h3, h4, h5, h6,
    button, input, textarea, select,
    p, span, div, label, a, li, td, th,
    .font-bold, .font-normal, .font-semibold {
      font-family: 'Russo One', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Arial Black', 'Impact', sans-serif;
      letter-spacing: 0.5px;
      font-weight: 400;
    }
    
    /* Fallback si Russo One no carga */
    @supports not (font-family: 'Russo One') {
      body,
      h1, h2, h3, h4, h5, h6,
      button, input, textarea, select,
      p, span, div, label, a, li, td, th,
      .font-bold, .font-normal, .font-semibold {
        font-family: 'Arial Black', 'Impact', -apple-system, BlinkMacSystemFont, sans-serif;
        font-weight: 900;
      }
    }
    
    button {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      cursor: pointer;
      touch-action: manipulation;
    }
    
    input, textarea {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
      user-select: text;
    }
    
    /* Iconos SVG inline para reemplazar lucide-react */
    .icon-users { width: 24px; height: 24px; fill: currentColor; }
    .icon-lock { width: 24px; height: 24px; fill: currentColor; }
    .icon-eye { width: 24px; height: 24px; fill: currentColor; }
    .icon-shuffle { width: 16px; height: 16px; fill: currentColor; }
    .icon-info { width: 14px; height: 14px; fill: currentColor; }
    
    /* Responsive base sizes */
    @media (max-width: 640px) {
      html {
        font-size: 14px;
      }
    }
    
    @media (min-width: 641px) and (max-width: 1024px) {
      html {
        font-size: 16px;
      }
    }
    
    @media (min-width: 1025px) {
      html {
        font-size: 16px;
      }
    }
    
    /* Asegurar que los elementos no se salgan de la pantalla */
    img, svg, video {
      max-width: 100%;
      height: auto;
    }
    
    /* Mejorar scroll en m√≥viles */
    @media (max-width: 768px) {
      body {
        -webkit-overflow-scrolling: touch;
      }
    }
    
    /* Asegurar que los contenedores no se desborden */
    #root {
      width: 100%;
      max-width: 100%;
      overflow-x: hidden;
    }
    
    /* Mejorar renderizado en Safari */
    @supports (-webkit-touch-callout: none) {
      body {
        -webkit-font-smoothing: antialiased;
      }
    }
    
    /* Prevenir zoom en inputs en iOS */
    @media screen and (max-width: 768px) {
      input[type="text"],
      input[type="number"],
      textarea,
      select {
        font-size: 16px !important;
      }
    }
    
    /* Mejorar visibilidad de botones en m√≥viles */
    @media (max-width: 640px) {
      button {
        min-height: 44px;
        min-width: 44px;
      }
    }
    
    /* Mejorar visibilidad de placeholders en m√≥viles */
    input::placeholder {
      opacity: 0.7;
      font-size: inherit;
    }
    
    @media (max-width: 640px) {
      input::placeholder {
        opacity: 0.8;
        font-weight: 500;
      }
    }
    
    /* Ocultar scrollbars pero mantener funcionalidad */
    .hide-scrollbar {
      -ms-overflow-style: none;  /* IE y Edge */
      scrollbar-width: none;  /* Firefox */
    }
    
    .hide-scrollbar::-webkit-scrollbar {
      display: none;  /* Chrome, Safari y Opera */
    }
    
    /* Asegurar que los textos largos no se salgan */
    * {
      word-wrap: break-word;
      overflow-wrap: break-word;
    }
    
    /* Fallback b√°sico si Tailwind no carga */
    .container-fallback {
      max-width: 42rem;
      margin-left: auto;
      margin-right: auto;
      padding-left: 1rem;
      padding-right: 1rem;
    }
    
    /* Mejoras espec√≠ficas para Brave */
    @media screen {
      /* Asegurar que los gradientes funcionen en Brave */
      .bg-gradient-to-r {
        background-image: linear-gradient(to right, var(--tw-gradient-stops));
      }
      
      /* Mejorar renderizado de sombras en Brave */
      .shadow-lg {
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }
    }
    
    /* Detectar y ajustar para Brave */
    @supports (-webkit-appearance: none) {
      /* Mejoras para navegadores basados en WebKit (incluye Brave) */
      body {
        -webkit-font-smoothing: antialiased;
      }
    }
    
    /* Toast Notifications */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 10000;
      display: flex;
      flex-direction: column;
      gap: 10px;
      pointer-events: none;
    }
    
    .toast {
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 16px 20px;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
      min-width: 280px;
      max-width: 400px;
      pointer-events: auto;
      animation: slideInRight 0.3s ease-out;
      display: flex;
      align-items: center;
      gap: 12px;
      border: 2px solid transparent;
    }
    
    .toast.success {
      border-color: #10b981;
      background: rgba(16, 185, 129, 0.95);
    }
    
    .toast.error {
      border-color: #ef4444;
      background: rgba(239, 68, 68, 0.95);
    }
    
    .toast.info {
      border-color: #3b82f6;
      background: rgba(59, 130, 246, 0.95);
    }
    
    .toast.warning {
      border-color: #f59e0b;
      background: rgba(245, 158, 11, 0.95);
    }
    
    .toast-icon {
      font-size: 24px;
      flex-shrink: 0;
    }
    
    .toast-content {
      flex: 1;
      font-size: 14px;
      line-height: 1.5;
    }
    
    .toast-close {
      background: none;
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
      padding: 0;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.7;
      transition: opacity 0.2s;
    }
    
    .toast-close:hover {
      opacity: 1;
    }
    
    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    @keyframes slideOutRight {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }
    
    .toast.hiding {
      animation: slideOutRight 0.3s ease-in forwards;
    }
    
    /* Animaci√≥n de volteo de carta 3D */
    .card-flip-container {
      perspective: 1000px;
      width: 100%;
      height: 100%;
    }
    
    .card-flip {
      position: relative;
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      transition: transform 0.6s;
    }
    
    .card-flip.flipped {
      transform: rotateY(180deg);
    }
    
    .card-front,
    .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
    }
    
    .card-back {
      transform: rotateY(180deg);
    }
    
    @keyframes slideUp {
      0% {
        transform: translateY(100%);
        opacity: 0;
      }
      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    .animate-slide-up {
      animation: slideUp 0.6s ease-out forwards;
    }
    
    @keyframes slideDown {
      0% {
        transform: translateY(-100%);
        opacity: 0;
      }
      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    .animate-slide-down {
      animation: slideDown 0.6s ease-out forwards;
    }
    
    /* Update Banner */
    .update-banner {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #9333ea 0%, #7c2d9a 100%);
      color: white;
      padding: 16px 24px;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(147, 51, 234, 0.4);
      z-index: 9999;
      display: flex;
      align-items: center;
      gap: 16px;
      min-width: 300px;
      max-width: 90%;
      animation: slideInUp 0.3s ease-out;
    }
    
    @keyframes slideInUp {
      from {
        transform: translate(-50%, 100%);
        opacity: 0;
      }
      to {
        transform: translate(-50%, 0);
        opacity: 1;
      }
    }
    
    .update-banner button {
      background: white;
      color: #9333ea;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s;
    }
    
    .update-banner button:hover {
      transform: scale(1.05);
    }
  </style>
  <script>
    // Verificar carga de recursos cr√≠ticos
    window.addEventListener('error', function(e) {
      if (e.target && (e.target.tagName === 'SCRIPT' || e.target.tagName === 'LINK')) {
        console.warn('Recurso no cargado:', e.target.src || e.target.href);
        // Si Tailwind no carga, aplicar estilos b√°sicos
        if (e.target.src && e.target.src.includes('tailwindcss')) {
          document.body.style.setProperty('--tailwind-loaded', 'false');
        }
      }
    }, true);
    
    // Verificar que Tailwind est√© disponible despu√©s de un tiempo
    setTimeout(function() {
      if (typeof tailwind === 'undefined') {
        console.warn('Tailwind CSS no se carg√≥, usando estilos de fallback');
        document.body.classList.add('tailwind-fallback');
      }
    }, 2000);
  </script>
</head>
<body class="loading">
  <div id="root">
    <div id="loading-screen" style="padding: 20px; text-align: center; color: white; background: #000000; min-height: 100vh; min-height: 100dvh; display: flex; align-items: center; justify-content: center; flex-direction: column; position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 99999; margin: 0; padding: 0; visibility: visible; opacity: 1;">
      <div style="position: relative; width: 200px; height: 200px; margin-bottom: 30px;">
        <img src="icon-512.png?v=1.0" alt="ARGENTORES" id="loading-logo" style="width: 100%; height: 100%; object-fit: contain; animation: pulse 2s ease-in-out infinite; display: block; z-index: 1; position: relative;" onload="console.log('Logo cargado');" onerror="console.error('Error cargando logo'); this.style.display='none';" />
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 220px; height: 220px; border: 3px solid #9333ea; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; pointer-events: none; z-index: 0;"></div>
      </div>
      <h1 style="color: #9333ea; font-size: 2rem; font-weight: bold; margin: 0; text-shadow: 0 0 20px rgba(147, 51, 234, 0.5); font-family: 'Russo One', Arial, sans-serif;">ARGENTORES</h1>
      <p style="color: #a855f7; font-size: 0.9rem; margin-top: 10px; opacity: 0.9;">Cargando...</p>
    </div>
  </div>
  
  <script>
    // EMERGENCY FAILSAFE: Ocultar pantalla de carga despu√©s de 3 segundos SIEMPRE
    setTimeout(() => {
      console.log('‚è∞ Emergency timeout: hiding loading screen');
      const loadingScreen = document.getElementById('loading-screen');
      if (loadingScreen) {
        loadingScreen.style.display = 'none';
        loadingScreen.style.visibility = 'hidden';
        loadingScreen.style.opacity = '0';
      }
      document.body.classList.remove('loading');
      document.documentElement.classList.remove('loading');
      
      // SUPER FAILSAFE: Si despu√©s de 6 segundos el root est√° vac√≠o, mostrar error
      setTimeout(() => {
        const rootEl = document.getElementById('root');
        if (rootEl && (!rootEl.innerHTML || rootEl.innerHTML.trim() === '' || rootEl.innerHTML.includes('loading-screen'))) {
          console.error('‚ö†Ô∏è App no carg√≥ correctamente, mostrando mensaje de error');
          rootEl.innerHTML = `
            <div style="padding: 20px; text-align: center; color: white; background: #1a1a1a; min-height: 100vh; display: flex; align-items: center; justify-content: center; flex-direction: column; position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 999999;">
              <h1 style="color: #9333ea; margin-bottom: 20px; font-size: 24px;">‚ö†Ô∏è Error de Carga</h1>
              <p style="margin-bottom: 10px; font-size: 16px; max-width: 500px;">La aplicaci√≥n no se pudo cargar correctamente.</p>
              <p style="margin-bottom: 20px; font-size: 14px; color: #999; max-width: 500px;">Puede ser un problema de conexi√≥n. Intenta recargar la p√°gina.</p>
              <button onclick="location.reload()" style="padding: 12px 24px; background: #9333ea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; margin-top: 10px; font-weight: bold;">
                üîÑ Recargar P√°gina
              </button>
              <p style="margin-top: 20px; font-size: 12px; color: #666;">Si el problema persiste:<br/>1. Verifica tu conexi√≥n a internet<br/>2. Desactiva bloqueadores de anuncios/scripts temporalmente</p>
            </div>
          `;
        }
      }, 3000);
    }, 3000);

    // Forzar mostrar pantalla de carga inmediatamente cuando se detecta modo standalone
    (function() {
      const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
      const isIOSStandalone = window.navigator.standalone === true;
      if (isStandalone || isIOSStandalone) {
        // Asegurar que la pantalla de carga est√© visible
        const loadingScreen = document.getElementById('loading-screen');
        if (loadingScreen) {
          loadingScreen.style.display = 'flex';
          loadingScreen.style.visibility = 'visible';
          loadingScreen.style.opacity = '1';
          loadingScreen.classList.remove('hidden');
        }
        // Asegurar que el body tenga la clase loading
        document.body.classList.add('loading');
        document.documentElement.classList.add('loading');
      }
    })();
  </script>
  
  <style>
    /* Estilos cr√≠ticos para pantalla de carga - deben cargar primero */
    html.loading, body.loading {
      overflow: hidden;
      height: 100%;
    }
    
    html, body {
      margin: 0;
      padding: 0;
      background: #000000;
    }
    
    #loading-screen {
      background: #000000 !important;
    }
    
    @keyframes spin {
      from { transform: translate(-50%, -50%) rotate(0deg); }
      to { transform: translate(-50%, -50%) rotate(360deg); }
    }
    @keyframes pulse {
      0%, 100% { 
        opacity: 1; 
        transform: scale(1); 
      }
      50% { 
        opacity: 0.8; 
        transform: scale(0.95); 
      }
    }
    #loading-logo {
      image-rendering: -webkit-optimize-contrast;
      image-rendering: crisp-edges;
    }
    
    /* Ocultar pantalla de carga cuando la app est√© lista */
    #loading-screen.hidden {
      opacity: 0;
      transition: opacity 0.3s ease-out;
      pointer-events: none;
    }
  </style>

  <script type="text/babel">
    // ============================================
    // VERSI√ìN DE ICONOS - CACHE BUSTING
    // ============================================
    // Cuando cambies los logos (icon-192.png o icon-512.png),
    // INCREMENTA este n√∫mero para forzar a los navegadores a cargar
    // la nueva versi√≥n en lugar de usar el cache antiguo.
    // Ejemplo: '1.0' -> '1.1' -> '1.2' -> '2.0', etc.
    // ============================================
    const ICON_VERSION = '1.0';
    
    const { useState, useEffect } = React;

    // Componentes de iconos simples
    const UsersIcon = ({ size = 24, className = "" }) => (
      <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
        <circle cx="9" cy="7" r="4"></circle>
        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
      </svg>
    );

    const LockIcon = ({ size = 48, className = "" }) => (
      <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
      </svg>
    );

    const EyeIcon = ({ size = 20, className = "" }) => (
      <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
        <circle cx="12" cy="12" r="3"></circle>
      </svg>
    );

    const ShuffleIcon = ({ size = 16, className = "" }) => (
      <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="16 3 21 3 21 8"></polyline>
        <line x1="4" y1="20" x2="21" y2="3"></line>
        <polyline points="21 16 21 21 16 21"></polyline>
        <line x1="15" y1="15" x2="21" y2="21"></line>
        <line x1="4" y1="4" x2="9" y2="9"></line>
      </svg>
    );

    // Icono de buf√≥n (jester) con sombrero de buf√≥n
    const JesterIcon = ({ size = 24, className = "", fill = "currentColor" }) => (
      <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
        {/* Cabeza */}
        <circle cx="12" cy="14" r="6" fill={fill} stroke="currentColor"/>
        {/* Sombrero de buf√≥n - parte superior con picos */}
        <path d="M6 8 L12 4 L18 8 L16 10 L8 10 Z" fill={fill} stroke="currentColor"/>
        {/* Campanillas en el sombrero */}
        <circle cx="9" cy="9" r="1" fill="currentColor"/>
        <circle cx="12" cy="6" r="1" fill="currentColor"/>
        <circle cx="15" cy="9" r="1" fill="currentColor"/>
        {/* Ojos */}
        <circle cx="10" cy="13" r="1" fill="currentColor"/>
        <circle cx="14" cy="13" r="1" fill="currentColor"/>
        {/* Sonrisa */}
        <path d="M9 16 Q12 18 15 16" stroke="currentColor" strokeWidth="1.5" fill="none"/>
      </svg>
    );

    const GamepadIcon = ({ size = 24, className = "" }) => (
      <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M6 12h4m-2-2v4m8-4v.01M18 12v.01M6 6h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z"></path>
        <circle cx="12" cy="12" r="1"></circle>
      </svg>
    );

    const SunIcon = ({ size = 20, className = "" }) => {
      const hasSizeClass = className && (className.includes('w-') || className.includes('h-'));
      return (
        <svg 
          className={className} 
          width={hasSizeClass ? undefined : size} 
          height={hasSizeClass ? undefined : size} 
          viewBox="0 0 24 24" 
          fill="none" 
          stroke="currentColor" 
          strokeWidth="2" 
          strokeLinecap="round" 
          strokeLinejoin="round"
        >
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
      );
    };

    const MoonIcon = ({ size = 20, className = "" }) => {
      const hasSizeClass = className && (className.includes('w-') || className.includes('h-'));
      return (
        <svg 
          className={className} 
          width={hasSizeClass ? undefined : size} 
          height={hasSizeClass ? undefined : size} 
          viewBox="0 0 24 24" 
          fill="none" 
          stroke="currentColor" 
          strokeWidth="2" 
          strokeLinecap="round" 
          strokeLinejoin="round"
        >
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
      );
    };

    // Componente Toast para notificaciones
    const Toast = ({ message, type = 'info', onClose, duration = 4000 }) => {
      useEffect(() => {
        if (duration > 0) {
          const timer = setTimeout(() => {
            onClose();
          }, duration);
          return () => clearTimeout(timer);
        }
      }, [duration, onClose]);

      const icons = {
        success: '‚úÖ',
        error: '‚ùå',
        warning: '‚ö†Ô∏è',
        info: '‚ÑπÔ∏è'
      };

      return (
        <div className={`toast ${type}`}>
          <span className="toast-icon">{icons[type] || icons.info}</span>
          <span className="toast-content">{message}</span>
          <button className="toast-close" onClick={onClose}>√ó</button>
        </div>
      );
    };

    // Hook para manejar toasts
    const useToast = () => {
      const [toasts, setToasts] = useState([]);

      const showToast = (message, type = 'info', duration = 4000) => {
        const id = Date.now() + Math.random();
        setToasts(prev => [...prev, { id, message, type, duration }]);
        return id;
      };

      const removeToast = (id) => {
        setToasts(prev => prev.filter(toast => toast.id !== id));
      };

      const ToastContainer = () => (
        <div className="toast-container">
          {toasts.map(toast => (
            <Toast
              key={toast.id}
              message={toast.message}
              type={toast.type}
              duration={toast.duration}
              onClose={() => removeToast(toast.id)}
            />
          ))}
        </div>
      );

      return { showToast, ToastContainer };
    };

    function ImpostorGame() {
      // ============================================
      // CONFIGURACI√ìN DE PISTAS
      // Cambia este valor a true para habilitar las pistas
      // ============================================
      const PISTAS_HABILITADAS = false;
      // ============================================
      // CONFIGURACI√ìN DE IMPOSTORES ADICIONALES
      // Cambia este valor a true para habilitar los impostores adicionales
      // ============================================
      const IMPOSTORES_ADICIONALES_HABILITADOS = true;
      // ============================================
      
      // CONFIGURACI√ìN DE MODO BUF√ìN Y C√ìMPLICE
      // Cambia estos valores a true para habilitar los modos
      // ============================================
      const BUFON_MODE_HABILITADO = true;
      const COMPLICE_MODE_HABILITADO = true;
      const PERDIDO_MODE_HABILITADO = true;
      // ============================================
      
      // Toast system
      const { showToast, ToastContainer } = useToast();
      
      // ============================================
      // MODO PRUEBA: TODOS IMPOSTORES SIEMPRE ACTIVO
      // Cambia este valor a false para desactivar el modo de prueba
      // ============================================
      const MODO_PRUEBA_TODOS_IMPOSTORES = false;
      // ============================================

      // Detecci√≥n mejorada de instalaci√≥n
      const checkInstalled = () => {
        // Verificar primero los m√©todos m√°s confiables (display-mode)
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
        const isIOSStandalone = window.navigator.standalone === true;
        const isInWebApp = window.matchMedia('(display-mode: fullscreen)').matches || 
                          window.matchMedia('(display-mode: minimal-ui)').matches;
        
        // Solo usar localStorage como confirmaci√≥n adicional, no como √∫nica fuente
        // Si est√° en modo standalone, definitivamente est√° instalada
        if (isStandalone || isIOSStandalone || isInWebApp) {
          return true;
        }
        
        // Si no est√° en modo standalone pero localStorage dice que estaba instalada,
        // verificar si realmente sigue instalada (puede haber sido desinstalada)
        const wasInstalled = localStorage.getItem('pwa_installed') === 'true';
        if (wasInstalled) {
          // Verificar si realmente sigue en modo standalone (puede haber cambiado)
          // Si no est√° en modo standalone, limpiar el flag
          if (!isStandalone && !isIOSStandalone && !isInWebApp) {
            localStorage.removeItem('pwa_installed');
            return false;
          }
          return true;
        }
        
        return false;
      };

      useEffect(() => {
        try {
          // Verificar si ya est√° instalada al inicio (solo una vez)
          const verifyInstalled = () => {
            try {
              const installed = checkInstalled();
              if (installed) {
                setIsInstalled(true);
                setShowInstallButton(false);
                // Solo guardar en localStorage si realmente est√° en modo standalone
                const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
                const isIOSStandalone = window.navigator.standalone === true;
                const isInWebApp = window.matchMedia('(display-mode: fullscreen)').matches || 
                                  window.matchMedia('(display-mode: minimal-ui)').matches;
                if (isStandalone || isIOSStandalone || isInWebApp) {
                  localStorage.setItem('pwa_installed', 'true');
                }
                return true;
              } else {
                // Si no est√° instalada, asegurarse de que el estado sea correcto
                setIsInstalled(false);
                return false;
              }
            } catch (error) {
              console.error('Error en verifyInstalled:', error);
              return false;
            }
          };

          // Verificar al inicio (solo una vez, sin mostrar toast)
          // Guardar el estado inicial para comparar despu√©s
          let wasInstalledInitially = false;
          try {
            wasInstalledInitially = verifyInstalled();
            // No mostrar toast al inicio, solo actualizar el estado
          } catch (error) {
            console.error('Error verificando instalaci√≥n inicial:', error);
          }

          // Verificar peri√≥dicamente SOLO si no estaba instalada inicialmente
          // Reducir frecuencia a cada 5 segundos para evitar spam
          // Solo verificar si inicialmente NO estaba instalada
          const installCheckInterval = setInterval(() => {
            try {
              // Solo verificar si inicialmente no estaba instalada
              if (!wasInstalledInitially && !isInstalled) {
                const nowInstalled = verifyInstalled();
                // Solo mostrar mensaje si cambi√≥ de no instalada a instalada
                // durante esta sesi√≥n
                if (nowInstalled) {
                  showToast('¬°Aplicaci√≥n instalada correctamente!', 'success', 5000);
                  // Marcar como instalada inicialmente para evitar m√°s mensajes
                  wasInstalledInitially = true;
                }
              }
            } catch (error) {
              console.error('Error en intervalo de verificaci√≥n:', error);
            }
          }, 5000);

          // Handler para beforeinstallprompt - evento que se dispara cuando la app es instalable
          const handleBeforeInstallPrompt = (e) => {
            try {
              console.log('‚úÖ beforeinstallprompt event recibido');
              if (e && typeof e.preventDefault === 'function') {
                e.preventDefault();
              }
              // Usar setTimeout para diferir los setState y evitar bloqueos visuales
              // Especialmente importante en m√≥viles donde puede causar pantalla blanca
              setTimeout(() => {
                try {
                  setDeferredPrompt(e);
                  setShowInstallButton(true);
                } catch (error) {
                  console.error('Error actualizando estado de instalaci√≥n:', error);
                }
              }, 0);
            } catch (error) {
              console.error('Error en handleBeforeInstallPrompt:', error);
            }
          };

          // Handler para cuando la app se instala
          const handleAppInstalled = () => {
            try {
              console.log('‚úÖ App instalada');
              // Usar setTimeout para diferir los setState y evitar bloqueos visuales
              setTimeout(() => {
                try {
                  setIsInstalled(true);
                  setShowInstallButton(false);
                  setDeferredPrompt(null);
                  // Solo guardar en localStorage si realmente est√° en modo standalone
                  const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
                  const isIOSStandalone = window.navigator.standalone === true;
                  if (isStandalone || isIOSStandalone) {
                    localStorage.setItem('pwa_installed', 'true');
                  }
                  // Mostrar mensaje solo cuando realmente se instala (evento appinstalled)
                  showToast('¬°Gracias por instalar ARGENTORES! La app funciona sin internet.', 'success', 6000);
                } catch (error) {
                  console.error('Error actualizando estado despu√©s de instalaci√≥n:', error);
                }
              }, 0);
            } catch (error) {
              console.error('Error en handleAppInstalled:', error);
            }
          };

          // Agregar listeners con protecci√≥n
          try {
            window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
            window.addEventListener('appinstalled', handleAppInstalled);
          } catch (error) {
            console.error('Error agregando listeners de instalaci√≥n:', error);
          }

          // Limpiar listeners al desmontar
          return () => {
            try {
              clearInterval(installCheckInterval);
              window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
              window.removeEventListener('appinstalled', handleAppInstalled);
            } catch (error) {
              console.error('Error limpiando listeners:', error);
            }
          };
        } catch (error) {
          console.error('Error en useEffect de instalaci√≥n:', error);
        }
      }, [isInstalled]); // Removido showToast de las dependencias para evitar re-renders innecesarios

      // Detecci√≥n de iOS y mostrar banner de instalaci√≥n
      useEffect(() => {
        const detectIOS = () => {
          // Detectar si es iOS
          const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
          
          if (!isIOS) {
            setShowIOSBanner(false);
            return;
          }
          
          // Detectar si es Safari (no Chrome u otros navegadores en iOS)
          // En iOS, Safari es el √∫nico navegador que soporta PWA
          // Detecci√≥n m√°s precisa de Safari
          const userAgent = navigator.userAgent;
          const isChrome = userAgent.includes('CriOS') || userAgent.includes('Chrome');
          const isFirefox = userAgent.includes('FxiOS');
          const isEdge = userAgent.includes('EdgiOS');
          const isSafari = !isChrome && !isFirefox && !isEdge && 
                          (userAgent.includes('Safari') || (isIOS && !window.MSStream));
          
          // Guardar si es Safari para mostrar el mensaje apropiado
          setIsIOSSafari(isSafari);
          
          // Detectar si el usuario viene de otro navegador (usando localStorage)
          // Si estaba en otro navegador y ahora est√° en Safari, mostrar mensaje especial
          const cameFromOtherBrowserFlag = localStorage.getItem('ios_other_browser_visit') === 'true';
          if (isSafari && cameFromOtherBrowserFlag) {
            // Limpiar el flag ya que ahora est√° en Safari
            localStorage.removeItem('ios_other_browser_visit');
            setCameFromOtherBrowser(true);
          } else {
            setCameFromOtherBrowser(false);
            if (!isSafari && isIOS) {
              // Marcar que visit√≥ desde otro navegador
              localStorage.setItem('ios_other_browser_visit', 'true');
            }
          }
          
          // Verificar si ya est√° instalada
          const isIOSStandalone = window.navigator.standalone === true;
          const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
          
          // Si est√° instalada, ocultar el banner inmediatamente
          if (isIOSStandalone || isStandalone || isInstalled) {
            setShowIOSBanner(false);
            return;
          }
          
          // Mostrar banner en TODOS los navegadores iOS (Safari y otros)
          // Verificar si el usuario ya cerr√≥ el banner antes (en esta sesi√≥n o permanentemente)
          const bannerDismissed = sessionStorage.getItem('ios_banner_dismissed') === 'true';
          const bannerDismissedPermanent = localStorage.getItem('ios_banner_dismissed') === 'true';
          
          if (!bannerDismissed && !bannerDismissedPermanent) {
            setShowIOSBanner(true);
          } else {
            setShowIOSBanner(false);
          }
        };

        // Verificar al cargar (con un peque√±o delay para no ser intrusivo)
        setTimeout(() => {
          detectIOS();
        }, 2000);

        // Verificar peri√≥dicamente (por si cambia el estado de instalaci√≥n)
        const checkInterval = setInterval(() => {
          detectIOS();
        }, 3000);

        return () => {
          clearInterval(checkInterval);
        };
      }, [isInstalled]);

      // Detectar si tiene la app instalada pero est√° accediendo desde la web
      useEffect(() => {
        // Verificar si tiene la app instalada (usando localStorage)
        const wasInstalled = localStorage.getItem('pwa_installed') === 'true';
        
        if (wasInstalled) {
          // Verificar si NO est√° en modo standalone (est√° en la web)
          const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
          const isIOSStandalone = window.navigator.standalone === true;
          const isInWebApp = window.matchMedia('(display-mode: fullscreen)').matches || 
                            window.matchMedia('(display-mode: minimal-ui)').matches;
          
          // Si NO est√° en modo standalone pero tiene la app instalada, mostrar modal
          if (!isStandalone && !isIOSStandalone && !isInWebApp) {
            // Verificar si el usuario ya cerr√≥ el modal en esta sesi√≥n
            const modalDismissed = sessionStorage.getItem('pwa_open_modal_dismissed') === 'true';
            if (!modalDismissed) {
              // Esperar un poco antes de mostrar el modal para no ser intrusivo
              setTimeout(() => {
                setShowPWAOpenModal(true);
              }, 3000);
            }
          }
        }
      }, []);

      // Detecci√≥n de estado online/offline
      useEffect(() => {
        const handleOnline = () => {
          setIsOnline(true);
        };

        const handleOffline = () => {
          setIsOnline(false);
        };

        // Verificar estado inicial
        setIsOnline(navigator.onLine);

        // Escuchar cambios de estado
        window.addEventListener('online', handleOnline);
        window.addEventListener('offline', handleOffline);

        return () => {
          window.removeEventListener('online', handleOnline);
          window.removeEventListener('offline', handleOffline);
        };
      }, []);

      // Funci√≥n para seleccionar el primer jugador e ir directamente a la discusi√≥n
      const selectFirstPlayerAndStartDiscussion = () => {
        // Seleccionar el primer jugador
        let eligiblePlayers = gameStarted;
        // Si la opci√≥n est√° activada, excluir a los impostores
        if (impostorNeverFirst) {
          eligiblePlayers = gameStarted.filter(p => !p.isImpostor);
        } else {
          // Si la opci√≥n est√° desactivada, 15% de probabilidad de elegir un impostor
          const impostors = gameStarted.filter(p => p.isImpostor);
          const honestPlayers = gameStarted.filter(p => !p.isImpostor);
          const chance = Math.random() * 100;
          
          if (chance < 15 && impostors.length > 0) {
            // 15% de probabilidad: elegir un impostor
            eligiblePlayers = impostors;
          } else if (honestPlayers.length > 0) {
            // 85% de probabilidad: elegir un jugador honesto
            eligiblePlayers = honestPlayers;
          }
          // Si no hay jugadores honestos (todos son impostores), usar todos
          if (eligiblePlayers.length === 0) {
            eligiblePlayers = gameStarted;
          }
        }
        
        // REGLA DE BALANCE: C√≥mplice no puede hablar primero en la primera ronda
        // Excluir al c√≥mplice de los jugadores elegibles para hablar primero
        eligiblePlayers = eligiblePlayers.filter(p => !p.isAccomplice);
        
        // Si no hay jugadores elegibles despu√©s de excluir al c√≥mplice, usar todos excepto c√≥mplice
        if (eligiblePlayers.length === 0) {
          eligiblePlayers = gameStarted.filter(p => !p.isAccomplice);
        }
        
        // Si a√∫n no hay jugadores (todos son c√≥mplices, caso extremo), usar todos
        if (eligiblePlayers.length === 0) {
          eligiblePlayers = gameStarted;
        }
        
        const randomFirst = eligiblePlayers[Math.floor(Math.random() * eligiblePlayers.length)].number;
        setFirstPlayer(randomFirst);
        setAllRolesRevealed(true);
        setShowDiscussion(true);
      };

      // Auto-navegar directamente a la discusi√≥n cuando todos los jugadores est√°n revelados
      useEffect(() => {
        if (gameStarted && Array.isArray(gameStarted) && gameStarted.length > 0 && 
            revealedPlayers.length === gameStarted.length && 
            !allRolesRevealed && 
            !currentlyRevealingPlayer &&
            !showDiscussion) {
          // Peque√±o delay para asegurar que el estado se haya actualizado
          const timer = setTimeout(() => {
            // Verificar nuevamente las condiciones antes de ejecutar
            if (revealedPlayers.length === gameStarted.length && !allRolesRevealed && !currentlyRevealingPlayer && !showDiscussion) {
              // Ir directamente a la discusi√≥n
              selectFirstPlayerAndStartDiscussion();
            }
          }, 300);
          
          return () => clearTimeout(timer);
        }
      }, [revealedPlayers, gameStarted, allRolesRevealed, currentlyRevealingPlayer, showDiscussion, impostorNeverFirst]);

      // Prevenir selecci√≥n de texto y b√∫squeda en Google
      useEffect(() => {
        const preventSelection = (e) => {
          e.preventDefault();
          return false;
        };

        const preventContextMenu = (e) => {
          e.preventDefault();
          return false;
        };

        // Prevenir selecci√≥n de texto
        document.addEventListener('selectstart', preventSelection);
        document.addEventListener('dragstart', preventSelection);
        
        // Prevenir men√∫ contextual (clic derecho y men√∫ largo en m√≥viles)
        document.addEventListener('contextmenu', preventContextMenu);
        
        // Prevenir b√∫squeda en Chrome/Android
        document.addEventListener('touchstart', (e) => {
          if (e.touches.length > 1) {
            e.preventDefault();
          }
        }, { passive: false });

        return () => {
          document.removeEventListener('selectstart', preventSelection);
          document.removeEventListener('dragstart', preventSelection);
          document.removeEventListener('contextmenu', preventContextMenu);
        };
      }, []);

      // Sistema de actualizaci√≥n del Service Worker
      useEffect(() => {
        if ('serviceWorker' in navigator) {
          let registration = null;

          const checkForUpdates = async () => {
            try {
              registration = await navigator.serviceWorker.getRegistration();
              if (registration) {
                // Escuchar actualizaciones
                registration.addEventListener('updatefound', () => {
                  const newWorker = registration.installing;
                  if (newWorker) {
                    newWorker.addEventListener('statechange', () => {
                      if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                        // Hay una nueva versi√≥n disponible
                        // NO interrumpir el uso, solo notificar
                        setUpdateAvailable(true);
                        setWaitingWorker(newWorker);
                        // Mostrar notificaci√≥n discreta que no interrumpe
                        showToast('Nueva versi√≥n disponible. Se aplicar√° la pr√≥xima vez que recargues.', 'info', 5000);
                      }
                    });
                  }
                });

                // Verificar actualizaciones peri√≥dicamente (cada hora)
                setInterval(() => {
                  registration.update();
                }, 3600000); // 1 hora

                // Verificar actualizaciones al cargar
                await registration.update();
              }
            } catch (error) {
              console.error('Error checking for updates:', error);
            }
          };

          // Verificar cuando el service worker est√° listo
          navigator.serviceWorker.ready.then(() => {
            checkForUpdates();
          });

          // Tambi√©n verificar despu√©s de un delay
          setTimeout(checkForUpdates, 5000);
        }
      }, []);

      // Sistema de racha - inicializaci√≥n basada en partidas jugadas
      useEffect(() => {
        const savedGamesPlayed = parseInt(localStorage.getItem('impostorGame_gamesPlayed') || '0');
        const savedStreak = parseInt(localStorage.getItem('impostorGame_streak') || '0');
        const savedRecoveryUsed = localStorage.getItem('impostorGame_recoveryUsed') === 'true';

        setGamesPlayed(savedGamesPlayed);
        setRecoveryUsed(savedRecoveryUsed);
        
        // La racha se activa despu√©s de 3 partidas
        // La racha es el n√∫mero de "grupos de 3 partidas" completados
        if (savedGamesPlayed >= 3) {
          const calculatedStreak = Math.floor(savedGamesPlayed / 3);
          setStreak(calculatedStreak);
        } else {
          setStreak(0);
        }
      }, []);

      // Detectar cuando se completa una partida para actualizar la racha
      useEffect(() => {
        if (showFinalReveal && winners !== null) {
          // Partida completada - incrementar contador
          const currentGames = parseInt(localStorage.getItem('impostorGame_gamesPlayed') || '0');
          const newGamesPlayed = currentGames + 1;
          
          setGamesPlayed(newGamesPlayed);
          localStorage.setItem('impostorGame_gamesPlayed', newGamesPlayed.toString());
          
          // Actualizar racha (se activa despu√©s de 3 partidas)
          const newStreak = Math.floor(newGamesPlayed / 3);
          setStreak(newStreak);
          localStorage.setItem('impostorGame_streak', newStreak.toString());
        }
      }, [showFinalReveal, winners, recoveryUsed]);

      // Contador de usuarios en vivo - usando CountAPI (gratis, funciona en GitHub Pages)
      useEffect(() => {
        // Si est√° offline, no intentar actualizar
        if (!navigator.onLine) {
          setLiveUserCount(null);
          setIsLoadingUsers(false);
          return;
        }

        const updateLiveUserCount = async () => {
          // Verificar conexi√≥n antes de intentar
          if (!navigator.onLine) {
            setLiveUserCount(null);
            setIsLoadingUsers(false);
            return;
          }

          try {
            setIsLoadingUsers(true);
            // Usar CountAPI para el contador en tiempo real
            // Primero incrementar el contador (simula un usuario activo)
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 5000);
            
            await fetch('https://api.countapi.xyz/hit/argentores-live-users', {
              method: 'GET',
              mode: 'cors',
              signal: controller.signal
            }).catch(() => {
              clearTimeout(timeoutId);
            }); // Ignorar errores silenciosamente
            clearTimeout(timeoutId);

            // Obtener el valor actual
            const controller2 = new AbortController();
            const timeoutId2 = setTimeout(() => controller2.abort(), 5000);
            
            const response = await fetch('https://api.countapi.xyz/get/argentores-live-users', {
              method: 'GET',
              mode: 'cors',
              signal: controller2.signal
            });
            clearTimeout(timeoutId2);
            
            if (response.ok) {
              const data = await response.json();
              setLiveUserCount(data.value || 0);
            } else {
              // Si falla, mostrar l√≠nea (null)
              setLiveUserCount(null);
            }
          } catch (error) {
            // Si hay error, mostrar l√≠nea (null) en lugar de n√∫meros random
            setLiveUserCount(null);
          } finally {
            setIsLoadingUsers(false);
          }
        };

        updateLiveUserCount();
        
        // Actualizar cada 30 segundos solo si est√° online
        const interval = setInterval(() => {
          if (navigator.onLine) {
            updateLiveUserCount();
          } else {
            setLiveUserCount(null);
          }
        }, 30000);
        
        // Escuchar cambios de conexi√≥n
        const handleOnline = () => {
          updateLiveUserCount();
        };
        const handleOffline = () => {
          setLiveUserCount(null);
          setIsLoadingUsers(false);
        };
        
        window.addEventListener('online', handleOnline);
        window.addEventListener('offline', handleOffline);
        
        return () => {
          clearInterval(interval);
          window.removeEventListener('online', handleOnline);
          window.removeEventListener('offline', handleOffline);
        };
      }, []);

      const handleUpdate = async () => {
        if (waitingWorker) {
          waitingWorker.postMessage({ type: 'SKIP_WAITING' });
          setUpdateAvailable(false);
          setWaitingWorker(null);
          showToast('Actualizando aplicaci√≥n...', 'info', 2000);
          
          // Limpiar todos los caches antes de recargar
          if ('caches' in window) {
            try {
              const cacheNames = await caches.keys();
              await Promise.all(
                cacheNames.map(cacheName => caches.delete(cacheName))
              );
              console.log('‚úÖ Caches limpiados');
            } catch (error) {
              console.error('Error limpiando caches:', error);
            }
          }
          
          setTimeout(() => {
            // Forzar recarga completa sin cache
            window.location.reload(true);
          }, 1000);
        } else {
          // Si no hay waitingWorker, forzar actualizaci√≥n del service worker
          if ('serviceWorker' in navigator) {
            const registration = await navigator.serviceWorker.getRegistration();
            if (registration) {
              await registration.update();
              // Limpiar caches
              if ('caches' in window) {
                try {
                  const cacheNames = await caches.keys();
                  await Promise.all(
                    cacheNames.map(cacheName => caches.delete(cacheName))
                  );
                } catch (error) {
                  console.error('Error limpiando caches:', error);
                }
              }
              window.location.reload(true);
            }
          }
        }
      };

      const handleInstallClick = async () => {
        // Verificar si ya est√° instalado
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
        const isIOSStandalone = window.navigator.standalone === true;
        if (isStandalone || isIOSStandalone) {
          setTimeout(() => {
            setIsInstalled(true);
            setShowInstallButton(false);
          }, 0);
          return;
        }
        
        // Si no hay prompt nativo disponible, no hacer nada (el bot√≥n no deber√≠a estar visible)
        if (!deferredPrompt) {
          return;
        }
        
        // Usar el prompt nativo
        try {
          await deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          console.log('Resultado de instalaci√≥n:', outcome);
          
          // Diferir los setState para evitar bloqueos visuales, especialmente en m√≥viles
          setTimeout(() => {
            try {
              if (outcome === 'accepted') {
              setIsInstalled(true);
              setShowInstallButton(false);
              localStorage.setItem('pwa_installed', 'true');
              showToast('¬°Instalaci√≥n exitosa! La app funciona sin internet.', 'success', 6000);
            } else {
              // Si el usuario cancela, mantener el bot√≥n visible
              showToast('Instalaci√≥n cancelada', 'info', 3000);
            }
            
            // Limpiar el prompt despu√©s de usarlo (se haya aceptado o cancelado)
            setDeferredPrompt(null);
            } catch (error) {
              console.error('Error actualizando estado despu√©s de prompt:', error);
            }
          }, 100);
        } catch (error) {
          console.error('Error al mostrar prompt:', error);
          setTimeout(() => {
            setDeferredPrompt(null);
            setShowInstallButton(false);
          }, 0);
        }
      };

      const handleShareWhatsApp = () => {
        const message = `üéØ ARGENTORES - El juego del impostor

¬°Encuentra al impostor entre los jugadores! Un juego de deducci√≥n y estrategia con tem√°tica argentina donde debes descubrir qui√©n es el impostor antes de que sea demasiado tarde.

Juega ahora: https://argentores.github.io`;
        
        // Detectar si es m√≥vil
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        const encodedMessage = encodeURIComponent(message);
        
        if (isMobile) {
          // En m√≥viles, usar whatsapp:// para abrir la app directamente
          window.location.href = `whatsapp://send?text=${encodedMessage}`;
        } else {
          // En desktop/PC, primero intentar abrir la app de WhatsApp (si est√° instalada)
          // usando whatsapp:// y luego fallback a web.whatsapp.com
          try {
            window.location.href = `whatsapp://send?text=${encodedMessage}`;
            // Si despu√©s de 300ms no se abri√≥ la app, abrir web.whatsapp.com
            setTimeout(() => {
              window.open(`https://web.whatsapp.com/send?text=${encodedMessage}`, '_blank');
            }, 300);
          } catch (error) {
            // Si hay error, usar web directamente
            window.open(`https://web.whatsapp.com/send?text=${encodedMessage}`, '_blank');
          }
        }
      };

      const [step, setStep] = useState(1);
      const [playerCount, setPlayerCount] = useState(5);
      const [categories, setCategories] = useState([]);
      const [categoryMode, setCategoryMode] = useState('multiple');
      const [customCategories, setCustomCategories] = useState([]);
      const [showCustomCategoryEditor, setShowCustomCategoryEditor] = useState(false);
      const [editingCustomCategory, setEditingCustomCategory] = useState(null);
      const [customCategoryName, setCustomCategoryName] = useState('');
      const [customCategoryWords, setCustomCategoryWords] = useState([]);
      const [newWord, setNewWord] = useState('');
      const [impostorCount, setImpostorCount] = useState(1);
      const [useNames, setUseNames] = useState(false);
      const [playerNames, setPlayerNames] = useState([]);
      const [impostorHints, setImpostorHints] = useState(false);
      const [impostorNeverFirst, setImpostorNeverFirst] = useState(false);
      const [impostorsKnowEachOther, setImpostorsKnowEachOther] = useState(false);
      const [anonymousVoting, setAnonymousVoting] = useState(false);
      const [additionalImpostorsMode, setAdditionalImpostorsMode] = useState(false);
      const [additionalImpostorsCount, setAdditionalImpostorsCount] = useState(1);
      const [additionalImpostorsProbability, setAdditionalImpostorsProbability] = useState(5);
      const [isAdditionalImpostorsActive, setIsAdditionalImpostorsActive] = useState(false);
      const [jesterMode, setJesterMode] = useState(false);
      const [accompliceMode, setAccompliceMode] = useState(false);
      const [lostMode, setLostMode] = useState(false);
      // Modo "todos impostores" siempre activo (sin mostrar opci√≥n)
      const allImpostorsMode = true;
      const [gameStarted, setGameStarted] = useState(false);
      const [currentPlayerIndex, setCurrentPlayerIndex] = useState(0);
      const [revealedPlayers, setRevealedPlayers] = useState([]);
      const [roleRevealed, setRoleRevealed] = useState(false);
      const [allRolesRevealed, setAllRolesRevealed] = useState(false);
      const [firstPlayer, setFirstPlayer] = useState(null);
      const [showDiscussion, setShowDiscussion] = useState(false);
      const [showFinalReveal, setShowFinalReveal] = useState(false);
      const [finalRevealedPlayers, setFinalRevealedPlayers] = useState([]);
      const [currentlyRevealingPlayer, setCurrentlyRevealingPlayer] = useState(null);
      const [cardFlipped, setCardFlipped] = useState(false);
      const [selectedWord, setSelectedWord] = useState('');
      const [selectedCategory, setSelectedCategory] = useState('');
      const [eliminatedPlayers, setEliminatedPlayers] = useState([]);
      const [votingPlayer, setVotingPlayer] = useState(null);
      const [revealingVote, setRevealingVote] = useState(false);
      const [publicVotes, setPublicVotes] = useState({}); // { playerNumber: votedForNumber }
      const [currentVotingPlayerIndex, setCurrentVotingPlayerIndex] = useState(0);
      const [anonymousVotes, setAnonymousVotes] = useState({}); // { playerNumber: votedForNumber }
      const [votingStarted, setVotingStarted] = useState(false);
      const [selectedVoteTarget, setSelectedVoteTarget] = useState(null);
      const [lockUnlocked, setLockUnlocked] = useState(false);
      const [impostorsRemaining, setImpostorsRemaining] = useState(0);
      const [winners, setWinners] = useState(null);
      const [isLightMode, setIsLightMode] = useState(false);
      const [isAllImpostorsMode, setIsAllImpostorsMode] = useState(false);
      const [originalImpostorCount, setOriginalImpostorCount] = useState(0);
      const [roundNumber, setRoundNumber] = useState(1); // Rastrear n√∫mero de ronda para reglas de balance
      // Estados para modales modernos
      const [showDeleteCategoryModal, setShowDeleteCategoryModal] = useState(false);
      const [categoryToDelete, setCategoryToDelete] = useState(null);
      const [showImportSuccessModal, setShowImportSuccessModal] = useState(false);
      const [importedCategoryName, setImportedCategoryName] = useState('');
      const [showImportErrorModal, setShowImportErrorModal] = useState(false);
      const [importErrorMsg, setImportErrorMsg] = useState('');
      const [showDeleteProfileModal, setShowDeleteProfileModal] = useState(false);
      const [profileToDelete, setProfileToDelete] = useState(null);
      const [showSaveProfileModal, setShowSaveProfileModal] = useState(false);
      const [profileNameInput, setProfileNameInput] = useState('');
      const [pendingImport, setPendingImport] = useState(null);
      const [showReplaceCategoryModal, setShowReplaceCategoryModal] = useState(false);
      const [showHowToPlayModal, setShowHowToPlayModal] = useState(false);
      const [deferredPrompt, setDeferredPrompt] = useState(null);
      const [showInstallButton, setShowInstallButton] = useState(false);
      const [isInstalled, setIsInstalled] = useState(false);
      const [showIOSBanner, setShowIOSBanner] = useState(false);
      const [isIOSSafari, setIsIOSSafari] = useState(false);
      const [cameFromOtherBrowser, setCameFromOtherBrowser] = useState(false);
      const [isOnline, setIsOnline] = useState(navigator.onLine);
      const [updateAvailable, setUpdateAvailable] = useState(false);
      const [waitingWorker, setWaitingWorker] = useState(null);
      const [savedProfiles, setSavedProfiles] = useState([]);
      const [selectedProfile, setSelectedProfile] = useState(null);
      const [showPlayerNamesList, setShowPlayerNamesList] = useState(false);
      const [showProfilesList, setShowProfilesList] = useState(false);
      const [showExitConfirm, setShowExitConfirm] = useState(false);
      const [showResultsConfirm, setShowResultsConfirm] = useState(false);
      const [openMenuCategory, setOpenMenuCategory] = useState(null);
      const [showPWAOpenModal, setShowPWAOpenModal] = useState(false);
      
      // Estados para sistema premium
      const [isPremium, setIsPremium] = useState(() => {
        // Cargar estado premium desde localStorage
        const saved = localStorage.getItem('impostorGamePremium');
        return saved === 'true';
      });
      const [showUnlockModal, setShowUnlockModal] = useState(false);
      const [premiumCodeInput, setPremiumCodeInput] = useState('');
      
      // Estados para sistema de racha (basado en partidas)
      const [streak, setStreak] = useState(0);
      const [gamesPlayed, setGamesPlayed] = useState(0);
      const [recoveryUsed, setRecoveryUsed] = useState(false);
      const [showRecoveryModal, setShowRecoveryModal] = useState(false);
      
      // Estados para contador de usuarios en vivo
      const [liveUserCount, setLiveUserCount] = useState(null); // null = no disponible (offline/error)
      const [isLoadingUsers, setIsLoadingUsers] = useState(true);
      const [premiumError, setPremiumError] = useState('');

      const categoryList = [
        { name: 'Animales', emoji: 'üêæ' },
        { name: 'Profesiones', emoji: 'üëî' },
        { name: 'Deportes', emoji: '‚öΩ' },
        { name: 'Pa√≠ses', emoji: 'üåç' },
        { name: 'Comida', emoji: 'üçï' },
        { name: 'Pel√≠culas y Series', emoji: 'üé¨' },
        { name: 'Objetos', emoji: 'üîß' },
        { name: 'Lugares', emoji: 'üèñÔ∏è' },
        { name: 'Videojuegos', emoji: 'üéÆ' },
        { name: 'M√∫sica', emoji: 'üéµ' },
        { name: 'VIP', emoji: 'üëë', premium: true }
      ];

      const categoryWords = {
        'Animales': ['Perro', 'Gato', 'Vaca', 'Caballo', 'Carpincho', 'Puma', 'Loro', '√ëand√∫', 'Zorrino', 'Hornero', 'Guanaco', 'Carancho', 'Ping√ºino', 'Llama', 'C√≥ndor', 'Cocodrilo', 'Burro', 'Chancho', 'Oveja', 'Gallina', 'Pato', 'Cisne', 'Flamenco', 'Toro', 'Cabra', 'Conejo', 'Zorro', 'Lobo marino', 'Ballena', 'Delf√≠n', 'Tibur√≥n', 'Elefante', 'Jirafa', 'Le√≥n', 'Tigre', 'Mono', 'Cebra', 'Hipop√≥tamo', 'Rinoceronte', 'Oso', '√Åguila', 'Paloma', 'Gorri√≥n', 'B√∫ho', 'Murci√©lago', 'Tortuga', 'Iguana', 'Serpiente', 'Rana', 'Mariposa'],
        'Profesiones': ['M√©dico', 'Ingeniero', 'Profesor', 'Chef', 'Bombero', 'Polic√≠a', 'Artista', 'Piloto', 'Enfermero', 'Arquitecto', 'Abogado', 'Contador', 'Electricista', 'Plomero', 'Mec√°nico', 'Carpintero', 'Alba√±il', 'Pintor', 'Peluquero', 'Veterinario', 'Dentista', 'Farmac√©utico', 'Psic√≥logo', 'Periodista', 'Fot√≥grafo', 'Dise√±ador gr√°fico', 'Programador', 'Chofer de colectivo', 'Taxista', 'Carnicero', 'Panadero', 'Verdulero', 'Cajero', 'Mozo', 'Cocinero', 'M√∫sico', 'Actor', 'Bailar√≠n', 'Locutor', 'DJ', 'Entrenador', '√Årbitro', 'Futbolista', 'Guardia de seguridad', 'Portero'],
        'Deportes': ['F√∫tbol', 'B√°squet', 'Tenis', 'Voley', 'Rugby', 'Nataci√≥n', 'Atletismo', 'Boxeo', 'Ciclismo', 'Hockey', 'Paddle', 'Golf', 'Automovilismo', 'Handball', 'Pesca', 'Escalada', 'Esqu√≠', 'Snowboard', 'Patinaje', 'Gimnasia', 'Pesas', 'Yoga', 'Taekwondo', 'Karate', 'Esgrima', 'Tiro', 'Arco y flecha', 'Polo', 'Remo', 'Surf', 'Skate', 'BMX', 'Motocross', 'Rally', 'Karting', 'Truco', 'Ajedrez', 'Pool', 'Bowling', 'Tejo', 'Parkour', 'Caminata'],
        'Pa√≠ses': ['Argentina', 'Brasil', 'Chile', 'Uruguay', 'Paraguay', 'Bolivia', 'Per√∫', 'Colombia', 'Venezuela', 'Ecuador', 'M√©xico', 'Estados Unidos', 'Canad√°', 'Espa√±a', 'Francia', 'Italia', 'Alemania', 'Inglaterra', 'Portugal', 'Holanda', 'B√©lgica', 'Suiza', 'Austria', 'Grecia', 'Rusia', 'Ucrania', 'Polonia', 'Turqu√≠a', 'Suecia', 'Noruega', 'Dinamarca', 'Finlandia', 'Irlanda', 'Escocia', 'Croacia', 'Serbia', 'Rumania', 'Hungr√≠a', 'Rep√∫blica Checa', 'China', 'Jap√≥n', 'Corea del Sur', 'India', 'Tailandia', 'Vietnam', 'Indonesia', 'Filipinas', 'Australia', 'Nueva Zelanda', 'Egipto', 'Marruecos', 'Sud√°frica', 'Nigeria', 'Kenia', 'Israel', 'Arabia Saudita', 'Emiratos √Årabes', 'Ir√°n', 'Irak', 'Afganist√°n', 'Pakist√°n', 'Cuba', 'Jamaica', 'Panam√°', 'Costa Rica', 'Guatemala', 'Rep√∫blica Dominicana', 'Puerto Rico', 'Honduras', 'Nicaragua', 'El Salvador'],
        'Comida': ['Pizza', 'Hamburguesa', 'Asado', 'Empanadas', 'Milanesa', 'Chorip√°n', 'Locro', 'Pastel de papa', 'Ravioles', '√ëoquis', 'Tallarines', 'Lasa√±a', 'Canelones', 'Risotto', 'Polenta', 'Guiso', 'Matambre', 'Vac√≠o', 'Provoleta', 'Picada', 'S√°ndwich de miga', 'Tostado', 'Pancho', 'Pizza a la parrilla', 'Medialunas', 'Facturas', 'Alfajores', 'Dulce de leche', 'Arroz con leche', 'Flan', 'Churros', 'Torta frita', 'Sushi', 'Tacos', 'Burritos', 'Nachos', 'Pancho', 'Papas fritas', 'Pollo frito', 'Paella', 'Sorrentinos', 'Cappellettis', 'Fideos', 'Spaghetti', 'Mostacholes', 'Tirabuz√≥n', 'Tuco', 'Pizza napolitana', 'Muzzarella', 'Calzone', 'Milanesa napolitana', 'Suprema', 'Pollo al horno', 'Pollo a la parrilla', 'Pata muslo', 'Bondiola', 'Morcilla', 'Chinchul√≠n', 'Ri√±√≥n', 'Tira de asado', 'Guiso', 'Sopa', 'Caldo', 'Sandwich', 'Lomito', 'Hamburguesa', 'Papas noisette', 'Pur√©', 'Ensalada', 'Tarta', 'Empanada de carne', 'Empanada de pollo', 'Empanada de jam√≥n y queso', 'Ramen', 'Arroz', 'Waffles', 'Pancakes', 'Donas', 'Muffins', 'Brownies', 'Cookies', 'Tiramis√∫', 'Pavlova', 'Lemon pie', 'Chocotorta'],
        'Pel√≠culas y Series': ['Titanic', 'El Padrino', 'Star Wars', 'Toy Story', 'El Rey Le√≥n', 'Jurassic Park', 'Volver al Futuro', 'Rocky', 'Matrix', 'Avatar', 'Avengers', 'Iron Man', 'Spider-Man', 'Batman', 'Harry Potter', 'El Se√±or de los Anillos', 'Piratas del Caribe', 'R√°pido y Furioso', 'Misi√≥n Imposible', 'Indiana Jones', 'E.T.', 'Tibur√≥n', 'Shrek', 'Buscando a Nemo', 'Frozen', 'Coco', 'El Secreto de sus Ojos', 'Nueve Reinas', 'Relatos Salvajes', 'El Clan', 'Esperando la Carroza', 'Metegol', 'Breaking Bad', 'Game of Thrones', 'Friends', 'Los Simpsons', 'Stranger Things', 'The Walking Dead', 'La Casa de Papel', 'Narcos', 'Los Serrano', 'Casados con Hijos', 'Los Simuladores', 'El Marginal', 'Okupas', 'Tumberos', 'Son Amores', 'Chiquititas', 'Rebelde Way', 'Floricienta', 'Violetta', 'Soy Luna', 'The Office', 'How I Met Your Mother', 'The Big Bang Theory', 'Brooklyn Nine-Nine', 'Parks and Recreation', 'Modern Family', 'Two and a Half Men', 'Seinfeld', 'Forrest Gump', 'Gladiador', 'El Origen', 'Interestelar', 'Joker', 'Pulp Fiction', 'Django', 'El Lobo de Wall Street', 'Fight Club', 'Seven', 'El Sexto Sentido', 'It', 'Saw', 'El Conjuro', 'Scream', 'The Crown', 'Peaky Blinders', 'Sherlock', 'Black Mirror', 'Dark', 'The Witcher', 'The Mandalorian', 'The Boys', 'Euphoria', 'Wednesday', 'Squid Game', 'All of Us Are Dead', 'El Juego del Calamar', 'Merl√≠', 'Elite', 'Vis a Vis', 'Money Heist', 'Pepe Grillo', 'CQC', 'Showmatch', 'Duro de Matar', 'Top Gun', 'La Momia', 'El Pianista', 'La Lista de Schindler', 'La Vida es Bella', 'Am√©lie', 'Los Miserables', 'Casablanca', 'Grease', 'Dirty Dancing', 'High School Musical', 'La La Land', 'Bohemian Rhapsody', 'The Greatest Showman', 'Grey ¬¥s Anatomy', 'House', 'Dexter', 'Prison Break', 'Lost', 'Heroes', 'Supernatural', 'Lucifer', 'The Vampire Diaries', 'Riverdale', 'Gossip Girl', '13 Reasons Why', 'Sex Education', 'La Que Se Avecina', 'El Chavo del 8', 'Chespirito'],
        'Objetos': ['Mate', 'Bombilla', 'Termo', 'Pava', 'Yerba', 'Alfajor', 'Dulce de leche', 'Poncho', 'Boina', 'Bombacha de gaucho', 'Parrilla', 'Changuito', 'Cama', 'Colch√≥n', 'Almohada', 'S√°bana', 'Frazada', 'Mesa', 'Silla', 'Sill√≥n', 'Sof√°', 'Televisor', 'Control remoto', 'Celular', 'Cargador', 'Auriculares', 'Computadora', 'Notebook', 'Teclado', 'Mouse', 'Monitor', 'Impresora', 'Router', 'L√°mpara', 'Foco', 'Linterna', 'Vela', 'F√≥sforo', 'Encendedor', 'Espejo', 'Reloj', 'Despertador', 'Ventilador', 'Estufa', 'Aire acondicionado', 'Heladera', 'Freezer', 'Microondas', 'Horno', 'Cocina', 'Licuadora', 'Batidora', 'Tostadora', 'Pava el√©ctrica', 'Cafetera', 'Exprimidor', 'Jarra', 'Vaso', 'Taza', 'Plato', 'Bowl', 'Tenedor', 'Cuchillo', 'Cuchara', 'Cuchar√≥n', 'Esp√°tula', 'Pinzas', 'Colador', 'Rallador', 'Pelador', 'Abrelatas', 'Sacacorchos', 'Tabla de cortar', 'Olla', 'Cacerola', 'Sart√©n', 'Wok', 'Fuente', 'Bandeja', 'Tupperware', 'Botella', 'Termo stanley', 'Bid√≥n', 'Servilleta', 'Repasador', 'Trapo de piso', 'Esponja', 'Detergente', 'Lavandina', 'Desinfectante', 'Jab√≥n', 'Escoba', 'Pala', 'Balde', 'Trapeador', 'Secador de piso', 'Escurridor', 'Cepillo', 'Plumero', 'Aspiradora', 'Lavarropas', 'Secarropas', 'Plancha', 'Tabla de planchar', 'Perchero', 'Gancho', 'Tender', 'Broche', 'Canasto', 'Cesto de basura', 'Bolsa de residuos', 'Inodoro', 'Bidet', 'Ducha', 'Ba√±era', 'Canilla', 'Lavabo', 'Toalla', 'Toall√≥n', 'Cortina de ba√±o', 'Alfombra de ba√±o', 'Papel higi√©nico', 'Jab√≥n l√≠quido', 'Shampoo', 'Acondicionador', 'Crema de enjuague', 'Gel de ducha', 'Esponja de ba√±o', 'Cepillo de dientes', 'Pasta dental', 'Hilo dental', 'Enjuague bucal', 'Peine', 'Cepillo de pelo', 'Secador de pelo', 'Plancha de pelo', 'Afeitadora', 'Espuma de afeitar', 'Perfume', 'Desodorante', 'Crema', 'Protector solar', 'Maquillaje', 'Algod√≥n', 'Cotonete', 'Tijera', 'Pinza de depilar', 'Cortau√±as', 'Lima de u√±as', 'Balanza', 'Botiqu√≠n', 'Term√≥metro', 'Curitas', 'Vendas', 'Alcohol', 'Agua oxigenada', 'Remedio', 'Pastillas', 'Jarabe', 'Anteojos', 'Lentes de contacto', 'Anteojos de sol', 'Paraguas', 'Piloto', 'Campera', 'Buzo', 'Remera', 'Camisa', 'Pantal√≥n', 'Jean', 'Short', 'Pollera', 'Vestido', 'Zapatillas', 'Zapatos', 'Botas', 'Sandalias', 'Ojotas', 'Medias', 'Cintur√≥n', 'Cartera', 'Mochila', 'Bolso', 'Billetera', 'Llavero', 'Llaves', 'Candado', 'Cerradura', 'Timbre', 'Puerta', 'Ventana', 'Persiana', 'Cortina', 'Cuadro', 'Portarretrato', 'Adorno', 'Florero', 'Planta', 'Maceta', 'Regadera', 'Pala de jard√≠n', 'Rastrillo', 'Manguera', 'Biblioteca', 'Estante', 'Caj√≥n', 'Ropero', 'Placard', 'Escritorio', 'Silla de escritorio', 'Libro', 'Revista', 'Diario', 'Diccionario', 'Cuaderno', 'Carpeta', 'Hoja', 'L√°piz', 'Lapicera', 'Birome', 'Marcador', 'Resaltador', 'Goma de borrar', 'Sacapuntas', 'Regla', 'Comp√°s', 'Transportador', 'Calculadora', 'Cartuchera', 'Mochila escolar', 'Tijera escolar', 'Pegamento', 'Cinta adhesiva', 'Voligoma', 'Plasticola', 'Abrochadora', 'Ganchos', 'Perforadora', 'Clips', 'Broches', 'Archivador', 'Sobre', 'Sello', 'Timbres', 'Tel√©fono', 'C√°mara', 'Videoc√°mara', 'Tr√≠pode', 'Micr√≥fono', 'Parlante', 'Equipo de m√∫sica', 'Radio', 'CD', 'DVD', 'Pendrive', 'Disco duro', 'Tarjeta de memoria', 'Cable', 'Zapatilla el√©ctrica', 'Enchufe', 'Adaptador', 'Pila', 'Bater√≠a', 'Cinta m√©trica', 'Nivel', 'Martillo', 'Destornillador', 'Pinza', 'Alicate', 'Llave inglesa', 'Taladro', 'Sierra', 'Cinta aisladora', 'Tornillo', 'Clavo', 'Tarugos', 'Tuerca', 'Arandela', 'Pegamento universal', 'Silicona', 'Pintura', 'Pincel', 'Rodillo', 'Escalera', 'Banqueta', 'Soga', 'Cuerda', 'Cadena', 'Alambre', 'Bolsa', 'Caja', 'Envase', 'Frasco', 'Lata'],
        'Lugares': ['Playa', 'Monta√±a', 'R√≠o', 'Lago', 'Bosque', 'Selva', 'Desierto', 'Campo', 'Centro comercial', 'Shopping', 'Supermercado', 'Almac√©n', 'Kiosco', 'Farmacia', 'Hospital', 'Cl√≠nica', 'Escuela', 'Universidad', 'Biblioteca', 'Museo', 'Teatro', 'Cine', 'Estadio', 'Cancha', 'Gimnasio', 'Parque', 'Plaza', 'Obelisco', 'Casa Rosada', 'Caminito', 'La Boca', 'Puerto Madero', 'Palermo', 'San Telmo', 'Recoleta', 'Cementerio de la Recoleta', 'Teatro Col√≥n', 'Avenida 9 de Julio', 'Avenida Corrientes', 'Calle Florida', 'Cataratas del Iguaz√∫', 'Glaciar Perito Moreno', 'Ushuaia', 'Tierra del Fuego', 'El Calafate', 'Bariloche', 'Cerro Catedral', 'Villa La Angostura', 'San Mart√≠n de los Andes', 'Mendoza', 'Aconcagua', 'Quebrada de Humahuaca', 'Cerro de los Siete Colores', 'Salta', 'Jujuy', 'Tilcara', 'Purmamarca', 'Cafayate', 'Tucum√°n', 'Taf√≠ del Valle', 'C√≥rdoba', 'Villa Carlos Paz', 'Mar del Plata', 'Pinamar', 'Villa Gesell', 'Caril√≥', 'Costa Atl√°ntica', 'Pen√≠nsula Vald√©s', 'Puerto Madryn', 'Rosario', 'Monumento a la Bandera', 'La Plata', 'Tigre', 'Delta del Tigre', 'Parque Nacional Los Glaciares', 'Parque Nacional Nahuel Huapi', 'Cerro Fitz Roy', 'El Chalt√©n', 'Tren a las Nubes', 'Ruta 40', 'Ruta de los Siete Lagos', 'Ischigualasto', 'Valle de la Luna', 'Talampaya', 'Salinas Grandes', 'Iruya', 'Torre Eiffel', 'Estatua de la Libertad', 'Big Ben', 'Coliseo Romano', 'Torre de Pisa', 'Taj Mahal', 'Gran Muralla China', 'Cristo Redentor', 'Machu Picchu', 'Pir√°mides de Egipto', '√ìpera de Sydney', 'Sagrada Familia', 'Puerta de Brandenburgo', 'Times Square', 'Central Park', 'Golden Gate', 'Chich√©n Itz√°', 'Stonehenge', 'Parten√≥n', 'Plaza Roja', 'Kremlin', 'Catedral de Notre Dame', 'Louvre', 'Arco de Triunfo', 'Palacio de Buckingham', 'Cataratas del Ni√°gara', 'Gran Ca√±√≥n', 'Petra', 'Monte Everest', 'Burj Khalifa', 'Alhambra', 'Restaurante', 'Bar', 'Caf√©', 'Confiter√≠a', 'Parrilla', 'Pizzer√≠a', 'Hotel', 'Hostel', 'Aeropuerto', 'Terminal de buses', 'Estaci√≥n de tren', 'Puerto', 'Aduana', 'Banco', 'Cajero', 'Correo', 'Comisar√≠a', 'Cuartel de bomberos', 'Iglesia', 'Catedral', 'Templo', 'Mezquita', 'Sinagoga', 'Cementerio', 'Zool√≥gico', 'Acuario', 'Parque de diversiones', 'Feria', 'Mercado', 'Feria americana', 'Casino', 'Boliche', 'Disco'],
        'Videojuegos': ['Minecraft', 'Fortnite', 'GTA V', 'FIFA', 'EA FC', 'Counter Strike', 'Free Fire', 'League of Legends', 'Apex Legends', 'Call of Duty', 'Valorant', 'Roblox', 'Among Us', 'Fall Guys', 'Rocket League', 'Clash Royale', 'Clash of Clans', 'PUBG', 'Brawl Stars', 'Mario', 'Luigi', 'Sonic', 'Pikachu', 'Pac-Man', 'Donkey Kong', 'Link', 'Zelda', 'Kirby', 'Yoshi', 'Bowser', 'Peach', 'Toad', 'Wario', 'Waluigi', 'Crash Bandicoot', 'Spyro', 'Lara Croft', 'Master Chief', 'Kratos', 'Nathan Drake', 'Ellie', 'Joel', 'Steve', 'Alex', 'Creeper', 'Enderman', 'Slenderman', 'Herobrine', 'Ryu', 'Ken', 'Chun-Li', 'Sub-Zero', 'Scorpion', 'Raiden', 'Ezio', 'Altair', 'Cloud', 'Sephiroth', 'Samus', 'Fox McCloud', 'Mega Man', 'Solid Snake', 'Doom Slayer', 'Duke Nukem', 'Rayman', 'Banjo Kazooie', 'Conker', 'Spyro', 'Ratchet', 'Clank', 'Jak', 'Daxter', 'Sackboy', 'Knuckles', 'Tails', 'Shadow', 'Amy Rose', 'Dr Eggman', 'Doctor Robotnik', 'Wii', 'PlayStation', 'Xbox', 'Nintendo', 'Switch', 'Game Boy', 'DS', 'PSP', 'Vita', 'Sega', 'Atari', 'Arcade', 'Joystick', 'Mando', 'Control', 'Gamepad', 'Tetris', 'Pong', 'Space Invaders', 'Galaga', 'Street Fighter', 'Mortal Kombat', 'Tekken', 'Dragon Ball', 'Naruto', 'One Piece', 'Pokemon', 'Digimon', 'Yu-Gi-Oh', 'Metal Gear', 'Resident Evil', 'Silent Hill', 'The Last of Us', 'Uncharted', 'God of War', 'Halo', 'Gears of War', 'Tomb Raider', 'Assassins Creed', 'Far Cry', 'Watch Dogs', 'Splinter Cell', 'Prince of Persia', 'Devil May Cry', 'Bayonetta', 'Final Fantasy', 'Kingdom Hearts', 'Persona', 'Zelda', 'Metroid', 'Castlevania', 'Mega Man', 'Sonic', 'Mario Kart', 'Super Smash Bros', 'Splatoon', 'Animal Crossing', 'Fire Emblem', 'Xenoblade', 'The Witcher', 'Skyrim', 'Fallout', 'Dark Souls', 'Bloodborne', 'Elden Ring', 'Sekiro', 'Hollow Knight', 'Celeste', 'Undertale', 'Stardew Valley', 'Terraria', 'Ori', 'Cuphead', 'Portal', 'Half-Life', 'Left 4 Dead', 'Team Fortress', 'Dota', 'Overwatch', 'Hearthstone', 'World of Warcraft', 'Diablo', 'StarCraft', 'WarCraft', 'Age of Empires', 'Civilization', 'SimCity', 'The Sims', 'Spore', 'Need for Speed', 'Gran Turismo', 'Forza', 'Mario Bros', 'Donkey Kong Country', 'Metroid Prime', 'Pikmin', 'Star Fox', 'Earthbound', 'Mother', 'F-Zero', 'Punch-Out', 'Wii Sports', 'Wii Fit', 'Just Dance', 'Guitar Hero', 'Rock Band', 'Dance Dance Revolution', 'Beat Saber', 'Angry Birds', 'Candy Crush', 'Plants vs Zombies', 'Geometry Dash', 'Subway Surfers', 'Temple Run', 'Fruit Ninja', 'Cut the Rope', 'Clash of Clans', 'Mobile Legends', 'Arena of Valor', 'Genshin Impact', 'Honkai', 'Raid Shadow Legends'],
        'M√∫sica': ['Charly Garc√≠a', 'Gustavo Cerati', 'Soda Stereo', 'Luis Alberto Spinetta', 'Fito P√°ez', 'Los Redondos', 'Patricio Rey', 'Andr√©s Calamaro', 'Sumo', 'Luca Prodan', 'Ser√∫ Gir√°n', 'Sui Generis', 'Almendra', 'Pescado Rabioso', 'Divididos', 'Los Piojos', 'La Renga', 'Callejeros', 'Bersuit Vergarabat', 'Babas√≥nicos', 'Los Enanitos Verdes', 'Rata Blanca', 'V8', 'Herm√©tica', 'Pappo', 'Viejas Locas', 'Las Pelotas', 'Attaque 77', 'Los Aut√©nticos Decadentes', 'Los Fabulosos Cadillacs', 'Vicentico', 'Le√≥n Gieco', 'Mercedes Sosa', 'Soledad', 'Los Chalchaleros', 'Los Nocheros', 'Rodrigo', 'La Mona Jim√©nez', 'Damas Gratis', 'Pablo Lescano', 'Los Palmeras', 'R√°faga', 'Alcides', 'Gilda', 'Antonio R√≠os', 'Duki', 'Bizarrap', 'Trueno', 'Wos', 'Nicki Nicole', 'Mar√≠a Becerra', 'Emilia Mernes', 'Tini Stoessel', 'Cazzu', 'Paulo Londra', 'Lit Killah', 'Khea', 'YSY A', 'Neo Pistea', 'Dillom', 'Bhavi', 'Tiago PZK', 'FMK', 'Rusherking', 'Big One', 'L-Gante', 'Luck Ra', 'Nathy Peluso', 'Ca7riel', 'Paco Amoroso', 'Zoe Gotusso', 'Bandalos Chinos', 'Las Ligas Menores', 'Los Esp√≠ritus', 'Conociendo Rusia', 'Ciro y los Persas', 'La Beriso', 'Las Pastillas del Abuelo', 'Tan Bi√≥nica', 'Miranda', 'Estelares', 'Turf', 'La Vela Puerca', 'No Te Va Gustar', 'Michael Jackson', 'Madonna', 'The Beatles', 'Queen', 'Elvis Presley', 'Bob Marley', 'Nirvana', 'Metallica', 'AC/DC', 'Led Zeppelin', 'Pink Floyd', 'The Rolling Stones', 'U2', 'Coldplay', 'Imagine Dragons', 'Maroon 5', 'Bruno Mars', 'Ed Sheeran', 'Justin Bieber', 'Taylor Swift', 'Ariana Grande', 'Billie Eilish', 'The Weeknd', 'Drake', 'Eminem', 'Rihanna', 'Beyonc√©', 'Lady Gaga', 'Katy Perry', 'Shakira', 'Bad Bunny', 'J Balvin', 'Daddy Yankee', 'Maluma', 'Ozuna', 'Anuel AA', 'Karol G', 'Peso Pluma', 'Feid', 'Rauw Alejandro', 'Rosal√≠a', 'C Tangana', 'Juan Luis Guerra', 'Marc Anthony', 'Luis Miguel', 'Alejandro Sanz', 'Man√°', 'Soda Stereo', 'Enanitos Verdes', 'Los Prisioneros', 'Cafe Tacvba', 'Molotov', 'Zo√©', 'Mon Laferte', 'Natalia Lafourcade', 'Rock', 'Pop', 'Cumbia', 'Cuarteto', 'Folklore', 'Tango', 'Trap', 'Reggaeton', 'Hip hop', 'Rap', 'RKT', 'Electr√≥nica', 'House', 'Techno', 'Reggae', 'Ska', 'Punk', 'Metal', 'Heavy metal', 'Blues', 'Jazz', 'Soul', 'Funk', 'Disco', 'Country', 'Salsa', 'Bachata', 'Merengue', 'Balada', 'Bolero', 'Ranchera', 'Mariachi', 'Samba', 'Bossa nova', 'Guitarra', 'Piano', 'Bater√≠a', 'Bajo', 'Viol√≠n', 'Saxof√≥n', 'Trompeta', 'Flauta', 'Arm√≥nica', 'Acorde√≥n', 'Teclado', 'Micr√≥fono', 'Amplificador', 'Parlante', 'Auriculares', 'Bandone√≥n', 'Bombo', 'Charango', 'Quena', 'Ukelele', 'Tambor', 'Pandereta', 'Maracas', 'Bong√≥', 'Congas', 'Sintetizador'],
        'VIP': ['Aleatorio', 'Misterio', 'Sorpresa', '√âxito', 'Fortuna', 'Destino', 'Suerte', 'Magia', 'Enigma', 'Secreto', 'Poder', 'Gloria', 'Victoria', 'Triunfo', 'Honor', 'Nobleza', 'Elegancia', 'Lujo', 'Riqueza', 'Prestigio', 'Fama', 'Brillo', 'Esplendor', 'Majestad', 'Grandeza', 'Excelencia', 'Perfecci√≥n', 'Maestr√≠a', 'Genialidad', 'Brillantez', 'Sabidur√≠a', 'Inteligencia', 'Creatividad', 'Innovaci√≥n', 'Revoluci√≥n', 'Transformaci√≥n', 'Evoluci√≥n', 'Progreso', 'Avance', 'Desarrollo', 'Crecimiento', 'Expansi√≥n', 'Ampliaci√≥n', 'Mejora', 'Optimizaci√≥n', 'Potenciaci√≥n', 'Enriquecimiento', 'Elevaci√≥n', 'Ascenso', 'Superaci√≥n']
      };

      const wordHints = {
        // Puedes usar un string simple: 'Perro': 'El mejor amigo del hombre'
        // O un array para m√∫ltiples pistas (se seleccionar√° una al azar): 'Perro': ['El mejor amigo del hombre', 'Animal dom√©stico que ladra', 'Mascota fiel']
        'Animales': {
          'Perro': ['V√≠nculo', 'Permanencia', 'Retorno'],
    'Gato': ['Autonom√≠a', 'Umbral', 'Observador'],
    'Vaca': ['Ciclo', 'Inercia', 'Continuidad'],
    'Caballo': ['Trayecto', 'Carga', 'Impulso'],
    'Carpincho': ['Convivencia', 'Adaptaci√≥n', 'Calma'],
    'Puma': ['Acecho', 'Vac√≠o', 'Reserva'],
    'Loro': ['Repetici√≥n', 'Reflejo', 'Ruido'],
    '√ëand√∫': ['Extensi√≥n', 'Huida', 'Plano'],
    'Zorrino': ['L√≠mite', 'Prevenci√≥n', 'Reacci√≥n'],
    'Hornero': ['Constancia', 'Dise√±o', 'Ciclo'],
    'Guanaco': ['Austeridad', 'Distancia', 'Equilibrio'],
    'Carancho': ['Espera', 'Ventaja', 'Restos'],
    'Ping√ºino': ['Disciplina', 'Resistencia', 'Grupo'],
    'Llama': ['Altitud', 'Servicio', 'Ritmo'],
    'C√≥ndor': ['Paciencia', 'Altura', 'Control'],
    'Cocodrilo': ['Inmovilidad', 'Tiempo', 'Energ√≠a'],
    'Burro': ['Tenacidad', 'L√≠mite', 'Decisi√≥n'],
    'Chancho': ['Exceso', 'Oportunidad', 'Aprovechamiento'],
    'Oveja': ['Seguimiento', 'Uniformidad', 'Masa'],
    'Gallina': ['Repetici√≥n', 'Cautela', 'Cercan√≠a'],
    'Pato': ['Transici√≥n', 'Superficie', 'Fluidez'],
    'Cisne': ['Apariencia', 'Distancia', 'Ritual'],
    'Flamenco': ['Balance', 'Selecci√≥n', 'Filtro'],
    'Toro': ['Presi√≥n', 'Impulso', 'Dominio'],
    'Cabra': ['Desaf√≠o', 'Pendiente', 'Insistencia'],
    'Conejo': ['Alerta', 'Escape', 'Frecuencia'],
    'Zorro': ['Estrategia', 'Ambig√ºedad', 'Margen'],
    'Lobo marino': ['Turnos', 'Ruido', 'Espacio'],
    'Ballena': ['Memoria', 'Deriva', 'Profundidad'],
    'Delf√≠n': ['Interacci√≥n', 'Se√±al', 'Coordinaci√≥n'],
    'Tibur√≥n': ['Direcci√≥n', 'Eficiencia', 'Decisi√≥n'],
    'Elefante': ['Registro', 'Peso', 'Continuidad'],
    'Jirafa': ['Perspectiva', 'Desfase', 'Acceso'],
    'Le√≥n': ['Centro', 'Presencia', 'Control'],
    'Tigre': ['Tensi√≥n', 'Soledad', 'Precisi√≥n'],
    'Mono': ['Ensayo', 'Curiosidad', 'Aprendizaje'],
    'Cebra': ['Contraste', 'Confusi√≥n', 'Colectivo'],
    'Hipop√≥tamo': ['Territorio', 'Inercia', 'Fuerza'],
    'Rinoceronte': ['Direcci√≥n', 'Aislamiento', 'Impacto'],
    'Oso': ['Reserva', 'Ciclo', 'Adaptaci√≥n'],
    '√Åguila': ['Enfoque', 'Altura', 'Anticipaci√≥n'],
    'Paloma': ['Retorno', 'Costumbre', 'Proximidad'],
    'Gorri√≥n': ['Frecuencia', 'Rutina', 'Presencia'],
    'B√∫ho': ['Vigilancia', 'Intervalo', 'Silencio'],
    'Murci√©lago': ['Orientaci√≥n', 'Pulso', 'Espacio'],
    'Tortuga': ['Persistencia', 'Protecci√≥n', 'Tiempo'],
    'Iguana': ['Exposici√≥n', 'Inercia', 'Calor'],
    'Serpiente': ['Transici√≥n', 'Continuidad', 'Econom√≠a'],
    'Rana': ['Cambio', 'Etapa', 'Ritmo'],
    'Mariposa': ['Proceso', 'Brevedad', 'Transformaci√≥n']
        },
        'Profesiones': {
          'M√©dico': ['Umbral', 'Irreversibilidad', 'Carga'],
    'Ingeniero': ['Modelo', 'Compromiso', 'Ajuste'],
    'Profesor': ['Desfase', 'Continuidad', 'Tr√°nsito'],
    'Chef': ['Tensi√≥n', 'Criterio', 'Resoluci√≥n'],
    'Bombero': ['Exposici√≥n', 'Evento', 'L√≠mite'],
    'Polic√≠a': ['Presencia', 'Fricci√≥n', 'Marco'],
    'Artista': ['Desv√≠o', 'Intenci√≥n', 'Ruido'],
    'Piloto': ['Trayectoria', 'Margen', 'Correcci√≥n'],
    'Enfermero': ['Persistencia', 'Umbral', 'Acompa√±amiento'],
    'Arquitecto': ['Vac√≠o', 'Proyecci√≥n', 'Orden'],
    'Abogado': ['Marco', 'Asimetr√≠a', 'Ventaja'],
    'Contador': ['Cierre', 'Equilibrio', 'Consistencia'],
    'Electricista': ['Flujo', 'Ruptura', 'Riesgo'],
    'Plomero': ['Presi√≥n', 'Desv√≠o', 'Correcci√≥n'],
    'Mec√°nico': ['Desfase', 'Funci√≥n', 'Ajuste'],
    'Carpintero': ['Medida', 'Ensayo', 'Encaje'],
    'Alba√±il': ['Base', 'Carga', 'Secuencia'],
    'Pintor': ['Capa', 'L√≠mite', 'Variaci√≥n'],
    'Peluquero': ['Forma', 'Decisi√≥n', 'Cambio'],
    'Veterinario': ['Evaluaci√≥n', 'Umbral', 'Intervenci√≥n'],
    'Dentista': ['Detalle', 'Correcci√≥n', 'Prevenci√≥n'],
    'Farmac√©utico': ['Proporci√≥n', 'Confianza', 'Control'],
    'Psic√≥logo': ['Escucha', 'Proceso', 'Desplazamiento'],
    'Periodista': ['Selecci√≥n', 'Relato', 'Contexto'],
    'Fot√≥grafo': ['Encuadre', 'Instante', 'Elecci√≥n'],
    'Dise√±ador gr√°fico': ['S√≠ntesis', 'Forma', 'Lectura'],
    'Programador': ['Abstracci√≥n', 'Iteraci√≥n', 'Coherencia'],
    'Chofer de colectivo': ['Ritmo', 'Recorrido', 'Inercia'],
    'Taxista': ['Disponibilidad', 'Adaptaci√≥n', 'Trayecto'],
    'Almacenero': ['Proximidad', 'Continuidad', 'Rotaci√≥n'],
    'Carnicero': ['Selecci√≥n', 'Corte', 'Criterio'],
    'Panadero': ['Tiempo', 'Proceso', 'Transformaci√≥n'],
    'Verdulero': ['Clasificaci√≥n', 'Frescura', 'Rotaci√≥n'],
    'Cajero': ['Verificaci√≥n', 'Exactitud', 'Flujo'],
    'Mozo': ['Presencia', 'Coordinaci√≥n', 'Ritmo'],
    'Cocinero': ['Secuencia', 'Preparaci√≥n', 'Resultado'],
    'M√∫sico': ['Ritmo', 'Ejecuci√≥n', 'Expresi√≥n'],
    'Actor': ['Representaci√≥n', 'Registro', 'Presencia'],
    'Bailar√≠n': ['Movimiento', 'Equilibrio', 'Control'],
    'Locutor': ['Modulaci√≥n', 'Claridad', 'Emisi√≥n'],
    'DJ': ['Selecci√≥n', 'Transici√≥n', 'Clima'],
    'Entrenador': ['Planificaci√≥n', 'Proceso', 'Seguimiento'],
    '√Årbitro': ['Criterio', 'L√≠mite', 'Decisi√≥n'],
    'Futbolista': ['Coordinaci√≥n', 'Lectura', 'Ejecuci√≥n'],
    'Guardia de seguridad': ['Vigilancia', 'Prevenci√≥n', 'Presencia'],
    'Portero': ['Control', 'Acceso', 'Custodia']
        },
        'Deportes': {
          'F√∫tbol': ['Espacio', 'Lectura', 'Oportunidad'],
    'B√°squet': ['Ritmo', 'Decisi√≥n', 'Altura'],
    'Tenis': ['Intervalo', 'Precisi√≥n', 'Duelo'],
    'Voley': ['Suspensi√≥n', 'Turno', 'Coordinaci√≥n'],
    'Rugby': ['Contacto', 'Avance', 'Sacrificio'],
    'Nataci√≥n': ['Continuidad', 'Resistencia', 'Medio'],
    'Atletismo': ['Marca', 'L√≠mite', 'Progresi√≥n'],
    'Boxeo': ['Tensi√≥n', 'Umbral', 'Respuesta'],
    'Ciclismo': ['Inercia', 'Trayectoria', 'Esfuerzo'],
    'Hockey': ['Velocidad', 'Control', 'Superficie'],
    'Paddle': ['Rebote', 'Lectura', 'Espacio'],
    'Golf': ['Aislamiento', 'Exactitud', 'Espera'],
    'Automovilismo': ['Trayectoria', 'Riesgo', 'Decisi√≥n'],
    'Equitaci√≥n': ['Sincron√≠a', 'Dominio', 'Confianza'],
    'Handball': ['Impulso', 'Secuencia', 'Contacto'],
    'Pesca': ['Paciencia', 'Azar', 'Tensi√≥n'],
    'Escalada': ['Progresi√≥n', 'Agarre', 'Elecci√≥n'],
    'Esqu√≠': ['Pendiente', 'Fluidez', 'Equilibrio'],
    'Snowboard': ['Deslizamiento', 'Estilo', 'Ruptura'],
    'Patinaje': ['Inercia', 'Control', 'Est√©tica'],
    'Gimnasia': ['Precisi√≥n', 'Forma', 'Dominio'],
    'Pesas': ['Carga', 'L√≠mite', 'Voluntad'],
    'Yoga': ['Conciencia', 'Respiraci√≥n', 'Estabilidad'],
    'Taekwondo': ['Distancia', 'Explosi√≥n', 'Control'],
    'Judo': ['Equilibrio', 'Uso', 'Redirecci√≥n'],
    'Karate': ['Forma', 'Impacto', 'Contenci√≥n'],
    'Esgrima': ['Tiempo', 'Distancia', 'Intenci√≥n'],
    'Tiro': ['Quietud', 'Enfoque', 'Decisi√≥n'],
    'Arco y flecha': ['Tensi√≥n', 'Direcci√≥n', 'Soltura'],
    'Polo': ['Velocidad', 'Coordinaci√≥n', 'Campo'],
    'Remo': ['Ritmo', 'Repetici√≥n', 'Sincron√≠a'],
    'Canotaje': ['Flujo', 'Direcci√≥n', 'Resistencia'],
    'Vela': ['Lectura', 'Adaptaci√≥n', 'Incertidumbre'],
    'Surf': ['Espera', 'Momento', 'Equilibrio'],
    'Skate': ['Riesgo', 'Creatividad', 'Fluidez'],
    'BMX': ['Impulso', 'Aire', 'Precisi√≥n'],
    'Motocross': ['Terreno', 'Impacto', 'Resistencia'],
    'Rally': ['Trayectoria', 'Incertidumbre', 'Control'],
    'Karting': ['Reacci√≥n', 'Curva', 'Competencia'],
    'Truco': ['Enga√±o', 'Lectura', 'Memoria'],
    'Ajedrez': ['Anticipaci√≥n', 'Sacrificio', 'Estructura'],
    'Pool': ['√Ångulo', 'Secuencia', 'Control'],
    'Bowling': ['Repetici√≥n', 'Ajuste', 'Resultado'],
    'Tejo': ['Precisi√≥n', 'Deslizamiento', 'Objetivo'],
    'Parapente': ['Suspensi√≥n', 'Corriente', 'Confianza'],
    'Parkour': ['Trayecto', 'Decisi√≥n', 'Continuidad'],
    'CrossFit': ['Intensidad', 'L√≠mite', 'Volumen'],
    'Spinning': ['Ritmo', 'Persistencia', 'Carga'],
    'Running': ['Cadencia', 'Duraci√≥n', 'Soledad'],
    'Caminata': ['Ritmo', 'Presencia', 'Continuidad']
        },
        'Pa√≠ses': {
          'Argentina': '',
          'Brasil': '',
          'Chile': '',
          'Uruguay': '',
          'Paraguay': '',
          'Bolivia': '',
          'Per√∫': '',
          'Colombia': '',
          'Venezuela': '',
          'Ecuador': '',
          'M√©xico': '',
          'Estados Unidos': '',
          'Canad√°': '',
          'Espa√±a': '',
          'Francia': '',
          'Italia': '',
          'Alemania': '',
          'Inglaterra': '',
          'Portugal': '',
          'Holanda': '',
          'B√©lgica': '',
          'Suiza': '',
          'Austria': '',
          'Grecia': '',
          'Rusia': '',
          'Ucrania': '',
          'Polonia': '',
          'Turqu√≠a': '',
          'Suecia': '',
          'Noruega': '',
          'Dinamarca': '',
          'Finlandia': '',
          'Irlanda': '',
          'Escocia': '',
          'Croacia': '',
          'Serbia': '',
          'Rumania': '',
          'Hungr√≠a': '',
          'Rep√∫blica Checa': '',
          'China': '',
          'Jap√≥n': '',
          'Corea del Sur': '',
          'India': '',
          'Tailandia': '',
          'Vietnam': '',
          'Indonesia': '',
          'Filipinas': '',
          'Australia': '',
          'Nueva Zelanda': '',
          'Egipto': '',
          'Marruecos': '',
          'Sud√°frica': '',
          'Nigeria': '',
          'Kenia': '',
          'Israel': '',
          'Arabia Saudita': '',
          'Emiratos √Årabes': '',
          'Ir√°n': '',
          'Irak': '',
          'Afganist√°n': '',
          'Pakist√°n': '',
          'Cuba': '',
          'Jamaica': '',
          'Panam√°': '',
          'Costa Rica': '',
          'Guatemala': '',
          'Rep√∫blica Dominicana': '',
          'Puerto Rico': '',
          'Honduras': '',
          'Nicaragua': '',
          'El Salvador': ''
        },
        'Comida': {
          'Pizza': '',
          'Hamburguesa': '',
          'Asado': '',
          'Empanadas': '',
          'Milanesa': '',
          'Chorip√°n': '',
          'Locro': '',
          'Humita': '',
          'Tamales': '',
          'Pastel de papa': '',
          'Ravioles': '',
          '√ëoquis': '',
          'Tallarines': '',
          'Lasa√±a': '',
          'Canelones': '',
          'Risotto': '',
          'Polenta': '',
          'Guiso': '',
          'Puchero': '',
          'Carbonada': '',
          'Matambre': '',
          'Vac√≠o': '',
          'Bife de chorizo': '',
          'Costillas': '',
          'Provoleta': '',
          'Picada': '',
          'S√°ndwich de miga': '',
          'Tostado': '',
          'Pancho': '',
          'Pizza a la parrilla': '',
          'Fugazzeta': '',
          'Fain√°': '',
          'Medialunas': '',
          'Facturas': '',
          'Alfajores': '',
          'Dulce de leche': '',
          'Arroz con leche': '',
          'Flan': '',
          'Churros': '',
          'Torta frita': '',
          'Sushi': '',
          'Tacos': '',
          'Burritos': '',
          'Nachos': '',
          'Hot dog': '',
          'Papas fritas': '',
          'Pollo frito': '',
          'Paella': '',
          'Tortilla espa√±ola': '',
          'Ceviche': '',
          'Sorrentinos': '',
          'Agnolotis': '',
          'Cappellettis': '',
          'Fideos': '',
          'Spaghetti': '',
          'Mostacholes': '',
          'Tirabuz√≥n': '',
          'Carbonara': '',
          'Pesto': '',
          'Tuco': '',
          'Salsa blanca': '',
          'Salsa bolognesa': '',
          'Pizza napolitana': '',
          'Muzzarella': '',
          'Calzone': '',
          'Focaccia': '',
          'Milanesa napolitana': '',
          'Milanesa a caballo': '',
          'Suprema': '',
          'Pollo al horno': '',
          'Pollo a la parrilla': '',
          'Pata muslo': '',
          'Bondiola': '',
          'Morcilla': '',
          'Chinchul√≠n': '',
          'Ri√±√≥n': '',
          'Mollejas': '',
          'Entra√±a': '',
          'Tira de asado': '',
          'Colita de cuadril': '',
          'Osobuco': '',
          'Estofado': '',
          'Cazuela': '',
          'Guiso de lentejas': '',
          'Guiso de mondongo': '',
          'Mondongo': '',
          'Buseca': '',
          'Sopa': '',
          'Caldo': '',
          'Caldo de pollo': '',
          'Minestrone': '',
          'Crema de verduras': '',
          'Gazpacho': '',
          'Sandwich': '',
          'Lomito': '',
          'Milanesa al pan': '',
          'Hamburguesa completa': '',
          'Panchos completos': '',
          'Bondiola al pan': '',
          'Vac√≠o al pan': '',
          'Churrip√°n': '',
          'Morcip√°n': '',
          'Pancho con papas': '',
          'Papas espa√±olas': '',
          'Papas noisette': '',
          'Papas souffl√©': '',
          'Pur√©': '',
          'Pur√© mixto': '',
          'Ensalada': '',
          'Ensalada C√©sar': '',
          'Ensalada rusa': '',
          'Ensalada mixta': '',
          'Ensalada caprese': '',
          'Tomate relleno': '',
          'Papa rellena': '',
          'Morrones rellenos': '',
          'Tarta': '',
          'Tarta de verdura': '',
          'Tarta pascualina': '',
          'Quiche': '',
          'Empanada de carne': '',
          'Empanada de pollo': '',
          'Empanada de jam√≥n y queso': '',
          'Empanada de humita': '',
          'Empanada tucumana': '',
          'Empanada salte√±a': '',
          'Empanada √°rabe': '',
          'Ramen': '',
          'Pad Thai': '',
          'Wok': '',
          'Chow mein': '',
          'Arroz frito': '',
          'Pollo agridulce': '',
          'Pato laqueado': '',
          'Dim sum': '',
          'Gyozas': '',
          'Spring rolls': '',
          'Falafel': '',
          'Shawarma': '',
          'Kebab': '',
          'Hummus': '',
          'Baklava': '',
          'Curry': '',
          'Tikka masala': '',
          'Naan': '',
          'Samosas': '',
          'Biryani': '',
          'Pad see ew': '',
          'Tom yum': '',
          'Pho': '',
          'Banh mi': '',
          'Kimchi': '',
          'Bibimbap': '',
          'Bulgogi': '',
          'Fish and chips': '',
          'Roast beef': '',
          'Shepherd pie': '',
          'Bangers and mash': '',
          'Croissant': '',
          'Baguette': '',
          'Crepe': '',
          'Queso brie': '',
          'Fondue': '',
          'Raclette': '',
          'Pretzels': '',
          'Bratwurst': '',
          'Schnitzel': '',
          'Strudel': '',
          'Goulash': '',
          'Pierogi': '',
          'Moussaka': '',
          'Tzatziki': '',
          'Souvlaki': '',
          'Fajitas': '',
          'Quesadillas': '',
          'Enchiladas': '',
          'Guacamole': '',
          'Chili con carne': '',
          'Mac and cheese': '',
          'Waffles': '',
          'Pancakes': '',
          'Donas': '',
          'Muffins': '',
          'Bagels': '',
          'Cheesecake': '',
          'Brownies': '',
          'Cookies': '',
          'Tiramis√∫': '',
          'Panna cotta': '',
          'Gelato': '',
          'Cannoli': '',
          'Profiteroles': '',
          '√âclair': '',
          'Macarons': '',
          'Cr√®me br√ªl√©e': '',
          'Mousse de chocolate': '',
          'Pavlova': '',
          'Trifle': '',
          'Carrot cake': '',
          'Red velvet': '',
          'Lemon pie': '',
          'Chocotorta': '',
          'Rogel': '',
          'Marquise': '',
          'Pasta': '',
          'Helado': 'Postre fr√≠o y dulce'
        },
        'Pel√≠culas y Series': {
          'Titanic': '',
          'El Padrino': '',
          'Star Wars': '',
          'Toy Story': '',
          'El Rey Le√≥n': '',
          'Jurassic Park': '',
          'Volver al Futuro': '',
          'Rocky': '',
          'Matrix': '',
          'Avatar': '',
          'Avengers': '',
          'Iron Man': '',
          'Spider-Man': '',
          'Batman': '',
          'Harry Potter': '',
          'El Se√±or de los Anillos': '',
          'Piratas del Caribe': '',
          'R√°pido y Furioso': '',
          'Misi√≥n Imposible': '',
          'Indiana Jones': '',
          'E.T.': '',
          'Tibur√≥n': '',
          'Shrek': '',
          'Buscando a Nemo': '',
          'Frozen': '',
          'Coco': '',
          'El Secreto de sus Ojos': '',
          'Nueve Reinas': '',
          'Relatos Salvajes': '',
          'El Clan': '',
          'Esperando la Carroza': '',
          'Metegol': '',
          'Breaking Bad': '',
          'Game of Thrones': '',
          'Friends': '',
          'Los Simpsons': '',
          'Stranger Things': '',
          'The Walking Dead': '',
          'La Casa de Papel': '',
          'Narcos': '',
          'Los Serrano': '',
          'Casados con Hijos': '',
          'Los Simuladores': '',
          'El Marginal': '',
          'Okupas': '',
          'Tumberos': '',
          'Son Amores': '',
          'Chiquititas': '',
          'Rebelde Way': '',
          'Floricienta': '',
          'Violetta': '',
          'Soy Luna': '',
          'The Office': '',
          'How I Met Your Mother': '',
          'The Big Bang Theory': '',
          'Brooklyn Nine-Nine': '',
          'Parks and Recreation': '',
          'Modern Family': '',
          'Two and a Half Men': '',
          'Seinfeld': '',
          'Forrest Gump': '',
          'Gladiador': '',
          'El Origen': '',
          'Interestelar': '',
          'Joker': '',
          'Pulp Fiction': '',
          'Django': '',
          'El Lobo de Wall Street': '',
          'Fight Club': '',
          'Seven': '',
          'El Sexto Sentido': '',
          'It': '',
          'Saw': '',
          'El Conjuro': '',
          'Scream': '',
          'The Crown': '',
          'Peaky Blinders': '',
          'Sherlock': '',
          'Black Mirror': '',
          'Dark': '',
          'The Witcher': '',
          'The Mandalorian': '',
          'The Boys': '',
          'Euphoria': '',
          'Wednesday': '',
          'Squid Game': '',
          'All of Us Are Dead': '',
          'El Juego del Calamar': '',
          'Merl√≠': '',
          'Elite': '',
          'Vis a Vis': '',
          'Money Heist': '',
          'Pepe Grillo': '',
          'CQC': '',
          'Showmatch': '',
          'Duro de Matar': '',
          'Top Gun': '',
          'La Momia': '',
          'El Pianista': '',
          'La Lista de Schindler': '',
          'La Vida es Bella': '',
          'Am√©lie': '',
          'Los Miserables': '',
          'Casablanca': '',
          'Grease': '',
          'Dirty Dancing': '',
          'High School Musical': '',
          'La La Land': '',
          'Bohemian Rhapsody': '',
          'The Greatest Showman': '',
          'Grey ¬¥s Anatomy': '',
          'House': '',
          'Dexter': '',
          'Prison Break': '',
          'Lost': '',
          'Heroes': '',
          'Supernatural': '',
          'Lucifer': '',
          'The Vampire Diaries': '',
          'Riverdale': '',
          'Gossip Girl': '',
          '13 Reasons Why': '',
          'Sex Education': '',
          'La Que Se Avecina': '',
          'El Chavo del 8': '',
          'Chespirito': ''
        },
        'Objetos': {
          'Mate': '',
          'Bombilla': '',
          'Termo': '',
          'Pava': '',
          'Yerba': '',
          'Alfajor': '',
          'Dulce de leche': '',
          'Fac√≥n': '',
          'Boleadoras': '',
          'Poncho': '',
          'Boina': '',
          'Bombacha de gaucho': '',
          'Alpargatas': '',
          'Asado': '',
          'Parrilla': '',
          'Changuito': '',
          'Sif√≥n': '',
          'Ping√ºino': '',
          'Cama': '',
          'Colch√≥n': '',
          'Almohada': '',
          'S√°bana': '',
          'Frazada': '',
          'Mesa': '',
          'Silla': '',
          'Sill√≥n': '',
          'Sof√°': '',
          'Televisor': '',
          'Control remoto': '',
          'Celular': '',
          'Cargador': '',
          'Auriculares': '',
          'Computadora': '',
          'Notebook': '',
          'Teclado': '',
          'Mouse': '',
          'Monitor': '',
          'Impresora': '',
          'Router': '',
          'L√°mpara': '',
          'Foco': '',
          'Linterna': '',
          'Vela': '',
          'F√≥sforo': '',
          'Encendedor': '',
          'Espejo': '',
          'Reloj': '',
          'Despertador': '',
          'Ventilador': '',
          'Estufa': '',
          'Aire acondicionado': '',
          'Heladera': '',
          'Freezer': '',
          'Microondas': '',
          'Horno': '',
          'Cocina': '',
          'Licuadora': '',
          'Batidora': '',
          'Tostadora': '',
          'Pava el√©ctrica': '',
          'Cafetera': '',
          'Exprimidor': '',
          'Jarra': '',
          'Vaso': '',
          'Taza': '',
          'Plato': '',
          'Bowl': '',
          'Tenedor': '',
          'Cuchillo': '',
          'Cuchara': '',
          'Cuchar√≥n': '',
          'Esp√°tula': '',
          'Pinzas': '',
          'Colador': '',
          'Rallador': '',
          'Pelador': '',
          'Abrelatas': '',
          'Sacacorchos': '',
          'Tabla de cortar': '',
          'Olla': '',
          'Cacerola': '',
          'Sart√©n': '',
          'Wok': '',
          'Fuente': '',
          'Bandeja': '',
          'Tupperware': '',
          'Botella': '',
          'Termo stanley': '',
          'Bid√≥n': '',
          'Servilleta': '',
          'Repasador': '',
          'Trapo de piso': '',
          'Esponja': '',
          'Detergente': '',
          'Lavandina': '',
          'Desinfectante': '',
          'Jab√≥n': '',
          'Escoba': '',
          'Pala': '',
          'Balde': '',
          'Trapeador': '',
          'Secador de piso': '',
          'Escurridor': '',
          'Cepillo': '',
          'Plumero': '',
          'Aspiradora': '',
          'Lavarropas': '',
          'Secarropas': '',
          'Plancha': '',
          'Tabla de planchar': '',
          'Perchero': '',
          'Gancho': '',
          'Tender': '',
          'Broche': '',
          'Canasto': '',
          'Cesto de basura': '',
          'Bolsa de residuos': '',
          'Inodoro': '',
          'Bidet': '',
          'Ducha': '',
          'Ba√±era': '',
          'Canilla': '',
          'Lavabo': '',
          'Toalla': '',
          'Toall√≥n': '',
          'Cortina de ba√±o': '',
          'Alfombra de ba√±o': '',
          'Papel higi√©nico': '',
          'Jab√≥n l√≠quido': '',
          'Shampoo': '',
          'Acondicionador': '',
          'Crema de enjuague': '',
          'Gel de ducha': '',
          'Esponja de ba√±o': '',
          'Cepillo de dientes': '',
          'Pasta dental': '',
          'Hilo dental': '',
          'Enjuague bucal': '',
          'Peine': '',
          'Cepillo de pelo': '',
          'Secador de pelo': '',
          'Plancha de pelo': '',
          'Afeitadora': '',
          'Espuma de afeitar': '',
          'Perfume': '',
          'Desodorante': '',
          'Crema': '',
          'Protector solar': '',
          'Maquillaje': '',
          'Algod√≥n': '',
          'Cotonete': '',
          'Tijera': '',
          'Pinza de depilar': '',
          'Cortau√±as': '',
          'Lima de u√±as': '',
          'Balanza': '',
          'Botiqu√≠n': '',
          'Term√≥metro': '',
          'Curitas': '',
          'Vendas': '',
          'Alcohol': '',
          'Agua oxigenada': '',
          'Remedio': '',
          'Pastillas': '',
          'Jarabe': '',
          'Anteojos': '',
          'Lentes de contacto': '',
          'Anteojos de sol': '',
          'Paraguas': '',
          'Piloto': '',
          'Campera': '',
          'Buzo': '',
          'Remera': '',
          'Camisa': '',
          'Pantal√≥n': '',
          'Jean': '',
          'Short': '',
          'Pollera': '',
          'Vestido': '',
          'Zapatillas': '',
          'Zapatos': '',
          'Botas': '',
          'Sandalias': '',
          'Ojotas': '',
          'Medias': '',
          'Cintur√≥n': '',
          'Cartera': '',
          'Mochila': '',
          'Bolso': '',
          'Billetera': '',
          'Llavero': '',
          'Llaves': '',
          'Candado': '',
          'Cerradura': '',
          'Timbre': '',
          'Puerta': '',
          'Ventana': '',
          'Persiana': '',
          'Cortina': '',
          'Cuadro': '',
          'Portarretrato': '',
          'Adorno': '',
          'Florero': '',
          'Planta': '',
          'Maceta': '',
          'Regadera': '',
          'Pala de jard√≠n': '',
          'Rastrillo': '',
          'Manguera': '',
          'Biblioteca': '',
          'Estante': '',
          'Caj√≥n': '',
          'Ropero': '',
          'Placard': '',
          'Escritorio': '',
          'Silla de escritorio': '',
          'Libro': '',
          'Revista': '',
          'Diario': '',
          'Diccionario': '',
          'Cuaderno': '',
          'Carpeta': '',
          'Hoja': '',
          'L√°piz': '',
          'Lapicera': '',
          'Birome': '',
          'Marcador': '',
          'Resaltador': '',
          'Goma de borrar': '',
          'Sacapuntas': '',
          'Regla': '',
          'Comp√°s': '',
          'Transportador': '',
          'Calculadora': '',
          'Cartuchera': '',
          'Mochila escolar': '',
          'Tijera escolar': '',
          'Pegamento': '',
          'Cinta adhesiva': '',
          'Voligoma': '',
          'Plasticola': '',
          'Abrochadora': '',
          'Ganchos': '',
          'Perforadora': '',
          'Clips': '',
          'Broches': '',
          'Archivador': '',
          'Sobre': '',
          'Sello': '',
          'Timbres': '',
          'Tel√©fono': '',
          'C√°mara': '',
          'Videoc√°mara': '',
          'Tr√≠pode': '',
          'Micr√≥fono': '',
          'Parlante': '',
          'Equipo de m√∫sica': '',
          'Radio': '',
          'CD': '',
          'DVD': '',
          'Pendrive': '',
          'Disco duro': '',
          'Tarjeta de memoria': '',
          'Cable': '',
          'Zapatilla el√©ctrica': '',
          'Enchufe': '',
          'Adaptador': '',
          'Pila': '',
          'Bater√≠a': '',
          'Cinta m√©trica': '',
          'Nivel': '',
          'Martillo': '',
          'Destornillador': '',
          'Pinza': '',
          'Alicate': '',
          'Llave inglesa': '',
          'Taladro': '',
          'Sierra': '',
          'Cinta aisladora': '',
          'Tornillo': '',
          'Clavo': '',
          'Tarugos': '',
          'Tuerca': '',
          'Arandela': '',
          'Pegamento universal': '',
          'Silicona': '',
          'Pintura': '',
          'Pincel': '',
          'Rodillo': '',
          'Escalera': '',
          'Banqueta': '',
          'Soga': '',
          'Cuerda': '',
          'Cadena': '',
          'Alambre': '',
          'Bolsa': '',
          'Caja': '',
          'Envase': '',
          'Frasco': '',
          'Lata': ''
        },
        'Lugares': {
          'Playa': '',
          'Monta√±a': '',
          'R√≠o': '',
          'Lago': '',
          'Bosque': '',
          'Selva': '',
          'Desierto': '',
          'Campo': '',
          'Centro comercial': '',
          'Shopping': '',
          'Supermercado': '',
          'Almac√©n': '',
          'Kiosco': '',
          'Farmacia': '',
          'Hospital': '',
          'Cl√≠nica': '',
          'Escuela': '',
          'Universidad': '',
          'Biblioteca': '',
          'Museo': '',
          'Teatro': '',
          'Cine': '',
          'Estadio': '',
          'Cancha': '',
          'Gimnasio': '',
          'Parque': '',
          'Plaza': '',
          'Obelisco': '',
          'Casa Rosada': '',
          'Caminito': '',
          'La Boca': '',
          'Puerto Madero': '',
          'Palermo': '',
          'San Telmo': '',
          'Recoleta': '',
          'Cementerio de la Recoleta': '',
          'Teatro Col√≥n': '',
          'Avenida 9 de Julio': '',
          'Avenida Corrientes': '',
          'Calle Florida': '',
          'Cataratas del Iguaz√∫': '',
          'Glaciar Perito Moreno': '',
          'Ushuaia': '',
          'Tierra del Fuego': '',
          'El Calafate': '',
          'Bariloche': '',
          'Cerro Catedral': '',
          'Villa La Angostura': '',
          'San Mart√≠n de los Andes': '',
          'Mendoza': '',
          'Aconcagua': '',
          'Quebrada de Humahuaca': '',
          'Cerro de los Siete Colores': '',
          'Salta': '',
          'Jujuy': '',
          'Tilcara': '',
          'Purmamarca': '',
          'Cafayate': '',
          'Tucum√°n': '',
          'Taf√≠ del Valle': '',
          'C√≥rdoba': '',
          'Villa Carlos Paz': '',
          'Mar del Plata': '',
          'Pinamar': '',
          'Villa Gesell': '',
          'Caril√≥': '',
          'Costa Atl√°ntica': '',
          'Pen√≠nsula Vald√©s': '',
          'Puerto Madryn': '',
          'Rosario': '',
          'Monumento a la Bandera': '',
          'La Plata': '',
          'Tigre': '',
          'Delta del Tigre': '',
          'Parque Nacional Los Glaciares': '',
          'Parque Nacional Nahuel Huapi': '',
          'Cerro Fitz Roy': '',
          'El Chalt√©n': '',
          'Tren a las Nubes': '',
          'Ruta 40': '',
          'Ruta de los Siete Lagos': '',
          'Ischigualasto': '',
          'Valle de la Luna': '',
          'Talampaya': '',
          'Salinas Grandes': '',
          'Iruya': '',
          'Torre Eiffel': '',
          'Estatua de la Libertad': '',
          'Big Ben': '',
          'Coliseo Romano': '',
          'Torre de Pisa': '',
          'Taj Mahal': '',
          'Gran Muralla China': '',
          'Cristo Redentor': '',
          'Machu Picchu': '',
          'Pir√°mides de Egipto': '',
          '√ìpera de Sydney': '',
          'Sagrada Familia': '',
          'Puerta de Brandenburgo': '',
          'Times Square': '',
          'Central Park': '',
          'Golden Gate': '',
          'Chich√©n Itz√°': '',
          'Stonehenge': '',
          'Parten√≥n': '',
          'Plaza Roja': '',
          'Kremlin': '',
          'Catedral de Notre Dame': '',
          'Louvre': '',
          'Arco de Triunfo': '',
          'Palacio de Buckingham': '',
          'Cataratas del Ni√°gara': '',
          'Gran Ca√±√≥n': '',
          'Petra': '',
          'Monte Everest': '',
          'Burj Khalifa': '',
          'Alhambra': '',
          'Restaurante': '',
          'Bar': '',
          'Caf√©': '',
          'Confiter√≠a': '',
          'Parrilla': '',
          'Pizzer√≠a': '',
          'Hotel': '',
          'Hostel': '',
          'Aeropuerto': '',
          'Terminal de buses': '',
          'Estaci√≥n de tren': '',
          'Puerto': '',
          'Aduana': '',
          'Banco': '',
          'Cajero': '',
          'Correo': '',
          'Comisar√≠a': '',
          'Cuartel de bomberos': '',
          'Iglesia': '',
          'Catedral': '',
          'Templo': '',
          'Mezquita': '',
          'Sinagoga': '',
          'Cementerio': '',
          'Zool√≥gico': '',
          'Acuario': '',
          'Parque de diversiones': '',
          'Feria': '',
          'Mercado': '',
          'Feria americana': '',
          'Casino': '',
          'Boliche': '',
          'Disco': ''
        },
        'Videojuegos': {
          'Minecraft': '',
          'Fortnite': '',
          'GTA V': '',
          'FIFA': '',
          'EA FC': '',
          'Counter Strike': '',
          'Free Fire': '',
          'League of Legends': '',
          'Apex Legends': '',
          'Call of Duty': '',
          'Valorant': '',
          'Roblox': '',
          'Among Us': '',
          'Fall Guys': '',
          'Rocket League': '',
          'Clash Royale': '',
          'Clash of Clans': '',
          'PUBG': '',
          'Brawl Stars': '',
          'Mario': '',
          'Luigi': '',
          'Sonic': '',
          'Pikachu': '',
          'Pac-Man': '',
          'Donkey Kong': '',
          'Link': '',
          'Zelda': '',
          'Kirby': '',
          'Yoshi': '',
          'Bowser': '',
          'Peach': '',
          'Toad': '',
          'Wario': '',
          'Waluigi': '',
          'Crash Bandicoot': '',
          'Spyro': '',
          'Lara Croft': '',
          'Master Chief': '',
          'Kratos': '',
          'Nathan Drake': '',
          'Ellie': '',
          'Joel': '',
          'Steve': '',
          'Alex': '',
          'Creeper': '',
          'Enderman': '',
          'Slenderman': '',
          'Herobrine': '',
          'Ryu': '',
          'Ken': '',
          'Chun-Li': '',
          'Sub-Zero': '',
          'Scorpion': '',
          'Raiden': '',
          'Ezio': '',
          'Altair': '',
          'Cloud': '',
          'Sephiroth': '',
          'Samus': '',
          'Fox McCloud': '',
          'Mega Man': '',
          'Solid Snake': '',
          'Doom Slayer': '',
          'Duke Nukem': '',
          'Rayman': '',
          'Banjo Kazooie': '',
          'Conker': '',
          'Ratchet': '',
          'Clank': '',
          'Jak': '',
          'Daxter': '',
          'Sackboy': '',
          'Knuckles': '',
          'Tails': '',
          'Shadow': '',
          'Amy Rose': '',
          'Dr Eggman': '',
          'Doctor Robotnik': '',
          'Wii': '',
          'PlayStation': '',
          'Xbox': '',
          'Nintendo': '',
          'Switch': '',
          'Game Boy': '',
          'DS': '',
          'PSP': '',
          'Vita': '',
          'Sega': '',
          'Atari': '',
          'Arcade': '',
          'Joystick': '',
          'Mando': '',
          'Control': '',
          'Gamepad': '',
          'Tetris': '',
          'Pong': '',
          'Space Invaders': '',
          'Galaga': '',
          'Street Fighter': '',
          'Mortal Kombat': '',
          'Tekken': '',
          'Dragon Ball': '',
          'Naruto': '',
          'One Piece': '',
          'Pokemon': '',
          'Digimon': '',
          'Yu-Gi-Oh': '',
          'Metal Gear': '',
          'Resident Evil': '',
          'Silent Hill': '',
          'The Last of Us': '',
          'Uncharted': '',
          'God of War': '',
          'Halo': '',
          'Gears of War': '',
          'Tomb Raider': '',
          'Assassins Creed': '',
          'Far Cry': '',
          'Watch Dogs': '',
          'Splinter Cell': '',
          'Prince of Persia': '',
          'Devil May Cry': '',
          'Bayonetta': '',
          'Final Fantasy': '',
          'Kingdom Hearts': '',
          'Persona': '',
          'Metroid': '',
          'Castlevania': '',
          'Mario Kart': '',
          'Super Smash Bros': '',
          'Splatoon': '',
          'Animal Crossing': '',
          'Fire Emblem': '',
          'Xenoblade': '',
          'The Witcher': '',
          'Skyrim': '',
          'Fallout': '',
          'Dark Souls': '',
          'Bloodborne': '',
          'Elden Ring': '',
          'Sekiro': '',
          'Hollow Knight': '',
          'Celeste': '',
          'Undertale': '',
          'Stardew Valley': '',
          'Terraria': '',
          'Ori': '',
          'Cuphead': '',
          'Portal': '',
          'Half-Life': '',
          'Left 4 Dead': '',
          'Team Fortress': '',
          'Dota': '',
          'Overwatch': '',
          'Hearthstone': '',
          'World of Warcraft': '',
          'Diablo': '',
          'StarCraft': '',
          'WarCraft': '',
          'Age of Empires': '',
          'Civilization': '',
          'SimCity': '',
          'The Sims': '',
          'Spore': '',
          'Need for Speed': '',
          'Gran Turismo': '',
          'Forza': '',
          'Mario Bros': '',
          'Donkey Kong Country': '',
          'Metroid Prime': '',
          'Pikmin': '',
          'Star Fox': '',
          'Earthbound': '',
          'Mother': '',
          'F-Zero': '',
          'Punch-Out': '',
          'Wii Sports': '',
          'Wii Fit': '',
          'Just Dance': '',
          'Guitar Hero': '',
          'Rock Band': '',
          'Dance Dance Revolution': '',
          'Beat Saber': '',
          'Angry Birds': '',
          'Candy Crush': '',
          'Plants vs Zombies': '',
          'Geometry Dash': '',
          'Subway Surfers': '',
          'Temple Run': '',
          'Fruit Ninja': '',
          'Cut the Rope': '',
          'Mobile Legends': '',
          'Arena of Valor': '',
          'Genshin Impact': '',
          'Honkai': '',
          'Raid Shadow Legends': ''
        },
        'M√∫sica': {
          'Charly Garc√≠a': '',
          'Gustavo Cerati': '',
          'Soda Stereo': '',
          'Luis Alberto Spinetta': '',
          'Fito P√°ez': '',
          'Los Redondos': '',
          'Patricio Rey': '',
          'Andr√©s Calamaro': '',
          'Sumo': '',
          'Luca Prodan': '',
          'Ser√∫ Gir√°n': '',
          'Sui Generis': '',
          'Almendra': '',
          'Pescado Rabioso': '',
          'Divididos': '',
          'Los Piojos': '',
          'La Renga': '',
          'Callejeros': '',
          'Bersuit Vergarabat': '',
          'Babas√≥nicos': '',
          'Los Enanitos Verdes': '',
          'Rata Blanca': '',
          'V8': '',
          'Herm√©tica': '',
          'Pappo': '',
          'Viejas Locas': '',
          'Las Pelotas': '',
          'Attaque 77': '',
          'Los Aut√©nticos Decadentes': '',
          'Los Fabulosos Cadillacs': '',
          'Vicentico': '',
          'Le√≥n Gieco': '',
          'Mercedes Sosa': '',
          'Soledad': '',
          'Los Chalchaleros': '',
          'Los Nocheros': '',
          'Rodrigo': '',
          'La Mona Jim√©nez': '',
          'Damas Gratis': '',
          'Pablo Lescano': '',
          'Los Palmeras': '',
          'R√°faga': '',
          'Alcides': '',
          'Gilda': '',
          'Antonio R√≠os': '',
          'Duki': '',
          'Bizarrap': '',
          'Trueno': '',
          'Wos': '',
          'Nicki Nicole': '',
          'Mar√≠a Becerra': '',
          'Emilia Mernes': '',
          'Tini Stoessel': '',
          'Cazzu': '',
          'Paulo Londra': '',
          'Lit Killah': '',
          'Khea': '',
          'YSY A': '',
          'Neo Pistea': '',
          'Dillom': '',
          'Bhavi': '',
          'Tiago PZK': '',
          'FMK': '',
          'Rusherking': '',
          'Big One': '',
          'L-Gante': '',
          'Luck Ra': '',
          'Nathy Peluso': '',
          'Ca7riel': '',
          'Paco Amoroso': '',
          'Zoe Gotusso': '',
          'Bandalos Chinos': '',
          'Las Ligas Menores': '',
          'Los Esp√≠ritus': '',
          'Conociendo Rusia': '',
          'Ciro y los Persas': '',
          'La Beriso': '',
          'Las Pastillas del Abuelo': '',
          'Tan Bi√≥nica': '',
          'Miranda': '',
          'Estelares': '',
          'Turf': '',
          'La Vela Puerca': '',
          'No Te Va Gustar': '',
          'Michael Jackson': '',
          'Madonna': '',
          'The Beatles': '',
          'Queen': '',
          'Elvis Presley': '',
          'Bob Marley': '',
          'Nirvana': '',
          'Metallica': '',
          'AC/DC': '',
          'Led Zeppelin': '',
          'Pink Floyd': '',
          'The Rolling Stones': '',
          'U2': '',
          'Coldplay': '',
          'Imagine Dragons': '',
          'Maroon 5': '',
          'Bruno Mars': '',
          'Ed Sheeran': '',
          'Justin Bieber': '',
          'Taylor Swift': '',
          'Ariana Grande': '',
          'Billie Eilish': '',
          'The Weeknd': '',
          'Drake': '',
          'Eminem': '',
          'Rihanna': '',
          'Beyonc√©': '',
          'Lady Gaga': '',
          'Katy Perry': '',
          'Shakira': '',
          'Bad Bunny': '',
          'J Balvin': '',
          'Daddy Yankee': '',
          'Maluma': '',
          'Ozuna': '',
          'Anuel AA': '',
          'Karol G': '',
          'Peso Pluma': '',
          'Feid': '',
          'Rauw Alejandro': '',
          'Rosal√≠a': '',
          'C Tangana': '',
          'Juan Luis Guerra': '',
          'Marc Anthony': '',
          'Luis Miguel': '',
          'Alejandro Sanz': '',
          'Man√°': '',
          'Enanitos Verdes': '',
          'Los Prisioneros': '',
          'Cafe Tacvba': '',
          'Molotov': '',
          'Zo√©': '',
          'Mon Laferte': '',
          'Natalia Lafourcade': '',
          'Rock': '',
          'Pop': '',
          'Cumbia': '',
          'Cuarteto': '',
          'Folklore': '',
          'Tango': '',
          'Trap': '',
          'Reggaeton': '',
          'Hip hop': '',
          'Rap': '',
          'RKT': '',
          'Electr√≥nica': '',
          'House': '',
          'Techno': '',
          'Reggae': '',
          'Ska': '',
          'Punk': '',
          'Metal': '',
          'Heavy metal': '',
          'Blues': '',
          'Jazz': '',
          'Soul': '',
          'Funk': '',
          'Disco': '',
          'Country': '',
          'Salsa': '',
          'Bachata': '',
          'Merengue': '',
          'Balada': '',
          'Bolero': '',
          'Ranchera': '',
          'Mariachi': '',
          'Samba': '',
          'Bossa nova': '',
          'Guitarra': '',
          'Piano': '',
          'Bater√≠a': '',
          'Bajo': '',
          'Viol√≠n': '',
          'Saxof√≥n': '',
          'Trompeta': '',
          'Flauta': '',
          'Arm√≥nica': '',
          'Acorde√≥n': '',
          'Teclado': '',
          'Micr√≥fono': '',
          'Amplificador': '',
          'Parlante': '',
          'Auriculares': '',
          'Bandone√≥n': '',
          'Bombo': '',
          'Charango': '',
          'Quena': '',
          'Ukelele': '',
          'Tambor': '',
          'Pandereta': '',
          'Maracas': '',
          'Bong√≥': '',
          'Congas': '',
          'Sintetizador': ''
        }
      };

      const getRecommendedImpostors = (players) => {
        if (players <= 3) return 1;
        if (players <= 5) return 1;
        if (players <= 7) return 2;
        if (players <= 8) return 2;
        if (players <= 10) return 3;
        if (players <= 12) return 4;
        if (players <= 14) return 4;
        if (players <= 16) return 5;
        if (players <= 18) return 5;
        return 6; // 19-20
      };

      const getMaxImpostors = (players) => {
        // M√°ximo 30% de impostores, pero siempre m√≠nimo 1 y nunca m√°s que jugadores - 1
        const maxPercentage = Math.ceil(players * 0.3);
        return Math.min(maxPercentage, players - 1, Math.max(1, maxPercentage));
      };

      // Calcular el m√°ximo de impostores adicionales seg√∫n la cantidad de jugadores
      const getMaxAdditionalImpostors = (players, currentImpostors) => {
        const maxImpostors = getMaxImpostors(players);
        // El m√°ximo de adicionales es la diferencia entre el m√°ximo permitido y los impostores actuales
        return Math.max(0, maxImpostors - currentImpostors);
      };

      // Ajustar autom√°ticamente el n√∫mero de impostores si excede el m√°ximo permitido
      useEffect(() => {
        const maxImpostors = getMaxImpostors(playerCount);
        if (impostorCount > maxImpostors) {
          setImpostorCount(maxImpostors);
        }
      }, [playerCount, impostorCount]);

      // Ajustar autom√°ticamente la cantidad de impostores adicionales si excede el m√°ximo permitido
      // Usar useRef para rastrear si ya se carg√≥ el valor desde localStorage y evitar resetearlo
      const additionalImpostorsCountLoadedRef = React.useRef(false);
      
      // Marcar como cargado cuando se carga desde localStorage
      useEffect(() => {
        const savedOptions = localStorage.getItem('impostorGameOptions');
        if (savedOptions) {
          try {
            const options = JSON.parse(savedOptions);
            if (options.additionalImpostorsCount !== undefined && options.additionalImpostorsCount >= 1) {
              additionalImpostorsCountLoadedRef.current = true;
            }
          } catch (e) {
            // Ignorar errores
          }
        }
      }, []);
      
      useEffect(() => {
        // Solo desactivar autom√°ticamente si hay menos de 5 jugadores (requisito m√≠nimo)
        if (playerCount < 5) {
          if (additionalImpostorsMode) {
            setAdditionalImpostorsMode(false);
          }
          return;
        }
        
        // Validar l√≠mite del 50% de impostores + roles especiales juntos
        const currentSpecialRoles = (jesterMode ? 1 : 0) + (accompliceMode ? 1 : 0) + (lostMode ? 1 : 0);
        const maxTotal = Math.floor(playerCount * 0.5);
        const currentTotal = impostorCount + currentSpecialRoles;
        const wouldExceedLimit = currentTotal >= maxTotal;
        
        // Nota: Ya no se fuerza la desactivaci√≥n autom√°tica cuando se alcanza el l√≠mite
        // Los botones se deshabilitan mediante wouldExceedLimit para mantener el modo activo
        // pero impedir cambios cuando se alcanza el l√≠mite del 50%
        
        // Si el modo est√° activo y hay 5+ jugadores, solo ajustar el contador si es necesario
        if (additionalImpostorsMode) {
          const maxAdditional = getMaxAdditionalImpostors(playerCount, impostorCount);
          // Validar tambi√©n contra el l√≠mite del 50%
          const additionalImpostorsToCount = (additionalImpostorsProbability > 0) ? additionalImpostorsCount : 0;
          const totalWithImpostors = impostorCount + currentSpecialRoles + additionalImpostorsToCount;
          const wouldExceedWithCurrent = totalWithImpostors > maxTotal;
          
          if (wouldExceedWithCurrent) {
            // Reducir la cantidad para no exceder el l√≠mite
            const maxAllowed = Math.max(0, maxTotal - currentTotal);
            if (additionalImpostorsCount > maxAllowed) {
              setAdditionalImpostorsCount(maxAllowed);
            }
            // Si no hay espacio, desactivar el modo
            if (maxAllowed === 0) {
              setAdditionalImpostorsMode(false);
            }
          }
          
          // Solo ajustar si el valor actual excede el m√°ximo permitido
          // No tocar el valor si est√° dentro del rango v√°lido (1 a maxAdditional) para preservar el valor guardado
          if (maxAdditional > 0) {
            if (additionalImpostorsCount > maxAdditional) {
              // Solo ajustar si excede el m√°ximo
              setAdditionalImpostorsCount(maxAdditional);
            } else if (additionalImpostorsCount < 1 && maxAdditional >= 1) {
              // Solo establecer a 1 si el valor es menor a 1 y hay espacio disponible
              // Pero solo si no se ha cargado desde localStorage (para evitar resetear valores guardados)
              if (!additionalImpostorsCountLoadedRef.current) {
                setAdditionalImpostorsCount(1);
              }
            }
            // Si el valor est√° entre 1 y maxAdditional, no hacer nada para preservar el valor guardado
          }
          // NO desactivar el modo autom√°ticamente si maxAdditional === 0
          // Permitir que el usuario lo active/desactive manualmente
        }
      }, [playerCount, impostorCount, additionalImpostorsMode, jesterMode, accompliceMode, lostMode, additionalImpostorsCount, additionalImpostorsProbability]);

      // Forzar desactivaci√≥n autom√°tica de modos cuando se alcanza el l√≠mite o no hay suficientes jugadores
      useEffect(() => {
        const minPlayersForJester = 5;
        const maxPlayersForJester = 5;
        const canEnableJester = playerCount >= minPlayersForJester && playerCount > maxPlayersForJester;
        const isJesterDisabledByPlayers = !canEnableJester;
        
        const currentSpecialRoles = (accompliceMode ? 1 : 0) + (lostMode ? 1 : 0);
        const additionalImpostorsToCount = (additionalImpostorsMode && additionalImpostorsProbability > 0) ? additionalImpostorsCount : 0;
        const currentTotalSpecial = currentSpecialRoles + additionalImpostorsToCount;
        const maxTotal = Math.floor(playerCount * 0.5);
        const currentTotal = impostorCount + currentTotalSpecial;
        const wouldExceedLimit = !jesterMode && currentTotal >= maxTotal;
        
        if (jesterMode && (isJesterDisabledByPlayers || wouldExceedLimit)) {
          setJesterMode(false);
        }
      }, [playerCount, impostorCount, jesterMode, accompliceMode, lostMode, additionalImpostorsMode, additionalImpostorsCount, additionalImpostorsProbability]);

      useEffect(() => {
        const minPlayersForAccomplice = 6;
        const maxPlayersForAccomplice = 5;
        const minImpostorsForAccomplice = 2;
        const canEnableAccomplice = (playerCount >= minPlayersForAccomplice && playerCount > maxPlayersForAccomplice) || 
                                     (impostorCount >= minImpostorsForAccomplice && playerCount > maxPlayersForAccomplice);
        const isAccompliceDisabledByPlayers = !canEnableAccomplice;
        
        const currentSpecialRoles = (jesterMode ? 1 : 0) + (lostMode ? 1 : 0);
        const additionalImpostorsToCount = (additionalImpostorsMode && additionalImpostorsProbability > 0) ? additionalImpostorsCount : 0;
        const currentTotalSpecial = currentSpecialRoles + additionalImpostorsToCount;
        const maxTotal = Math.floor(playerCount * 0.5);
        const currentTotal = impostorCount + currentTotalSpecial;
        const wouldExceedLimit = !accompliceMode && currentTotal >= maxTotal;
        
        if (accompliceMode && (isAccompliceDisabledByPlayers || wouldExceedLimit)) {
          setAccompliceMode(false);
        }
      }, [playerCount, impostorCount, accompliceMode, jesterMode, lostMode, additionalImpostorsMode, additionalImpostorsCount, additionalImpostorsProbability]);

      useEffect(() => {
        const minPlayersForLost = 5;
        const canEnableLost = playerCount >= minPlayersForLost;
        const isLostDisabledByPlayers = !canEnableLost;
        
        const currentSpecialRoles = (jesterMode ? 1 : 0) + (accompliceMode ? 1 : 0);
        const additionalImpostorsToCount = (additionalImpostorsMode && additionalImpostorsProbability > 0) ? additionalImpostorsCount : 0;
        const currentTotalSpecial = currentSpecialRoles + additionalImpostorsToCount;
        const maxTotal = Math.floor(playerCount * 0.5);
        const currentTotal = impostorCount + currentTotalSpecial;
        const wouldExceedLimit = !lostMode && currentTotal >= maxTotal;
        
        if (lostMode && (isLostDisabledByPlayers || wouldExceedLimit)) {
          setLostMode(false);
        }
      }, [playerCount, impostorCount, lostMode, jesterMode, accompliceMode, additionalImpostorsMode, additionalImpostorsCount, additionalImpostorsProbability]);

      useEffect(() => {
        const minPlayersForAdditional = 5;
        const isDisabledByPlayers = playerCount < minPlayersForAdditional;
        
        const currentSpecialRoles = (jesterMode ? 1 : 0) + (accompliceMode ? 1 : 0) + (lostMode ? 1 : 0);
        const maxTotal = Math.floor(playerCount * 0.5);
        const currentTotal = impostorCount + currentSpecialRoles;
        const wouldExceedLimit = currentTotal >= maxTotal;
        
        if (additionalImpostorsMode && (isDisabledByPlayers || wouldExceedLimit)) {
          setAdditionalImpostorsMode(false);
        }
      }, [playerCount, impostorCount, additionalImpostorsMode, jesterMode, accompliceMode, lostMode]);

      // Ajustar nombres cuando cambia playerCount
      useEffect(() => {
        if (useNames) {
          const currentLength = playerNames.length;
          if (currentLength < playerCount) {
            // Agregar campos vac√≠os si aument√≥ el n√∫mero de jugadores
            setPlayerNames(prev => [...prev, ...Array(playerCount - currentLength).fill('')]);
          } else if (currentLength > playerCount) {
            // Truncar si disminuy√≥ el n√∫mero de jugadores
            setPlayerNames(prev => prev.slice(0, playerCount));
          }
        }
      }, [playerCount, useNames]);

      // Guardar cache autom√°ticamente cuando cambian los nombres o playerCount
      useEffect(() => {
        if (useNames && playerNames.length > 0) {
          const cacheData = {
            playerCount: playerCount,
            names: [...playerNames]
          };
          localStorage.setItem('impostorGameCache', JSON.stringify(cacheData));
        }
      }, [playerNames, playerCount, useNames]);

      const toggleCategory = (cat) => {
        // Verificar si es categor√≠a VIP y si el usuario tiene premium
        const categoryInfo = categoryList.find(c => c.name === cat);
        if (categoryInfo && categoryInfo.premium && !isPremium) {
          // Mostrar modal de desbloqueo
          console.log('Categor√≠a premium detectada, mostrando modal de desbloqueo');
          setShowUnlockModal(true);
          return;
        }
        
        if (categoryMode === 'single') {
          setCategories([cat]);
        } else if (categoryMode === 'multiple') {
          if (categories.includes(cat)) {
            setCategories(categories.filter(c => c !== cat));
          } else {
            setCategories([...categories, cat]);
          }
        }
        // En modo 'all', no se permite cambiar la selecci√≥n (todas est√°n siempre seleccionadas)
      };

      // Funci√≥n para calcular hash SHA-256
      const calculateSHA256 = async (text) => {
        const encoder = new TextEncoder();
        const data = encoder.encode(text);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        return hashHex;
      };

      // Funci√≥n para validar c√≥digo premium
      // El c√≥digo premium es: Q%0>q2Lz
      // Para cambiar el c√≥digo premium en el futuro:
      // 1. Calcula el hash SHA-256 del nuevo c√≥digo usando: await calculateSHA256('NUEVO_CODIGO')
      // 2. Reemplaza 'Q%0>q2Lz' en la l√≠nea siguiente con el nuevo c√≥digo
      const validatePremiumCode = async (code) => {
        try {
          const inputHash = await calculateSHA256(code);
          // Hash del c√≥digo premium "Q%0>q2Lz"
          const correctHash = await calculateSHA256('Q%0>q2Lz');
          
          if (inputHash === correctHash) {
            setIsPremium(true);
            localStorage.setItem('impostorGamePremium', 'true');
            setShowUnlockModal(false);
            setPremiumCodeInput('');
            setPremiumError('');
            return true;
          } else {
            setPremiumError('C√≥digo incorrecto. Intente nuevamente.');
            return false;
          }
        } catch (error) {
          console.error('Error validando c√≥digo:', error);
          setPremiumError('Error al validar el c√≥digo. Intente nuevamente.');
          return false;
        }
      };

      // Funci√≥n para detectar nombres duplicados
      const getDuplicateNameIndices = () => {
        if (!useNames) return [];
        const duplicates = [];
        const nameMap = new Map();
        
        playerNames.forEach((name, index) => {
          const normalizedName = name.trim().toLowerCase();
          if (normalizedName) {
            if (nameMap.has(normalizedName)) {
              duplicates.push(index);
              duplicates.push(nameMap.get(normalizedName));
            } else {
              nameMap.set(normalizedName, index);
            }
          }
        });
        
        return [...new Set(duplicates)];
      };

      const handleNameChange = (index, value) => {
        const newNames = [...playerNames];
        newNames[index] = value;
        setPlayerNames(newNames);
        // Guardar autom√°ticamente en cache
        const cacheData = {
          playerCount: playerCount,
          names: [...newNames]
        };
        localStorage.setItem('impostorGameCache', JSON.stringify(cacheData));
      };

      // Funciones para guardar/cargar perfiles
      useEffect(() => {
        const saved = localStorage.getItem('impostorGameProfiles');
        if (saved) {
          try {
            setSavedProfiles(JSON.parse(saved));
          } catch (e) {
            console.error('Error loading saved profiles:', e);
          }
        }
      }, []);

      // Actualizar iconos con versi√≥n correcta al montar
      useEffect(() => {
        const appleTouchIcon = document.getElementById('apple-touch-icon') || document.querySelector('link[rel="apple-touch-icon"]');
        if (appleTouchIcon) {
          const correctHref = `icon-192.png?v=${ICON_VERSION}`;
          if (!appleTouchIcon.href.includes('?v=' + ICON_VERSION)) {
            appleTouchIcon.href = correctHref;
          }
        }
      }, []);

      // Cargar opciones guardadas al inicio
      useEffect(() => {
        const savedOptions = localStorage.getItem('impostorGameOptions');
        if (savedOptions) {
          try {
            const options = JSON.parse(savedOptions);
            if (options.impostorHints !== undefined) setImpostorHints(options.impostorHints);
            if (options.impostorNeverFirst !== undefined) setImpostorNeverFirst(options.impostorNeverFirst);
            if (options.impostorsKnowEachOther !== undefined) setImpostorsKnowEachOther(options.impostorsKnowEachOther);
            if (options.additionalImpostorsMode !== undefined) setAdditionalImpostorsMode(options.additionalImpostorsMode);
            if (options.additionalImpostorsCount !== undefined && options.additionalImpostorsCount >= 1) {
              setAdditionalImpostorsCount(options.additionalImpostorsCount);
            }
            if (options.additionalImpostorsProbability !== undefined && options.additionalImpostorsProbability >= 0) {
              setAdditionalImpostorsProbability(options.additionalImpostorsProbability);
            }
            if (options.jesterMode !== undefined) setJesterMode(options.jesterMode);
            if (options.accompliceMode !== undefined) setAccompliceMode(options.accompliceMode);
            if (options.lostMode !== undefined) setLostMode(options.lostMode);
            if (options.categoryMode !== undefined) {
              // Convertir 'single' a 'multiple' ya que 'single' ya no est√° disponible
              const mode = options.categoryMode === 'single' ? 'multiple' : options.categoryMode;
              setCategoryMode(mode);
            }
            if (options.categories !== undefined && Array.isArray(options.categories)) {
              setCategories(options.categories);
            }
            if (options.anonymousVoting !== undefined) setAnonymousVoting(options.anonymousVoting);
            if (options.useNames !== undefined) setUseNames(options.useNames);
          } catch (e) {
            console.error('Error loading saved options:', e);
          }
        }
      }, []);

      // Guardar opciones cuando cambian
      useEffect(() => {
        const options = {
          impostorHints,
          impostorNeverFirst,
          impostorsKnowEachOther,
          additionalImpostorsMode,
          additionalImpostorsCount,
          additionalImpostorsProbability,
          jesterMode,
          accompliceMode,
          lostMode,
          categoryMode,
          categories,
          anonymousVoting,
          playerCount,
          impostorCount,
          useNames
        };
        localStorage.setItem('impostorGameOptions', JSON.stringify(options));
      }, [impostorHints, impostorNeverFirst, impostorsKnowEachOther, additionalImpostorsMode, additionalImpostorsCount, additionalImpostorsProbability, jesterMode, accompliceMode, lostMode, categoryMode, categories, anonymousVoting, playerCount, impostorCount, useNames]);

      // Funci√≥n para procesar categor√≠a desde URL (debe estar antes del useEffect que la usa)
      const processCategoryFromUrl = (encodedData) => {
        try {
          const decodedData = JSON.parse(atob(encodedData));
          
          if (!decodedData.name || !decodedData.words || !Array.isArray(decodedData.words)) {
            setImportErrorMsg('El link no tiene el formato correcto. Debe tener "name" y "words" (array).');
            setShowImportErrorModal(true);
            return;
          }
          
          if (decodedData.words.length < 6) {
            setImportErrorMsg('La categor√≠a importada debe tener al menos 6 palabras.');
            setShowImportErrorModal(true);
            return;
          }
          
          // Leer categor√≠as actuales del localStorage para verificar si existe
          const saved = localStorage.getItem('impostorGameCustomCategories');
          let currentCategories = [];
          if (saved) {
            try {
              currentCategories = JSON.parse(saved);
            } catch (e) {
              console.error('Error reading categories:', e);
            }
          }
          
          // Verificar si ya existe
          const exists = currentCategories.some(cat => cat.name === decodedData.name);
          if (exists) {
            setPendingImport(decodedData);
            setShowReplaceCategoryModal(true);
            return;
          }
          
          // Importar directamente si no existe
          const updated = [...currentCategories, decodedData];
          setCustomCategories(updated);
          localStorage.setItem('impostorGameCustomCategories', JSON.stringify(updated));
          categoryWords[decodedData.name] = decodedData.words;
          setImportedCategoryName(decodedData.name);
          setShowImportSuccessModal(true);
          
          // Limpiar la URL despu√©s de importar
          const url = new URL(window.location);
          url.searchParams.delete('import');
          window.history.replaceState({}, '', url);
        } catch (error) {
          setImportErrorMsg('Error al importar la categor√≠a. El link puede estar corrupto o ser inv√°lido.');
          setShowImportErrorModal(true);
          console.error('Import error:', error);
        }
      };

      // Cargar categor√≠as personalizadas al inicio
      useEffect(() => {
        const saved = localStorage.getItem('impostorGameCustomCategories');
        if (saved) {
          try {
            const customCats = JSON.parse(saved);
            setCustomCategories(customCats);
            // Agregar las categor√≠as personalizadas a categoryWords din√°micamente
            customCats.forEach(cat => {
              if (cat.name && cat.words && Array.isArray(cat.words)) {
                categoryWords[cat.name] = cat.words;
              }
            });
          } catch (e) {
            console.error('Error loading custom categories:', e);
          }
        }
        
        // Detectar y procesar categor√≠a desde URL
        const urlParams = new URLSearchParams(window.location.search);
        const importData = urlParams.get('import');
        if (importData) {
          // Esperar un momento para que las categor√≠as se carguen primero
          setTimeout(() => {
            processCategoryFromUrl(importData);
          }, 500);
        }
      }, []);

      // Actualizar categor√≠as autom√°ticamente cuando se est√° en modo 'all' y cambian las categor√≠as personalizadas
      useEffect(() => {
        if (categoryMode === 'all') {
          // Filtrar categor√≠as premium si el usuario no tiene premium
          const availableCategories = categoryList.filter(cat => !cat.premium || isPremium);
          const allCatNames = [...availableCategories.map(c => c.name), ...customCategories.map(c => c.name)];
          setCategories(allCatNames);
        }
      }, [customCategories, categoryMode, isPremium]);

      // Desactivar modos premium si el usuario pierde el premium
      useEffect(() => {
        if (!isPremium) {
          setAdditionalImpostorsMode(false);
          setJesterMode(false);
          setAccompliceMode(false);
          setLostMode(false);
          // Remover VIP de las categor√≠as seleccionadas si est√° presente
          if (categories.includes('VIP')) {
            setCategories(categories.filter(c => c !== 'VIP'));
          }
        }
      }, [isPremium]);

      // Cerrar men√∫ al hacer clic fuera
      useEffect(() => {
        const handleClickOutside = (event) => {
          if (openMenuCategory && !event.target.closest('.category-menu-container')) {
            setOpenMenuCategory(null);
          }
        };
        if (openMenuCategory) {
          document.addEventListener('click', handleClickOutside);
          return () => document.removeEventListener('click', handleClickOutside);
        }
      }, [openMenuCategory]);

      // Funciones para categor√≠as personalizadas
      const addWord = () => {
        const trimmedWord = newWord.trim();
        if (trimmedWord && !customCategoryWords.includes(trimmedWord)) {
          setCustomCategoryWords([...customCategoryWords, trimmedWord]);
          setNewWord('');
        }
      };

      const removeWord = (wordToRemove) => {
        setCustomCategoryWords(customCategoryWords.filter(w => w !== wordToRemove));
      };

      const saveCustomCategory = () => {
        if (customCategoryWords.length < 6) {
          setImportErrorMsg('La categor√≠a debe tener al menos 6 palabras.');
          setShowImportErrorModal(true);
          return;
        }
        
        if (!customCategoryName.trim()) {
          setImportErrorMsg('Por favor, ingresa un nombre para la categor√≠a.');
          setShowImportErrorModal(true);
          return;
        }
        
        const categoryData = {
          name: customCategoryName.trim(),
          emoji: '‚≠ê',
          words: customCategoryWords
        };
        
        let updatedCategories;
        if (editingCustomCategory) {
          // Editar categor√≠a existente
          // Si cambi√≥ el nombre, eliminar el anterior de categoryWords
          if (editingCustomCategory.name !== categoryData.name) {
            delete categoryWords[editingCustomCategory.name];
            // Si estaba seleccionada, actualizar la selecci√≥n
            setCategories(categories.map(c => c === editingCustomCategory.name ? categoryData.name : c));
          }
          updatedCategories = customCategories.map(cat => 
            cat.name === editingCustomCategory.name ? categoryData : cat
          );
        } else {
          // Nueva categor√≠a
          updatedCategories = [...customCategories, categoryData];
        }
        
        setCustomCategories(updatedCategories);
        localStorage.setItem('impostorGameCustomCategories', JSON.stringify(updatedCategories));
        
        // Actualizar categoryWords
        categoryWords[categoryData.name] = categoryData.words;
        
        // Limpiar formulario
        setCustomCategoryName('');
        setCustomCategoryWords([]);
        setNewWord('');
        setShowCustomCategoryEditor(false);
        setEditingCustomCategory(null);
      };

      const deleteCustomCategory = (categoryName) => {
        setCategoryToDelete(categoryName);
        setShowDeleteCategoryModal(true);
      };

      const confirmDeleteCategory = () => {
        if (categoryToDelete) {
          const updated = customCategories.filter(cat => cat.name !== categoryToDelete);
          setCustomCategories(updated);
          localStorage.setItem('impostorGameCustomCategories', JSON.stringify(updated));
          delete categoryWords[categoryToDelete];
          // Si estaba seleccionada, quitarla
          setCategories(categories.filter(c => c !== categoryToDelete));
        }
        setShowDeleteCategoryModal(false);
        setCategoryToDelete(null);
      };

      const confirmReplaceCategory = () => {
        if (pendingImport) {
          const updated = customCategories.map(cat => 
            cat.name === pendingImport.name ? pendingImport : cat
          );
          setCustomCategories(updated);
          localStorage.setItem('impostorGameCustomCategories', JSON.stringify(updated));
          categoryWords[pendingImport.name] = pendingImport.words;
          setImportedCategoryName(pendingImport.name);
          setShowImportSuccessModal(true);
        }
        setShowReplaceCategoryModal(false);
        setPendingImport(null);
      };

      const editCustomCategory = (category) => {
        setEditingCustomCategory(category);
        setCustomCategoryName(category.name);
        setCustomCategoryWords([...category.words]);
        setNewWord('');
        setShowCustomCategoryEditor(true);
      };

      // Funci√≥n para compartir categor√≠a mediante link
      const shareCustomCategory = (category) => {
        // Obtener las palabras de la categor√≠a - puede estar en categoryWords o en category.words
        const words = categoryWords[category.name] || category.words || [];
        
        if (!words || !Array.isArray(words) || words.length === 0) {
          setImportErrorMsg('La categor√≠a no tiene palabras disponibles para compartir.');
          setShowImportErrorModal(true);
          return;
        }
        
        const exportData = {
          name: category.name,
          emoji: category.emoji || '‚≠ê',
          words: words
        };
        
        // Codificar la categor√≠a en base64 para la URL
        const encodedData = btoa(JSON.stringify(exportData));
        // Construir la URL de forma m√°s simple y robusta
        const currentUrl = new URL(window.location.href);
        // Limpiar par√°metros existentes y agregar el import
        currentUrl.search = '';
        currentUrl.searchParams.set('import', encodedData);
        const shareUrl = currentUrl.toString();
        
        // Copiar al portapapeles
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(shareUrl).then(() => {
            showToast(`‚úÖ Link de categor√≠a "${category.name}" copiado al portapapeles`, 'success', 4000);
          }).catch((err) => {
            // Fallback si falla el clipboard
            console.error('Error copying to clipboard:', err);
            fallbackCopyToClipboard(shareUrl, category.name);
          });
        } else {
          // Fallback para navegadores antiguos
          fallbackCopyToClipboard(shareUrl, category.name);
        }
      };

      // Funci√≥n fallback para copiar al portapapeles
      const fallbackCopyToClipboard = (text, categoryName) => {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        textArea.style.top = '-999999px';
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        try {
          const success = document.execCommand('copy');
          if (success) {
            showToast(`‚úÖ Link de categor√≠a "${categoryName}" copiado al portapapeles`, 'success', 4000);
          } else {
            showToast(`‚ùå No se pudo copiar el link. Link: ${text}`, 'error', 6000);
            setImportErrorMsg(`Link para compartir (copia manual):\n${text}`);
            setShowImportErrorModal(true);
          }
        } catch (err) {
          // Si falla, mostrar el link en un modal o alerta
          console.error('Error copying to clipboard:', err);
          showToast(`‚ùå No se pudo copiar el link. Link: ${text}`, 'error', 6000);
          setImportErrorMsg(`Link para compartir (copia manual):\n${text}`);
          setShowImportErrorModal(true);
        }
        document.body.removeChild(textArea);
      };


      // Funciones para manejar la probabilidad de todos impostores
      const getAllImpostorsProbability = () => {
        const today = new Date().toDateString();
        const stored = localStorage.getItem('allImpostorsProbability');
        let data = stored ? JSON.parse(stored) : { 
          probability: 0.5, 
          lastDate: today, 
          gamesWithoutTrigger: 0 
        };
        
        // Reset diario (solo si la probabilidad no es >= 100, para permitir pruebas)
        if (data.lastDate !== today && data.probability < 100) {
          data.probability = 0.5;
          data.lastDate = today;
          data.gamesWithoutTrigger = 0;
        } else if (data.lastDate !== today && data.probability >= 100) {
          // Si es >= 100, solo actualizar la fecha pero mantener la probabilidad
          data.lastDate = today;
        }
        
        return data;
      };

      const updateAllImpostorsProbability = (triggered) => {
        const today = new Date().toDateString();
        const stored = localStorage.getItem('allImpostorsProbability');
        let data = stored ? JSON.parse(stored) : { 
          probability: 0.5, 
          lastDate: today, 
          gamesWithoutTrigger: 0 
        };
        
        // Reset diario
        if (data.lastDate !== today) {
          data.probability = 0.5;
          data.lastDate = today;
          data.gamesWithoutTrigger = 0;
        }
        
        if (triggered) {
          // Si se activ√≥, resetear a 0.5%
          data.probability = 0.5  ;
          data.gamesWithoutTrigger = 0;
        } else {
          // Si no se activ√≥, aumentar probabilidad
          data.gamesWithoutTrigger++;
          if (data.probability < 3) {
            // Subir 0.2% hasta llegar a 3%
            data.probability = Math.min(3, data.probability + 0.2);
          } else if (data.probability < 4) {
            // Subir 0.1% hasta llegar a 4%
            data.probability = Math.min(4, data.probability + 0.1);
          }
        }
        
        localStorage.setItem('allImpostorsProbability', JSON.stringify(data));
      };

      const checkAllImpostorsTrigger = () => {
        // Modo de prueba: siempre activar si est√° habilitado
        if (MODO_PRUEBA_TODOS_IMPOSTORES && playerCount >= 6) {
          console.log('MODO PRUEBA ACTIVO: Todos impostores forzado');
          updateAllImpostorsProbability(true);
          return true;
        }
        
        if (playerCount < 6) {
          console.log('Player count too low:', playerCount);
          return false;
        }
        
        const data = getAllImpostorsProbability();
        const today = new Date().toDateString();
        const isFirstRoundOfDay = data.lastDate !== today;
        
        console.log('Checking all impostors trigger:', {
          probability: data.probability,
          lastDate: data.lastDate,
          today: today,
          isFirstRoundOfDay: isFirstRoundOfDay
        });
        
        // Si la probabilidad es 100% o m√°s, siempre activar
        if (data.probability >= 100) {
          console.log('Probability >= 100, activating all impostors mode');
          updateAllImpostorsProbability(true);
          return true;
        }
        
        // 2% solo en la primera ronda del d√≠a
        if (isFirstRoundOfDay) {
          const firstRoundChance = Math.random() * 100;
          console.log('First round of day, chance:', firstRoundChance);
          if (firstRoundChance < 2) {
            updateAllImpostorsProbability(true);
            return true;
          }
          // Si es la primera ronda y no se activ√≥ el 2%, no aplicar probabilidad acumulada en esta ronda
          updateAllImpostorsProbability(false);
          return false;
        }
        
        // Probabilidad acumulada (solo en rondas despu√©s de la primera del d√≠a)
        const chance = Math.random() * 100;
        console.log('Regular round, chance:', chance, 'probability:', data.probability);
        if (chance < data.probability) {
          console.log('Triggered! Activating all impostors mode');
          updateAllImpostorsProbability(true);
          return true;
        }
        
        console.log('Not triggered');
        updateAllImpostorsProbability(false);
        return false;
      };


      // Cargar cache autom√°ticamente cuando se activa useNames
      useEffect(() => {
        if (useNames) {
          const cached = localStorage.getItem('impostorGameCache');
          if (cached) {
            try {
              const cacheData = JSON.parse(cached);
              // Cargar los nombres del cache
              if (cacheData.playerCount === playerCount && cacheData.names.length > 0) {
                setPlayerNames(prev => {
                  // Solo cargar si no hay nombres ya escritos
                  const hasNames = prev.length > 0 && prev.some(name => name && name.trim() !== '');
                  return hasNames ? prev : [...cacheData.names];
                });
              } else if (cacheData.playerCount < playerCount && cacheData.names.length > 0) {
                // Si hay menos jugadores ahora, cargar los que coincidan y agregar campos vac√≠os
                setPlayerNames(prev => {
                  const hasNames = prev.length > 0 && prev.some(name => name && name.trim() !== '');
                  if (hasNames) return prev;
                  const namesToLoad = [...cacheData.names];
                  while (namesToLoad.length < playerCount) {
                    namesToLoad.push('');
                  }
                  return namesToLoad.slice(0, playerCount);
                });
              } else if (cacheData.playerCount > playerCount && cacheData.names.length > 0) {
                // Si hay m√°s jugadores ahora, cargar los primeros
                setPlayerNames(prev => {
                  const hasNames = prev.length > 0 && prev.some(name => name && name.trim() !== '');
                  return hasNames ? prev : cacheData.names.slice(0, playerCount);
                });
              } else {
                // Si no hay cache v√°lido, inicializar con campos vac√≠os
                setPlayerNames(prev => prev.length === 0 ? Array(playerCount).fill('') : prev);
              }
            } catch (e) {
              console.error('Error loading cache:', e);
              setPlayerNames(prev => prev.length === 0 ? Array(playerCount).fill('') : prev);
            }
          } else {
            // Si no hay cache, inicializar con campos vac√≠os solo si no hay nombres
            setPlayerNames(prev => prev.length === 0 ? Array(playerCount).fill('') : prev);
          }
        }
      }, [useNames, playerCount]);

      const saveProfile = () => {
        // Contar cu√°ntos nombres tienen contenido
        const filledNamesCount = playerNames.filter(name => name && name.trim()).length;
        
        // Validar que haya al menos 3 nombres llenos
        if (filledNamesCount < 3) {
          setImportErrorMsg('Por favor, ingresa al menos 3 nombres antes de guardar el perfil');
          setShowImportErrorModal(true);
          return;
        }
        
        // Si hay m√°s jugadores que el m√≠nimo, todos deben tener nombres
        if (filledNamesCount < playerCount) {
          setImportErrorMsg(`Por favor, completa los nombres de todos los ${playerCount} jugadores antes de guardar el perfil`);
          setShowImportErrorModal(true);
          return;
        }
        
        setProfileNameInput('');
        setShowSaveProfileModal(true);
      };

      const confirmSaveProfile = () => {
        if (!profileNameInput || !profileNameInput.trim()) {
          return;
        }

        const profile = {
          id: Date.now().toString(),
          name: profileNameInput.trim(),
          playerCount: playerCount,
          names: [...playerNames],
          createdAt: new Date().toISOString()
        };

        const updated = [...savedProfiles, profile];
        setSavedProfiles(updated);
        localStorage.setItem('impostorGameProfiles', JSON.stringify(updated));
        setSelectedProfile(profile.id);
        setShowSaveProfileModal(false);
        setProfileNameInput('');
        setImportedCategoryName(`Perfil "${profile.name}" guardado correctamente`);
        setShowImportSuccessModal(true);
      };

      const loadProfile = (profileId) => {
        const profile = savedProfiles.find(p => p.id === profileId);
        if (profile) {
          setPlayerCount(profile.playerCount);
          setPlayerNames([...profile.names]);
          setSelectedProfile(profileId);
          if (!useNames) {
            setUseNames(true);
          }
        }
      };

      const deleteProfile = (profileId, e) => {
        e.stopPropagation();
        setProfileToDelete(profileId);
        setShowDeleteProfileModal(true);
      };

      const confirmDeleteProfile = () => {
        if (profileToDelete) {
          const updated = savedProfiles.filter(p => p.id !== profileToDelete);
          setSavedProfiles(updated);
          localStorage.setItem('impostorGameProfiles', JSON.stringify(updated));
          if (selectedProfile === profileToDelete) {
            setSelectedProfile(null);
          }
        }
        setShowDeleteProfileModal(false);
        setProfileToDelete(null);
      };

      const startGame = () => {
        // Validar nombres duplicados si se usan nombres personalizados
        if (useNames) {
          const duplicateIndices = getDuplicateNameIndices();
          if (duplicateIndices.length > 0) {
            setImportErrorMsg('‚ö†Ô∏è Hay nombres duplicados. Por favor, usa nombres √∫nicos para cada jugador.');
            setShowImportErrorModal(true);
            return;
          }
        }
        
        // REGLA DE BALANCE: M√°ximo 50% de impostores + roles especiales juntos
        const specialRolesCount = (jesterMode ? 1 : 0) + (accompliceMode ? 1 : 0) + (lostMode ? 1 : 0);
        const additionalImpostorsToCount = (additionalImpostorsMode && additionalImpostorsProbability > 0) ? additionalImpostorsCount : 0;
        const totalSpecialCount = specialRolesCount + additionalImpostorsToCount;
        const totalWithImpostors = impostorCount + totalSpecialCount;
        const maxTotal = Math.floor(playerCount * 0.5);
        if (totalWithImpostors > maxTotal) {
          setImportErrorMsg(`‚ö†Ô∏è M√°ximo ${maxTotal} impostores y especiales permitidos (50% de ${playerCount} jugadores). Actualmente tienes ${totalWithImpostors}.`);
          setShowImportErrorModal(true);
          return;
        }
        
        // Reiniciar n√∫mero de ronda al iniciar nueva partida
        setRoundNumber(1);
        
        let selectedCat;
        
        if (categoryMode === 'all') {
          // En modo 'all', elegir una categor√≠a al azar de todas las disponibles (filtrar VIP si no hay premium)
          const availableCategories = categoryList.filter(cat => !cat.premium || isPremium);
          const allCategories = [...availableCategories, ...customCategories];
          selectedCat = allCategories[Math.floor(Math.random() * allCategories.length)].name;
        } else {
          selectedCat = categories[Math.floor(Math.random() * categories.length)];
        }
        
        // Obtener palabras de la categor√≠a - verificar si es una categor√≠a personalizada
        let words = categoryWords[selectedCat];
        if (!words || !Array.isArray(words) || words.length === 0) {
          // Si no est√° en categoryWords, buscar en customCategories
          const customCat = customCategories.find(cat => cat.name === selectedCat);
          if (customCat && customCat.words && Array.isArray(customCat.words)) {
            words = customCat.words;
            // Asegurar que tambi√©n se agregue a categoryWords para futuras referencias
            categoryWords[selectedCat] = words;
          } else {
            // Si a√∫n no se encuentra, usar categor√≠a por defecto
            console.error('Categor√≠a no encontrada:', selectedCat);
            const defaultCat = categoryList[0]?.name || 'Animales';
            selectedCat = defaultCat;
            words = categoryWords[defaultCat] || [];
          }
        }
        
        if (!words || words.length === 0) {
          setImportErrorMsg('La categor√≠a seleccionada no tiene palabras disponibles.');
          setShowImportErrorModal(true);
          return;
        }
        
        const secretWord = words[Math.floor(Math.random() * words.length)];
        // Obtener pista(s) - puede ser string, array de strings, o vac√≠o
        const hintData = wordHints[selectedCat] && wordHints[selectedCat][secretWord] ? wordHints[selectedCat][secretWord] : '';
        // Si es array, seleccionar una pista al azar; si es string, usarlo directamente
        const hint = Array.isArray(hintData) && hintData.length > 0 
          ? hintData[Math.floor(Math.random() * hintData.length)]
          : (hintData || '');
        
        // Verificar si se activa el modo "todos impostores"
        const allImpostorsTriggered = checkAllImpostorsTrigger();
        console.log('All impostors triggered:', allImpostorsTriggered, 'Player count:', playerCount);
        
        // Verificar si se activan impostores adicionales
        let additionalImpostorsTriggered = false;
        let finalImpostorCount = impostorCount;
        
        if (IMPOSTORES_ADICIONALES_HABILITADOS && additionalImpostorsMode && !allImpostorsTriggered && playerCount >= 5 && isPremium) {
          // Verificar probabilidad
          const probability = additionalImpostorsProbability || 0;
          
          if (probability > 0) {
            const chance = Math.random() * 100;
            const shouldActivate = probability >= 100 || chance < probability;
            
            if (shouldActivate) {
              additionalImpostorsTriggered = true;
              // Agregar la cantidad de impostores adicionales seleccionada, pero sin exceder el m√°ximo permitido
              const maxImpostors = getMaxImpostors(playerCount);
              const maxAdditional = getMaxAdditionalImpostors(playerCount, impostorCount);
              const additionalToAdd = Math.min(additionalImpostorsCount, maxAdditional);
              finalImpostorCount = Math.min(impostorCount + additionalToAdd, maxImpostors, playerCount - 1);
              console.log('‚ö° Impostores adicionales activados! Impostores:', impostorCount, '->', finalImpostorCount, '(agregados:', additionalToAdd, ', probabilidad:', probability + '%)');
            } else {
              console.log('‚ö° Impostores adicionales no activados (probabilidad:', probability + '%, chance:', chance.toFixed(2) + ')');
            }
          } else {
            console.log('‚ö° Impostores adicionales no activados (probabilidad: 0%)');
          }
        }
        
        setIsAdditionalImpostorsActive(additionalImpostorsTriggered);
        
        const playerNumbers = Array.from({ length: playerCount }, (_, i) => i + 1);
        // Mejorar sistema de random usando Fisher-Yates shuffle
        const shuffled = [...playerNumbers];
        for (let i = shuffled.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        const impostors = allImpostorsTriggered 
          ? playerNumbers // Todos son impostores
          : shuffled.slice(0, finalImpostorCount);
        
        console.log('Impostors assigned:', impostors, 'All impostors mode:', allImpostorsTriggered, 'Additional impostors:', additionalImpostorsTriggered);
        
        // Asignar buf√≥n si est√° habilitado (aleatorio)
        let jesterNumber = null;
        if (jesterMode && BUFON_MODE_HABILITADO && isPremium) {
          const nonImpostors = playerNumbers.filter(num => !impostors.includes(num));
          if (nonImpostors.length > 0) {
            // Mezclar el array usando Fisher-Yates shuffle
            const shuffledNonImpostors = [...nonImpostors];
            for (let i = shuffledNonImpostors.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [shuffledNonImpostors[i], shuffledNonImpostors[j]] = [shuffledNonImpostors[j], shuffledNonImpostors[i]];
            }
            jesterNumber = shuffledNonImpostors[0];
          }
        }
        
        // Asignar c√≥mplice si est√° habilitado (aleatorio)
        let accompliceNumber = null;
        if (accompliceMode && COMPLICE_MODE_HABILITADO && isPremium) {
          const nonImpostors = playerNumbers.filter(num => !impostors.includes(num) && num !== jesterNumber);
          if (nonImpostors.length > 0) {
            // Mezclar el array usando Fisher-Yates shuffle
            const shuffledNonImpostors = [...nonImpostors];
            for (let i = shuffledNonImpostors.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [shuffledNonImpostors[i], shuffledNonImpostors[j]] = [shuffledNonImpostors[j], shuffledNonImpostors[i]];
            }
            accompliceNumber = shuffledNonImpostors[0];
          }
        }
        
        // Asignar "El Perdido" si est√° habilitado (aleatorio)
        let lostNumber = null;
        let lostWord = null;
        if (lostMode && PERDIDO_MODE_HABILITADO && isPremium) {
          const nonImpostors = playerNumbers.filter(num => !impostors.includes(num) && num !== jesterNumber && num !== accompliceNumber);
          if (nonImpostors.length > 0) {
            // Mezclar el array usando Fisher-Yates shuffle
            const shuffledNonImpostors = [...nonImpostors];
            for (let i = shuffledNonImpostors.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [shuffledNonImpostors[i], shuffledNonImpostors[j]] = [shuffledNonImpostors[j], shuffledNonImpostors[i]];
            }
            lostNumber = shuffledNonImpostors[0];
            
            // Obtener una palabra diferente de la misma categor√≠a
            const availableWords = words.filter(w => w !== secretWord);
            if (availableWords.length > 0) {
              lostWord = availableWords[Math.floor(Math.random() * availableWords.length)];
            } else {
              // Si no hay otras palabras disponibles, usar la misma palabra (caso extremo)
              lostWord = secretWord;
            }
          }
        }
        
        const roles = playerNumbers.map(num => ({
          number: num,
          name: useNames ? playerNames[num - 1] || `Jugador ${num}` : null,
          isImpostor: impostors.includes(num),
          isJester: num === jesterNumber,
          isAccomplice: num === accompliceNumber,
          isLost: num === lostNumber,
          word: impostors.includes(num) ? null : (num === lostNumber ? lostWord : secretWord),
          hint: impostors.includes(num) && impostorHints && PISTAS_HABILITADAS ? hint : null,
          isEliminated: false,
          knowsImpostor: num === accompliceNumber && impostors.length > 0 ? [impostors[Math.floor(Math.random() * impostors.length)]] : null
        }));
        
        // Mezclar roles usando Fisher-Yates shuffle
        const randomOrder = [...roles];
        for (let i = randomOrder.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [randomOrder[i], randomOrder[j]] = [randomOrder[j], randomOrder[i]];
        }
        const finalImpostorCountForDisplay = allImpostorsTriggered ? playerCount : finalImpostorCount;
        
        setGameStarted(randomOrder);
        setSelectedWord(secretWord);
        setSelectedCategory(selectedCat);
        setCurrentPlayerIndex(0);
        setRevealedPlayers([]);
        setRoleRevealed(false);
        setAllRolesRevealed(false);
        setFirstPlayer(null);
        setShowDiscussion(false);
        setShowFinalReveal(false);
        setEliminatedPlayers([]);
        setVotingPlayer(null);
        setRevealingVote(false);
        setImpostorsRemaining(finalImpostorCountForDisplay);
        setIsAllImpostorsMode(allImpostorsTriggered);
        // Guardar el n√∫mero de impostores configurado originalmente para el modo confusi√≥n
        // Siempre guardar el impostorCount original, no el playerCount cuando todos son impostores
        setOriginalImpostorCount(impostorCount);
        setStep(4);
      };

      const revealRole = () => {
        setRoleRevealed(true);
      };

      const nextPlayer = () => {
        const newRevealed = [...revealedPlayers, gameStarted[currentPlayerIndex].number];
        setRevealedPlayers(newRevealed);
        setRoleRevealed(false);
        
        if (currentPlayerIndex + 1 < gameStarted.length) {
          setCurrentPlayerIndex(currentPlayerIndex + 1);
        } else {
          // Ir directamente a la discusi√≥n
          selectFirstPlayerAndStartDiscussion();
        }
      };

      const startDiscussion = () => {
        setShowDiscussion(true);
      };

      const votePlayer = (player) => {
        if (anonymousVoting) {
          // Modo an√≥nimo: seleccionar jugador objetivo para el voto actual
          setSelectedVoteTarget(player);
        } else {
          // Modo p√∫blico: seleccionar jugador para votar (como antes)
          setVotingPlayer(player);
        }
      };

      const startAnonymousVoting = () => {
        setVotingStarted(true);
        setCurrentVotingPlayerIndex(0);
        setAnonymousVotes({});
        setSelectedVoteTarget(null);
        setLockUnlocked(false);
      };

      const confirmAnonymousVote = () => {
        if (!selectedVoteTarget) return;
        
        const activePlayers = gameStarted.filter(p => !p.isEliminated);
        const currentPlayer = activePlayers[currentVotingPlayerIndex];
        
        // Guardar el voto del jugador actual
        setAnonymousVotes(prev => ({
          ...prev,
          [currentPlayer.number]: selectedVoteTarget.number
        }));
        
        // Si hay m√°s jugadores, pasar al siguiente
        if (currentVotingPlayerIndex < activePlayers.length - 1) {
          setCurrentVotingPlayerIndex(prev => prev + 1);
          setSelectedVoteTarget(null);
          setLockUnlocked(false); // Resetear candado para el siguiente jugador
        } else {
          // Todos han votado, calcular y mostrar resultado
          calculateVotingResult();
        }
      };

      const calculateVotingResult = () => {
        // Contar votos
        const voteCounts = {};
        Object.values(anonymousVotes).forEach(votedFor => {
          voteCounts[votedFor] = (voteCounts[votedFor] || 0) + 1;
        });
        
        // Encontrar el m√°s votado
        let maxVotes = 0;
        let mostVotedNumber = null;
        Object.entries(voteCounts).forEach(([playerNum, count]) => {
          if (count > maxVotes) {
            maxVotes = count;
            mostVotedNumber = parseInt(playerNum);
          }
        });
        
        // Si hay empate, usar el primero encontrado
        const playerToEliminate = mostVotedNumber ? gameStarted.find(p => p.number === mostVotedNumber) : null;
        
        if (playerToEliminate) {
          setVotingPlayer(playerToEliminate);
          setRevealingVote(true);
        }
      };

      const confirmVote = () => {
        if (anonymousVoting) {
          setRevealingVote(true);
        } else {
          // En modo p√∫blico, el voto ya se registr√≥, solo mostrar resultado
          setRevealingVote(true);
        }
      };

      // Funci√≥n para obtener el jugador m√°s votado en modo p√∫blico
      const getMostVotedPlayer = () => {
        const voteCounts = {};
        Object.values(publicVotes).forEach(votedFor => {
          voteCounts[votedFor] = (voteCounts[votedFor] || 0) + 1;
        });
        
        let maxVotes = 0;
        let mostVoted = null;
        Object.entries(voteCounts).forEach(([playerNum, count]) => {
          if (count > maxVotes) {
            maxVotes = count;
            mostVoted = parseInt(playerNum);
          }
        });
        
        return mostVoted ? gameStarted.find(p => p.number === mostVoted) : null;
      };

      const continueAfterVote = () => {
        // Determinar qu√© jugador eliminar
        let playerToEliminate = votingPlayer;
        if (!anonymousVoting && !playerToEliminate) {
          // En modo p√∫blico, usar el m√°s votado
          playerToEliminate = getMostVotedPlayer();
        }
        
        if (!playerToEliminate) return;
        
        // Verificar si el buf√≥n fue eliminado (gana solo) - ANTES de actualizar el estado
        // REGLA DE BALANCE: Buf√≥n no puede ganar si lo matan en la primera ronda
        if (playerToEliminate.isJester) {
          const updatedPlayers = gameStarted.map(p => 
            p.number === playerToEliminate.number 
              ? { ...p, isEliminated: true }
              : p
          );
          setGameStarted(updatedPlayers);
          setEliminatedPlayers([...eliminatedPlayers, playerToEliminate.number]);
          
          // Si es la primera ronda, el buf√≥n NO gana
          if (roundNumber === 1) {
            // El buf√≥n fue eliminado pero no gana en la primera ronda
            // Mostrar pantalla de revelaci√≥n con bot√≥n "Continuar Juego"
            setVotingPlayer(playerToEliminate);
            setRevealingVote(true);
            
            // Limpiar votos p√∫blicos y resetear estado de votaci√≥n an√≥nima
            if (!anonymousVoting) {
              setPublicVotes({});
            } else {
              setVotingStarted(false);
              setCurrentVotingPlayerIndex(0);
              setAnonymousVotes({});
              setSelectedVoteTarget(null);
            }
            
            // NO incrementar ronda todav√≠a - se har√° cuando se presione "Continuar Juego"
            return;
          }
          
          // Si no es la primera ronda, el buf√≥n gana normalmente
          setWinners('jester');
          // Limpiar votos y estados de votaci√≥n
          if (!anonymousVoting) {
            setPublicVotes({});
          } else {
            setVotingStarted(false);
            setCurrentVotingPlayerIndex(0);
            setAnonymousVotes({});
            setSelectedVoteTarget(null);
          }
          setVotingPlayer(null);
          setRevealingVote(false);
          setFinalRevealedPlayers([]);
          setCurrentlyRevealingPlayer(null);
          setCardFlipped(false);
          // Mostrar pantalla de victoria del buf√≥n directamente
          setShowFinalReveal(true);
          return;
        }
        
        const updatedPlayers = gameStarted.map(p => 
          p.number === playerToEliminate.number 
            ? { ...p, isEliminated: true }
            : p
        );
        
        setGameStarted(updatedPlayers);
        setEliminatedPlayers([...eliminatedPlayers, playerToEliminate.number]);
        
        // Incrementar n√∫mero de ronda despu√©s de cada eliminaci√≥n
        setRoundNumber(prev => prev + 1);
        
        // Limpiar votos p√∫blicos y resetear estado de votaci√≥n an√≥nima
        if (!anonymousVoting) {
          setPublicVotes({});
        } else {
          // Resetear estado de votaci√≥n an√≥nima
          setVotingStarted(false);
          setCurrentVotingPlayerIndex(0);
          setAnonymousVotes({});
          setSelectedVoteTarget(null);
        }
        
        let newImpostorsRemaining = impostorsRemaining;
        // Verificar si el jugador eliminado es un impostor (no el que est√° votando)
        if (playerToEliminate && playerToEliminate.isImpostor) {
          newImpostorsRemaining = impostorsRemaining - 1;
          setImpostorsRemaining(newImpostorsRemaining);
        }
        
        // Calcular jugadores restantes
        const remainingPlayers = updatedPlayers.filter(p => !p.isEliminated);
        const remainingCount = remainingPlayers.length;
        
        // Si quedan 2 o menos jugadores, terminar autom√°ticamente la partida
        if (remainingCount <= 2) {
          // Calcular jugadores honestos restantes
          const honestPlayersRemaining = remainingPlayers.filter(p => !p.isImpostor).length;
          const impostorsRemainingCount = remainingPlayers.filter(p => p.isImpostor).length;
          
          // Determinar ganadores
          if (newImpostorsRemaining === 0) {
            // No quedan impostores, ganan los jugadores
            setWinners('players');
          } else if (honestPlayersRemaining === 0) {
            // No quedan jugadores honestos, ganan los impostores
            setWinners('impostors');
          } else if (impostorsRemainingCount >= honestPlayersRemaining) {
            // Hay m√°s o igual cantidad de impostores que jugadores honestos, ganan impostores
            setWinners('impostors');
          } else {
            // Hay m√°s jugadores honestos que impostores, ganan jugadores
            setWinners('players');
          }
          
          setFinalRevealedPlayers([]);
          setCurrentlyRevealingPlayer(null);
          setCardFlipped(false);
          setShowFinalReveal(true);
          return;
        }
        
        // Verificar si todos son impostores (despu√©s de eliminar)
        const allAreImpostors = remainingPlayers.every(p => p.isImpostor);
        
        // Si todos son impostores y quedan m√°s de 2, continuar la partida
        if (allAreImpostors && remainingCount > 2) {
          setVotingPlayer(null);
          setRevealingVote(false);
          return;
        }
        
        // Calcular jugadores honestos restantes (no eliminados, no impostores, no buf√≥n, no c√≥mplice)
        // El buf√≥n y el c√≥mplice se cuentan como civiles para las condiciones de victoria
        const honestPlayersRemaining = updatedPlayers.filter(p => !p.isEliminated && !p.isImpostor).length;
        const impostorsRemainingCount = updatedPlayers.filter(p => !p.isEliminated && p.isImpostor).length;
        
        // Verificar victoria
        if (newImpostorsRemaining === 0) {
          setWinners('players');
          setFinalRevealedPlayers([]);
          setCurrentlyRevealingPlayer(null);
          setCardFlipped(false);
          setShowFinalReveal(true);
          return;
        } else if (honestPlayersRemaining === 0) {
          // Los impostores ganan solo cuando se eliminan TODOS los inocentes
          setWinners('impostors');
          setFinalRevealedPlayers([]);
          setCurrentlyRevealingPlayer(null);
          setCardFlipped(false);
          setShowFinalReveal(true);
          return;
        } else if (impostorsRemainingCount >= honestPlayersRemaining) {
          // Los impostores ganan cuando igualan o superan la cantidad de jugadores honestos
          setWinners('impostors');
          setFinalRevealedPlayers([]);
          setCurrentlyRevealingPlayer(null);
          setCardFlipped(false);
          setShowFinalReveal(true);
          return;
        }
        
        setVotingPlayer(null);
        setRevealingVote(false);
      };

      const playAgain = () => {
        // Reiniciar directamente una nueva partida con las mismas configuraciones
        // Mantener playerCount, useNames, playerNames, categoryMode, categories, etc.
        // Ajustar impostorCount si es necesario seg√∫n el nuevo m√°ximo permitido
        const maxImpostors = getMaxImpostors(playerCount);
        if (impostorCount > maxImpostors) {
          setImpostorCount(maxImpostors);
        }
        
        // Reiniciar estados del juego
        setGameStarted(false);
        setCurrentPlayerIndex(0);
        setRevealedPlayers([]);
        setRoleRevealed(false);
        setAllRolesRevealed(false);
        setFirstPlayer(null);
        setShowDiscussion(false);
        setShowFinalReveal(false);
        setFinalRevealedPlayers([]);
        setCurrentlyRevealingPlayer(null);
        setCardFlipped(false);
        setEliminatedPlayers([]);
        setVotingPlayer(null);
        setRevealingVote(false);
        setImpostorsRemaining(0);
        setWinners(null);
        setSelectedProfile(null);
        
        // Iniciar directamente una nueva partida
        startGame();
      };

      const goToStart = () => {
        setStep(1);
        // Mantener playerCount, useNames y playerNames
        // setPlayerCount(5); - NO resetear
        setCategories([]);
        // Ajustar impostorCount si es necesario seg√∫n el nuevo m√°ximo permitido
        const maxImpostors = getMaxImpostors(playerCount);
        if (impostorCount > maxImpostors) {
          setImpostorCount(maxImpostors);
        }
        // Mantener useNames y playerNames
        // setUseNames(false); - NO resetear
        // setPlayerNames([]); - NO resetear
        // Mantener opciones guardadas (se cargan autom√°ticamente desde localStorage)
        // setImpostorHints(false); - NO resetear, se mantiene desde localStorage
        // setImpostorNeverFirst(false); - NO resetear, se mantiene desde localStorage
        // setImpostorsKnowEachOther(false); - NO resetear, se mantiene desde localStorage
        setGameStarted(false);
        setCurrentPlayerIndex(0);
        setRevealedPlayers([]);
        setRoleRevealed(false);
        setAllRolesRevealed(false);
        setFirstPlayer(null);
        setShowDiscussion(false);
        setShowFinalReveal(false);
        setFinalRevealedPlayers([]);
        setCurrentlyRevealingPlayer(null);
        setCardFlipped(false);
        setEliminatedPlayers([]);
        setVotingPlayer(null);
        setRevealingVote(false);
        setImpostorsRemaining(0);
        setWinners(null);
        setSelectedProfile(null);
        setIsAllImpostorsMode(false);
        setOriginalImpostorCount(0);
        setIsAdditionalImpostorsActive(false);
      };

      const getPlayerDisplay = (player) => {
        if (useNames && player.name) {
          return player.name;
        }
        return `Jugador ${player.number}`;
      };

      const StepIndicator = () => (
        <div className="flex items-center justify-center gap-2 mb-6 sm:mb-8 md:mb-12 flex-wrap px-2 sm:px-4">
          {[1, 2].map((s) => (
            <div key={s} className="flex items-center">
              <div className={`w-8 h-8 sm:w-9 md:w-10 sm:h-9 md:h-10 rounded-full flex items-center justify-center font-bold text-sm sm:text-base md:text-lg transition-all ${
                step >= s 
                  ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-lg shadow-purple-500/50' 
                  : `${isLightMode ? 'bg-gray-300 text-gray-600' : 'bg-gray-800 text-gray-400'}`
              }`}>
                {s}
              </div>
              {s < 2 && <div className={`w-6 sm:w-8 h-1 mx-1 ${step > s ? 'bg-gradient-to-r from-purple-600 to-pink-600' : isLightMode ? 'bg-gray-300' : 'bg-gray-800'}`} />}
            </div>
          ))}
        </div>
      );

      return (
        <>
          <ToastContainer />
          {/* Indicador de estado offline */}
          {!isOnline && (
            <div className="fixed top-0 left-0 right-0 z-40 bg-red-600 text-white text-center py-2 px-4 text-sm font-semibold shadow-lg">
              ‚ö†Ô∏è Sin conexi√≥n a internet - Modo offline activo
            </div>
          )}
          {/* Banner de instalaci√≥n para iOS */}
          {showIOSBanner && (
            <div className={`fixed bottom-0 left-0 right-0 z-50 p-4 ${isLightMode ? 'bg-white border-t-2 border-purple-500' : 'bg-gray-900 border-t-2 border-purple-600'} shadow-2xl`}>
              <div className="max-w-2xl mx-auto flex items-start gap-3">
                <div className="flex-1">
                  {isIOSSafari ? (
                    <>
                      {cameFromOtherBrowser ? (
                        <>
                          <h3 className={`font-semibold text-sm sm:text-base mb-1 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                            ‚úÖ ¬°Perfecto! Ahora est√°s en Safari
                          </h3>
                          <p className={`text-xs sm:text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>
                            Para agregar ARGENTORES a tu pantalla de inicio, toca el bot√≥n <span className="font-semibold">Compartir</span> <svg className="inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"/></svg> en la parte inferior y selecciona <span className="font-semibold">"A√±adir a inicio"</span>
                          </p>
                        </>
                      ) : (
                        <>
                          <h3 className={`font-semibold text-sm sm:text-base mb-1 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                            üì± Agrega ARGENTORES a tu pantalla de inicio
                          </h3>
                          <p className={`text-xs sm:text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>
                            Toca el bot√≥n <span className="font-semibold">Compartir</span> <svg className="inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"/></svg> en la parte inferior y selecciona <span className="font-semibold">"A√±adir a inicio"</span>
                          </p>
                        </>
                      )}
                    </>
                  ) : (
                    <>
                      <h3 className={`font-semibold text-sm sm:text-base mb-1 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                        üåê Usa Safari para instalar ARGENTORES
                      </h3>
                      <p className={`text-xs sm:text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>
                        Para agregar esta app a tu pantalla de inicio, debes usar <span className="font-semibold">Safari</span>. 
                        <br />
                        <span className="font-semibold">1.</span> Copia la URL de esta p√°gina
                        <br />
                        <span className="font-semibold">2.</span> √Åbrela en <span className="font-semibold">Safari</span>
                        <br />
                        <span className="font-semibold">3.</span> Toca <span className="font-semibold">Compartir</span> ‚Üí <span className="font-semibold">"A√±adir a inicio"</span>
                      </p>
                    </>
                  )}
                </div>
                <div className="flex-shrink-0 flex items-center gap-2">
                  <button
                    onClick={() => {
                      setShowIOSBanner(false);
                      localStorage.setItem('ios_banner_dismissed', 'true');
                      sessionStorage.setItem('ios_banner_dismissed', 'true');
                    }}
                    className={`text-xs px-2 py-1 rounded ${isLightMode ? 'text-gray-600 hover:bg-gray-100' : 'text-gray-400 hover:bg-gray-800'}`}
                    title="No volver a mostrar"
                  >
                    No mostrar m√°s
                  </button>
                  <button
                    onClick={() => {
                      setShowIOSBanner(false);
                      sessionStorage.setItem('ios_banner_dismissed', 'true');
                    }}
                    className={`p-1 ${isLightMode ? 'text-gray-500 hover:text-gray-700' : 'text-gray-400 hover:text-gray-200'}`}
                    aria-label="Cerrar"
                  >
                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          )}
          {updateAvailable && (
            <div className="update-banner">
              <span>üîÑ Nueva versi√≥n disponible (se aplicar√° al recargar)</span>
              <button onClick={handleUpdate}>Actualizar ahora</button>
            </div>
          )}
          <div className={`min-h-screen w-full transition-all duration-300 ${isLightMode ? 'bg-gradient-to-br from-gray-100 to-gray-200' : 'bg-black'} text-white p-3 sm:p-4 md:p-6 ${!isOnline ? 'pt-12 sm:pt-14 md:pt-16' : ''}`} style={{minHeight: '100dvh'}}>
          <div className="max-w-2xl mx-auto w-full px-2 sm:px-4">
            {/* Theme Toggle Button, Install Button y WhatsApp Button */}
            <div className="flex justify-center sm:justify-end gap-2 mb-4">
              {(gameStarted || step > 1) && !showFinalReveal && (
                <button
                  onClick={() => {
                    if (gameStarted) {
                      setShowExitConfirm(true);
                    } else {
                      goToStart();
                    }
                  }}
                  className={`p-2 sm:p-2.5 rounded-xl transition-all duration-300 shadow-lg flex items-center justify-center ${
                    isLightMode 
                      ? 'bg-blue-500 hover:bg-blue-600 text-white' 
                      : 'bg-blue-600 hover:bg-blue-700 text-white'
                  }`}
                  title="Volver al inicio"
                >
                  <svg className="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                  </svg>
                </button>
              )}
              {/* Bot√≥n de instalaci√≥n - solo visible cuando la app es instalable */}
              {!isInstalled && showInstallButton && deferredPrompt && (
                <button
                  onClick={handleInstallClick}
                  className={`px-4 py-2 sm:px-5 sm:py-2.5 rounded-xl transition-all duration-300 shadow-lg flex items-center gap-2 font-semibold text-sm sm:text-base ${
                    isLightMode 
                      ? 'bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white' 
                      : 'bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white'
                  } hover:shadow-xl hover:scale-105`}
                  title="Instalar aplicaci√≥n"
                >
                  <svg className="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
                  </svg>
                  <span>Instalar</span>
                </button>
              )}
              <button
                onClick={() => setIsLightMode(!isLightMode)}
                className={`p-2 sm:p-2.5 rounded-xl transition-all duration-300 shadow-lg flex items-center justify-center ${
                  isLightMode 
                    ? 'bg-yellow-500 hover:bg-yellow-600 text-white' 
                    : 'bg-gray-800 hover:bg-gray-700 text-yellow-400'
                }`}
              >
                {isLightMode ? <MoonIcon size={20} className="w-5 h-5 sm:w-6 sm:h-6" /> : <SunIcon size={20} className="w-5 h-5 sm:w-6 sm:h-6" />}
              </button>
            </div>

            {/* Header */}
            <div className="text-center mb-6 sm:mb-8 md:mb-12">
              <h1 className={`text-3xl sm:text-4xl md:text-5xl font-bold mb-3 sm:mb-4 bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent ${isLightMode ? 'from-purple-600 to-pink-600' : ''}`}>
                ARGENTORES
              </h1>
              <p className={`text-base sm:text-lg md:text-xl ${isLightMode ? 'text-gray-700' : 'text-purple-200'}`}>Encuentra al impostor.</p>
            </div>

            {/* Sistema de Racha y Contador de Usuarios en Vivo - Solo visible en el inicio */}
            {!gameStarted && (
            <div className={`${isLightMode ? 'bg-white/90' : 'bg-gray-900/80'} backdrop-blur-sm rounded-2xl p-4 sm:p-6 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-gray-800'} mb-4 sm:mb-6`}>
              <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6">
                {/* Sistema de Racha */}
                <div className={`${isLightMode ? 'bg-gradient-to-br from-purple-50 to-pink-50' : 'bg-gradient-to-br from-purple-900/30 to-pink-900/30'} rounded-xl p-4 sm:p-5 border ${isLightMode ? 'border-purple-200' : 'border-purple-700/50'}`}>
                  <div className="flex items-center justify-between mb-3">
                    <div className="flex items-center gap-2">
                      <svg className={`w-5 h-5 sm:w-6 sm:h-6 ${isLightMode ? 'text-purple-600' : 'text-purple-400'}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                      </svg>
                      <h3 className={`text-base sm:text-lg font-bold ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                        Racha de Partidas
                      </h3>
                    </div>
                    {streak > 0 && (
                      <span className={`text-xs sm:text-sm px-2 py-1 rounded-full ${isLightMode ? 'bg-purple-100 text-purple-700' : 'bg-purple-800/50 text-purple-300'}`}>
                        üî• {streak} racha{streak !== 1 ? 's' : ''}
                      </span>
                    )}
                  </div>
                  <div className="flex items-center gap-3">
                    <div className={`text-3xl sm:text-4xl font-bold ${isLightMode ? 'text-purple-600' : 'text-purple-400'}`}>
                      {streak > 0 ? 'üî•' : 'üí§'}
                    </div>
                    <div>
                      <div className={`text-2xl sm:text-3xl font-bold ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                        {streak}
                      </div>
                      <div className={`text-xs sm:text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                        {streak === 0 
                          ? gamesPlayed < 3 
                            ? `${gamesPlayed}/3 partidas - Juega ${3 - gamesPlayed} m√°s para activar`
                            : 'Inicia tu racha'
                          : streak === 1 
                            ? 'Racha activa - ¬°Sigue jugando!' 
                            : `${streak} rachas completadas`
                        }
                      </div>
                    </div>
                  </div>
                  {streak === 0 && !recoveryUsed && gamesPlayed > 0 && gamesPlayed < 3 && (
                    <button
                      onClick={() => setShowRecoveryModal(true)}
                      className={`mt-3 w-full py-2 px-4 rounded-lg text-sm font-semibold transition-all duration-300 ${
                        isLightMode 
                          ? 'bg-yellow-500 hover:bg-yellow-600 text-white' 
                          : 'bg-yellow-600 hover:bg-yellow-700 text-white'
                      }`}
                    >
                      üîÑ Recuperar Racha (1 vez)
                    </button>
                  )}
                </div>

                {/* Contador de Usuarios en Vivo */}
                <div className={`${isLightMode ? 'bg-gradient-to-br from-blue-50 to-cyan-50' : 'bg-gradient-to-br from-blue-900/30 to-cyan-900/30'} rounded-xl p-4 sm:p-5 border ${isLightMode ? 'border-blue-200' : 'border-blue-700/50'}`}>
                  <div className="flex items-center justify-between mb-3">
                    <div className="flex items-center gap-2">
                      <svg className={`w-5 h-5 sm:w-6 sm:h-6 ${isLightMode ? 'text-blue-600' : 'text-blue-400'}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                      </svg>
                      <h3 className={`text-base sm:text-lg font-bold ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                        Usuarios en Vivo
                      </h3>
                    </div>
                    {liveUserCount !== null && (
                      <div className={`w-2 h-2 rounded-full ${isLoadingUsers ? 'bg-gray-400 animate-pulse' : 'bg-green-500 animate-pulse'}`}></div>
                    )}
                  </div>
                  <div className="flex items-center gap-3">
                    <div className={`text-3xl sm:text-4xl font-bold ${isLightMode ? 'text-blue-600' : 'text-blue-400'}`}>
                      üë•
                    </div>
                    <div>
                      <div className={`text-2xl sm:text-3xl font-bold ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                        {liveUserCount === null ? (
                          <span className={`${isLightMode ? 'text-gray-400' : 'text-gray-500'}`}>‚Äî</span>
                        ) : isLoadingUsers ? (
                          '...'
                        ) : (
                          liveUserCount
                        )}
                      </div>
                      <div className={`text-xs sm:text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                        {liveUserCount === null 
                          ? 'No disponible' 
                          : isLoadingUsers 
                            ? 'Cargando...' 
                            : 'jugando ahora'
                        }
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            )}

            {/* Modal de Recuperaci√≥n de Racha */}
            {showRecoveryModal && (
              <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                <div className={`${isLightMode ? 'bg-white' : 'bg-gray-800'} rounded-2xl p-6 sm:p-8 max-w-md w-full shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                  <div className="text-center mb-6">
                    <div className="text-5xl mb-4">üîÑ</div>
                    <h3 className={`text-2xl font-bold mb-2 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                      Recuperar Racha
                    </h3>
                    <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                      ¬øDeseas recuperar tu racha? Esta opci√≥n solo se puede usar una vez.
                    </p>
                  </div>
                  <div className="flex gap-3">
                    <button
                      onClick={() => {
                        // Recuperar estableciendo partidas jugadas a 3 (m√≠nimo para activar racha)
                        const currentGames = parseInt(localStorage.getItem('impostorGame_gamesPlayed') || '0');
                        const recoveredGames = Math.max(3, currentGames);
                        setGamesPlayed(recoveredGames);
                        localStorage.setItem('impostorGame_gamesPlayed', recoveredGames.toString());
                        
                        const recoveredStreak = Math.floor(recoveredGames / 3);
                        setStreak(recoveredStreak);
                        setRecoveryUsed(true);
                        setShowRecoveryModal(false);
                        localStorage.setItem('impostorGame_streak', recoveredStreak.toString());
                        localStorage.setItem('impostorGame_recoveryUsed', 'true');
                        showToast(`¬°Racha recuperada! ${recoveredStreak} racha${recoveredStreak !== 1 ? 's' : ''}`, 'success', 3000);
                      }}
                      className={`flex-1 py-3 px-4 rounded-xl font-semibold transition-all duration-300 ${
                        isLightMode 
                          ? 'bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white' 
                          : 'bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white'
                      }`}
                    >
                      S√≠, recuperar
                    </button>
                    <button
                      onClick={() => setShowRecoveryModal(false)}
                      className={`flex-1 py-3 px-4 rounded-xl font-semibold transition-all duration-300 ${
                        isLightMode 
                          ? 'bg-gray-200 hover:bg-gray-300 text-gray-800' 
                          : 'bg-gray-700 hover:bg-gray-600 text-white'
                      }`}
                    >
                      Cancelar
                    </button>
                  </div>
                </div>
              </div>
            )}

            {!gameStarted ? (
              <>
                <StepIndicator />

                {/* Step 1: Player Count & Names */}
                {step === 1 && (
                  <>
                    {/* Cuadrado 1: Cantidad de jugadores y nombres personalizados */}
                    <div className={`${isLightMode ? 'bg-white/90' : 'bg-gray-900/80'} backdrop-blur-sm rounded-2xl p-4 sm:p-6 md:p-8 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-gray-800'} mb-4 sm:mb-6`}>
                      <div className="flex items-center justify-between mb-4 sm:mb-5 md:mb-6">
                        <h2 className={`text-lg sm:text-xl md:text-2xl font-bold flex items-center gap-2 sm:gap-3 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                          <svg className={`w-6 h-6 sm:w-7 sm:h-7 ${isLightMode ? 'text-purple-600' : 'text-purple-400'}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                          </svg>
                          Jugadores
                        </h2>
                        <p className={`text-xs sm:text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-500'}`}>
                          M√≠nimo 3
                        </p>
                      </div>
                      <div className="mb-6 sm:mb-8">
                        <div className="flex items-center justify-center gap-4 sm:gap-6 mb-6">
                          <button
                            onClick={() => setPlayerCount(Math.max(3, playerCount - 1))}
                            className="w-12 h-12 sm:w-14 sm:h-14 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 rounded-xl text-xl sm:text-2xl font-bold transition-all duration-300 shadow-lg shadow-purple-500/50 hover:shadow-xl hover:scale-110 active:scale-95"
                          >
                            -
                          </button>
                          <div className={`text-4xl sm:text-5xl md:text-6xl font-bold ${isLightMode ? 'text-purple-600' : 'text-purple-400'}`}>{playerCount}</div>
                          <button
                            onClick={() => setPlayerCount(Math.min(20, playerCount + 1))}
                            className="w-12 h-12 sm:w-14 sm:h-14 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 rounded-xl text-xl sm:text-2xl font-bold transition-all duration-300 shadow-lg shadow-purple-500/50 hover:shadow-xl hover:scale-110 active:scale-95"
                          >
                            +
                          </button>
                        </div>
                      </div>

                    {/* Card style for Use Names */}
                    <div className={`mb-4 rounded-xl transition-all duration-300 ${
                      isLightMode 
                        ? useNames ? 'bg-gray-100 border border-gray-300' : 'bg-gray-50 border border-gray-200'
                        : useNames ? 'bg-gray-800/70 border border-gray-700' : 'bg-gray-800/50 border border-gray-800'
                    }`}>
                      {/* Header de la tarjeta con toggle */}
                      <div className="p-4 sm:p-5 flex items-center justify-between">
                        <div className="flex items-center gap-3 sm:gap-4 flex-1">
                          {/* Icono cuadrado verde con icono */}
                          <div className={`w-12 h-12 sm:w-14 sm:h-14 rounded-lg flex items-center justify-center flex-shrink-0 ${
                            useNames ? 'bg-gradient-to-r from-purple-600 to-pink-600' : (isLightMode ? 'bg-gray-300' : 'bg-gray-700')
                          }`}>
                            <svg className={`w-6 h-6 sm:w-7 sm:h-7 ${useNames ? 'text-white' : (isLightMode ? 'text-gray-500' : 'text-gray-400')}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                          </div>
                          <div className="flex-1 min-w-0">
                            <p className={`text-base sm:text-lg font-bold ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                              Nombres Personalizados
                            </p>
                            <p className={`text-xs sm:text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                              {useNames ? 'Habilitado' : 'Deshabilitado'}
                            </p>
                          </div>
                        </div>
                        {/* Toggle switch */}
                        <label className="cursor-pointer">
                          <input
                            type="checkbox"
                            checked={useNames}
                            onChange={(e) => {
                              setUseNames(e.target.checked);
                              if (e.target.checked) {
                                setPlayerNames(Array(playerCount).fill(''));
                              } else {
                                setSelectedProfile(null);
                                setShowPlayerNamesList(false);
                                setShowProfilesList(false);
                              }
                            }}
                            className="sr-only"
                          />
                          <div className={`w-12 h-6 rounded-full transition-all duration-300 relative ${
                            useNames 
                              ? 'bg-gradient-to-r from-purple-600 to-pink-600' 
                              : isLightMode ? 'bg-gray-300' : 'bg-gray-600'
                          }`}>
                            <div className={`w-5 h-5 bg-white rounded-full shadow-md absolute top-0.5 transition-all duration-300 ${
                              useNames ? 'left-7' : 'left-0.5'
                            }`}></div>
                          </div>
                        </label>
                      </div>
                      
                      {/* Contenido expandible dentro de la misma tarjeta */}
                      {useNames && (
                        <div className="px-4 sm:px-5 pb-4 sm:pb-5 border-t border-opacity-20" style={{borderColor: isLightMode ? 'rgba(0,0,0,0.1)' : 'rgba(255,255,255,0.1)'}}>
                          {/* Botones de selecci√≥n */}
                          {!showPlayerNamesList && !showProfilesList && (
                            <div className="mt-4 flex flex-col sm:flex-row gap-3">
                              <button
                                onClick={() => {
                                  setShowPlayerNamesList(true);
                                  setShowProfilesList(false);
                                }}
                                className="flex-1 px-4 py-3 rounded-lg font-semibold text-sm sm:text-base transition-all duration-300 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white shadow-lg hover:shadow-xl hover:scale-105"
                              >
                                Ver Lista de Jugadores
                              </button>
                              <button
                                onClick={() => {
                                  setShowProfilesList(true);
                                  setShowPlayerNamesList(false);
                                }}
                                className="flex-1 px-4 py-3 rounded-lg font-semibold text-sm sm:text-base transition-all duration-300 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white shadow-lg hover:shadow-xl hover:scale-105"
                              >
                                Ver Perfiles Guardados
                              </button>
                            </div>
                          )}

                          {/* Bot√≥n para volver */}
                          {(showPlayerNamesList || showProfilesList) && (
                            <div className="mt-4 mb-4 flex gap-2">
                              <button
                                onClick={() => {
                                  setShowPlayerNamesList(false);
                                  setShowProfilesList(false);
                                }}
                                className={`px-3 py-2 rounded-lg font-semibold text-sm transition-all duration-300 ${
                                  isLightMode 
                                    ? 'bg-gray-200 hover:bg-gray-300 text-gray-800' 
                                    : 'bg-gray-700 hover:bg-gray-600 text-white'
                                }`}
                              >
                                ‚Üê Volver
                              </button>
                              {/* Bot√≥n para cambiar entre listas */}
                              {showPlayerNamesList && (
                                <button
                                  onClick={() => {
                                    setShowPlayerNamesList(false);
                                    setShowProfilesList(true);
                                  }}
                                  className={`px-3 py-2 rounded-lg font-semibold text-sm transition-all duration-300 ${
                                    isLightMode 
                                      ? 'bg-purple-200 hover:bg-purple-300 text-purple-800' 
                                      : 'bg-purple-700 hover:bg-purple-600 text-white'
                                  }`}
                                >
                                  Ver Perfiles Guardados ‚Üí
                                </button>
                              )}
                              {showProfilesList && (
                                <button
                                  onClick={() => {
                                    setShowProfilesList(false);
                                    setShowPlayerNamesList(true);
                                  }}
                                  className={`px-3 py-2 rounded-lg font-semibold text-sm transition-all duration-300 ${
                                    isLightMode 
                                      ? 'bg-purple-200 hover:bg-purple-300 text-purple-800' 
                                      : 'bg-purple-700 hover:bg-purple-600 text-white'
                                  }`}
                                >
                                  Ver Lista de Jugadores ‚Üí
                                </button>
                              )}
                            </div>
                          )}

                          {/* Perfiles guardados */}
                          {showProfilesList && (
                            <div className="mt-4 mb-4">
                              <p className={`text-sm sm:text-base mb-3 font-semibold ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                Perfiles guardados:
                              </p>
                            {savedProfiles.length > 0 ? (
                              <div className="flex flex-wrap gap-2 mb-4">
                                {savedProfiles.map((profile) => (
                                  <div
                                    key={profile.id}
                                    onClick={() => loadProfile(profile.id)}
                                    className={`flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer transition-all duration-200 ${
                                      selectedProfile === profile.id
                                        ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white ring-2 ring-purple-400'
                                        : isLightMode
                                        ? 'bg-gray-200 hover:bg-gray-300 text-gray-800'
                                        : 'bg-gray-700 hover:bg-gray-600 text-white'
                                    }`}
                                  >
                                    <span className="text-sm font-semibold">{profile.name}</span>
                                    <span className={`text-xs ${selectedProfile === profile.id ? 'text-white/80' : isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                      ({profile.playerCount} jugadores)
                                    </span>
                                    <button
                                      onClick={(e) => deleteProfile(profile.id, e)}
                                      title="Eliminar perfil"
                                      className={`ml-1 px-2 py-0.5 rounded text-xs font-bold transition-colors hover:scale-110 ${
                                        selectedProfile === profile.id
                                          ? 'bg-red-500 hover:bg-red-600 text-white'
                                          : isLightMode
                                          ? 'bg-red-200 hover:bg-red-300 text-red-800'
                                          : 'bg-red-700 hover:bg-red-600 text-white'
                                      }`}
                                    >
                                      √ó
                                    </button>
                                  </div>
                                ))}
                              </div>
                            ) : (
                              <p className={`text-xs sm:text-sm mb-4 ${isLightMode ? 'text-gray-500' : 'text-gray-500'}`}>
                                No hay perfiles guardados. Completa los nombres y haz clic en "Guardar perfil" para crear uno.
                              </p>
                            )}
                            </div>
                          )}

                          {/* Inputs de nombres */}
                          {showPlayerNamesList && (
                            <>
                          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                            {Array.from({ length: playerCount }, (_, i) => {
                              const duplicateIndices = getDuplicateNameIndices();
                              const isDuplicate = duplicateIndices.includes(i);
                              return (
                                <div key={i} className="relative">
                                  <div className="absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none z-10">
                                    <span className={`text-xs sm:text-sm font-semibold ${isLightMode ? 'text-gray-400' : 'text-gray-500'}`}>
                                      #{i + 1}
                                    </span>
                                  </div>
                                  <input
                                    type="text"
                                    placeholder="Nombre del jugador"
                                    value={playerNames[i] || ''}
                                    onChange={(e) => handleNameChange(i, e.target.value)}
                                    className={`pl-10 sm:pl-12 px-4 py-2.5 sm:py-3 pr-8 rounded-lg focus:outline-none focus:ring-2 focus:border-transparent text-base sm:text-base transition-all duration-200 w-full min-w-0 ${
                                      isDuplicate
                                        ? `${isLightMode ? 'bg-red-50 border-2 border-red-400 text-red-800 placeholder:text-red-400 placeholder:opacity-70' : 'bg-red-900/30 border-2 border-red-500 text-red-300 placeholder:text-red-400 placeholder:opacity-70'} focus:ring-red-500`
                                        : `${isLightMode ? 'bg-white border-2 border-gray-300 text-gray-800 placeholder:text-gray-500 placeholder:opacity-70 hover:border-purple-400' : 'bg-gray-700 border-2 border-gray-600 text-white placeholder:text-gray-400 placeholder:opacity-70 hover:border-purple-500'} focus:ring-purple-500`
                                    }`}
                                    style={{
                                      fontSize: '16px' // Prevenir zoom en iOS
                                    }}
                                  />
                                  {isDuplicate && (
                                    <span className="absolute top-2 right-2 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center pointer-events-none z-10" title="Nombre duplicado">
                                      !
                                    </span>
                                  )}
                                </div>
                              );
                            })}
                          </div>
                          {(() => {
                            const duplicateIndices = getDuplicateNameIndices();
                            return duplicateIndices.length > 0 ? (
                              <div className={`mt-3 p-3 rounded-lg ${isLightMode ? 'bg-red-50 border-2 border-red-300' : 'bg-red-900/30 border-2 border-red-600'}`}>
                                <p className={`text-xs sm:text-sm font-semibold ${isLightMode ? 'text-red-700' : 'text-red-300'}`}>
                                  ‚ö†Ô∏è Hay nombres duplicados. Por favor, usa nombres √∫nicos para cada jugador.
                                </p>
                              </div>
                            ) : null;
                          })()}

                          {/* Bot√≥n para guardar perfil */}
                          <div className="mt-4 flex justify-end">
                            <button
                              onClick={saveProfile}
                              disabled={(() => {
                                const filledNamesCount = playerNames.filter(name => name && name.trim()).length;
                                return filledNamesCount < 3 || filledNamesCount < playerCount;
                              })()}
                              className={`px-4 py-2 rounded-lg font-semibold text-sm transition-all duration-300 ${
                                (() => {
                                  const filledNamesCount = playerNames.filter(name => name && name.trim()).length;
                                  return filledNamesCount < 3 || filledNamesCount < playerCount;
                                })()
                                  ? 'bg-gray-600 cursor-not-allowed opacity-50'
                                  : 'bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white shadow-lg shadow-green-500/50 hover:shadow-xl hover:scale-105'
                              }`}
                            >
                              üíæ Guardar perfil
                            </button>
                          </div>
                            </>
                          )}
                        </div>
                      )}
                    </div>
                    </div>

                    {/* Cuadrado 2: Configuraciones del juego */}
                    <div className={`${isLightMode ? 'bg-white/90' : 'bg-gray-900/80'} backdrop-blur-sm rounded-2xl p-4 sm:p-6 md:p-8 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-gray-800'} mb-4 sm:mb-6`}>
                      <div className="flex items-center justify-between mb-4 sm:mb-5 md:mb-6">
                        <h2 className={`text-lg sm:text-xl md:text-2xl font-bold flex items-center gap-2 sm:gap-3 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                          <svg className={`w-6 h-6 sm:w-7 sm:h-7 ${isLightMode ? 'text-purple-600' : 'text-purple-400'}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                          </svg>
                          Configuraciones del juego
                        </h2>
                      </div>

                    {/* Card style for Hints */}
                    <div className={`mb-4 p-4 sm:p-5 rounded-xl transition-all duration-300 flex items-center justify-between ${
                      !PISTAS_HABILITADAS
                        ? isLightMode ? 'bg-gray-100 border border-gray-300 opacity-60' : 'bg-gray-800/50 border border-gray-800 opacity-50'
                        : isLightMode 
                          ? impostorHints ? 'bg-gray-100 border border-gray-300' : 'bg-gray-50 border border-gray-200'
                          : impostorHints ? 'bg-gray-800/70 border border-gray-700' : 'bg-gray-800/50 border border-gray-800'
                    }`}>
                      <div className="flex items-center gap-3 sm:gap-4 flex-1">
                        {/* Icono cuadrado verde con bombilla */}
                        <div className={`w-12 h-12 sm:w-14 sm:h-14 rounded-lg flex items-center justify-center flex-shrink-0 ${
                          PISTAS_HABILITADAS && impostorHints ? 'bg-gradient-to-r from-purple-600 to-pink-600' : (isLightMode ? 'bg-gray-300' : 'bg-gray-700')
                        }`}>
                          <svg className={`w-6 h-6 sm:w-7 sm:h-7 ${PISTAS_HABILITADAS && impostorHints ? 'text-white' : (isLightMode ? 'text-gray-500' : 'text-gray-400')}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                          </svg>
                        </div>
                        <div className="flex-1 min-w-0">
                          <p className={`text-base sm:text-lg font-bold ${
                            PISTAS_HABILITADAS 
                              ? (isLightMode ? 'text-gray-800' : 'text-white')
                              : (isLightMode ? 'text-gray-500' : 'text-gray-500')
                          }`}>
                            Pistas
                          </p>
                          <p className={`text-xs sm:text-sm ${
                            PISTAS_HABILITADAS
                              ? (isLightMode ? 'text-gray-600' : 'text-gray-400')
                              : (isLightMode ? 'text-gray-500' : 'text-gray-500')
                          }`}>
                            {PISTAS_HABILITADAS 
                              ? (impostorHints ? 'Habilitado' : 'Deshabilitado')
                              : 'Pr√≥ximamente'}
                          </p>
                        </div>
                      </div>
                      {/* Toggle switch */}
                      <label className={PISTAS_HABILITADAS ? 'cursor-pointer' : 'cursor-not-allowed'}>
                        <input
                          type="checkbox"
                          checked={impostorHints}
                          onChange={(e) => PISTAS_HABILITADAS && setImpostorHints(e.target.checked)}
                          disabled={!PISTAS_HABILITADAS}
                          className="sr-only"
                        />
                        <div className={`w-12 h-6 rounded-full transition-all duration-300 relative ${
                          !PISTAS_HABILITADAS
                            ? `${isLightMode ? 'bg-gray-300' : 'bg-gray-700'} opacity-50`
                            : impostorHints 
                              ? 'bg-gradient-to-r from-purple-600 to-pink-600' 
                              : isLightMode ? 'bg-gray-300' : 'bg-gray-600'
                        }`}>
                          <div className={`w-5 h-5 bg-white rounded-full shadow-md absolute top-0.5 transition-all duration-300 ${
                            impostorHints ? 'left-7' : 'left-0.5'
                          } ${!PISTAS_HABILITADAS ? 'opacity-50' : ''}`}></div>
                        </div>
                      </label>
                    </div>

                    {/* Card style for Impostor Never First */}
                    <div className={`mb-4 p-4 sm:p-5 rounded-xl transition-all duration-300 flex items-center justify-between ${
                      isLightMode 
                        ? impostorNeverFirst ? 'bg-gray-100 border border-gray-300' : 'bg-gray-50 border border-gray-200'
                        : impostorNeverFirst ? 'bg-gray-800/70 border border-gray-700' : 'bg-gray-800/50 border border-gray-800'
                    }`}>
                      <div className="flex items-center gap-3 sm:gap-4 flex-1">
                        {/* Icono cuadrado */}
                        <div className={`w-12 h-12 sm:w-14 sm:h-14 rounded-lg flex items-center justify-center flex-shrink-0 ${
                          impostorNeverFirst ? 'bg-gradient-to-r from-purple-600 to-pink-600' : (isLightMode ? 'bg-gray-300' : 'bg-gray-700')
                        }`}>
                          <svg className={`w-6 h-6 sm:w-7 sm:h-7 ${impostorNeverFirst ? 'text-white' : (isLightMode ? 'text-gray-500' : 'text-gray-400')}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                        </div>
                        <div className="flex-1 min-w-0">
                          <p className={`text-base sm:text-lg font-bold ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                            Impostor nunca comienza
                          </p>
                          <p className={`text-xs sm:text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                            {impostorNeverFirst ? 'Habilitado' : 'Deshabilitado'}
                          </p>
                        </div>
                      </div>
                      {/* Toggle switch */}
                      <label className="cursor-pointer">
                        <input
                          type="checkbox"
                          checked={impostorNeverFirst}
                          onChange={(e) => setImpostorNeverFirst(e.target.checked)}
                          className="sr-only"
                        />
                        <div className={`w-12 h-6 rounded-full transition-all duration-300 relative ${
                          impostorNeverFirst 
                            ? 'bg-gradient-to-r from-purple-600 to-pink-600' 
                            : isLightMode ? 'bg-gray-300' : 'bg-gray-600'
                        }`}>
                          <div className={`w-5 h-5 bg-white rounded-full shadow-md absolute top-0.5 transition-all duration-300 ${
                            impostorNeverFirst ? 'left-7' : 'left-0.5'
                          }`}></div>
                        </div>
                      </label>
                    </div>

                    {/* Card style for Impostors Know Each Other */}
                    <div className={`mb-4 p-4 sm:p-5 rounded-xl transition-all duration-300 flex items-center justify-between ${
                      isLightMode 
                        ? impostorsKnowEachOther ? 'bg-gray-100 border border-gray-300' : 'bg-gray-50 border border-gray-200'
                        : impostorsKnowEachOther ? 'bg-gray-800/70 border border-gray-700' : 'bg-gray-800/50 border border-gray-800'
                    }`}>
                      <div className="flex items-center gap-3 sm:gap-4 flex-1">
                        {/* Icono cuadrado */}
                        <div className={`w-12 h-12 sm:w-14 sm:h-14 rounded-lg flex items-center justify-center flex-shrink-0 ${
                          impostorsKnowEachOther ? 'bg-gradient-to-r from-purple-600 to-pink-600' : (isLightMode ? 'bg-gray-300' : 'bg-gray-700')
                        }`}>
                          <svg className={`w-6 h-6 sm:w-7 sm:h-7 ${impostorsKnowEachOther ? 'text-white' : (isLightMode ? 'text-gray-500' : 'text-gray-400')}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                          </svg>
                        </div>
                        <div className="flex-1 min-w-0">
                          <p className={`text-base sm:text-lg font-bold ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                            Impostores se conocen
                          </p>
                          <p className={`text-xs sm:text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                            {impostorsKnowEachOther ? 'Habilitado' : 'Deshabilitado'}
                          </p>
                        </div>
                      </div>
                      {/* Toggle switch */}
                      <label className="cursor-pointer">
                        <input
                          type="checkbox"
                          checked={impostorsKnowEachOther}
                          onChange={(e) => setImpostorsKnowEachOther(e.target.checked)}
                          className="sr-only"
                        />
                        <div className={`w-12 h-6 rounded-full transition-all duration-300 relative ${
                          impostorsKnowEachOther 
                            ? 'bg-gradient-to-r from-purple-600 to-pink-600' 
                            : isLightMode ? 'bg-gray-300' : 'bg-gray-600'
                        }`}>
                          <div className={`w-5 h-5 bg-white rounded-full shadow-md absolute top-0.5 transition-all duration-300 ${
                            impostorsKnowEachOther ? 'left-7' : 'left-0.5'
                          }`}></div>
                        </div>
                      </label>
                    </div>

                    {/* Card style for Anonymous Voting */}
                    <div className={`mb-4 p-4 sm:p-5 rounded-xl transition-all duration-300 flex items-center justify-between ${
                      isLightMode 
                        ? anonymousVoting ? 'bg-gray-100 border border-gray-300' : 'bg-gray-50 border border-gray-200'
                        : anonymousVoting ? 'bg-gray-800/70 border border-gray-700' : 'bg-gray-800/50 border border-gray-800'
                    }`}>
                      <div className="flex items-center gap-3 sm:gap-4 flex-1">
                        {/* Icono cuadrado */}
                        <div className={`w-12 h-12 sm:w-14 sm:h-14 rounded-lg flex items-center justify-center flex-shrink-0 ${
                          anonymousVoting ? 'bg-gradient-to-r from-purple-600 to-pink-600' : (isLightMode ? 'bg-gray-300' : 'bg-gray-700')
                        }`}>
                          <svg className={`w-6 h-6 sm:w-7 sm:h-7 ${anonymousVoting ? 'text-white' : (isLightMode ? 'text-gray-500' : 'text-gray-400')}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                          </svg>
                        </div>
                        <div className="flex-1 min-w-0">
                          <p className={`text-base sm:text-lg font-bold ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                            Voto an√≥nimo
                          </p>
                          <p className={`text-xs sm:text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                            {anonymousVoting ? 'Habilitado (voto individual)' : 'Deshabilitado (voto p√∫blico)'}
                          </p>
                        </div>
                      </div>
                      {/* Toggle switch */}
                      <label className="cursor-pointer">
                        <input
                          type="checkbox"
                          checked={anonymousVoting}
                          onChange={(e) => setAnonymousVoting(e.target.checked)}
                          className="sr-only"
                        />
                        <div className={`w-12 h-6 rounded-full transition-all duration-300 relative ${
                          anonymousVoting 
                            ? 'bg-gradient-to-r from-purple-600 to-pink-600' 
                            : isLightMode ? 'bg-gray-300' : 'bg-gray-600'
                        }`}>
                          <div className={`w-5 h-5 bg-white rounded-full shadow-md absolute top-0.5 transition-all duration-300 ${
                            anonymousVoting ? 'left-7' : 'left-0.5'
                          }`}></div>
                        </div>
                      </label>
                    </div>
                    </div>

                    {/* Selecci√≥n de cantidad de impostores */}
                    <div className={`${isLightMode ? 'bg-white/90' : 'bg-gray-900/80'} backdrop-blur-sm rounded-2xl p-4 sm:p-6 md:p-8 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-gray-800'} mb-4 sm:mb-6`}>
                      <h2 className={`text-lg sm:text-xl md:text-2xl font-bold mb-4 sm:mb-5 md:mb-6 flex items-center gap-2 sm:gap-3 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                        <svg className={`w-6 h-6 sm:w-7 sm:h-7 ${isLightMode ? 'text-purple-600' : 'text-purple-400'}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                        Cantidad de Impostores
                      </h2>
                      <p className={`text-sm sm:text-base mb-4 sm:mb-6 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>¬øCu√°ntos impostores habr√° en el juego?</p>
                      
                      <div className="grid grid-cols-3 gap-2 sm:gap-3 mb-6 sm:mb-8">
                        {(() => {
                          const maxImpostors = getMaxImpostors(playerCount);
                          const maxOptions = Math.min(maxImpostors, playerCount - 1, 10); // M√°ximo 10 opciones para no saturar
                          const options = Array.from({ length: maxOptions }, (_, i) => i + 1);
                          return options.map((count) => {
                            const recommendedCount = getRecommendedImpostors(playerCount);
                            const isRecommended = count === recommendedCount && count <= maxImpostors;
                            // Validar tambi√©n contra el l√≠mite del 50% con especiales
                            const currentSpecialRoles = (jesterMode ? 1 : 0) + (accompliceMode ? 1 : 0) + (lostMode ? 1 : 0);
                            const additionalImpostorsToCount = (additionalImpostorsMode && additionalImpostorsProbability > 0) ? additionalImpostorsCount : 0;
                            const currentTotalSpecial = currentSpecialRoles + additionalImpostorsToCount;
                            const maxTotal = Math.floor(playerCount * 0.5);
                            const wouldExceedLimit = (count + currentTotalSpecial) > maxTotal;
                            const isDisabled = count >= playerCount || count > maxImpostors || wouldExceedLimit;
                            return (
                              <button
                                key={count}
                                onClick={() => {
                                  if (wouldExceedLimit) {
                                    showToast(`‚ö†Ô∏è M√°ximo ${maxTotal} impostores y especiales permitidos (50% de ${playerCount} jugadores). Con ${count} impostores y ${currentTotalSpecial} especiales tendr√≠as ${count + currentTotalSpecial}.`, 'warning', 5000);
                                    return;
                                  }
                                  setImpostorCount(count);
                                }}
                                disabled={isDisabled}
                                className={`p-4 sm:p-6 rounded-xl font-bold text-xl sm:text-2xl transition-all duration-300 shadow-lg ${
                                  isDisabled
                                    ? 'bg-gray-700 opacity-30 cursor-not-allowed'
                                    : impostorCount === count
                                    ? `bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 ring-4 ${isRecommended ? 'ring-yellow-400' : 'ring-purple-400'} shadow-purple-500/50 transform scale-105 text-white`
                                    : isRecommended
                                    ? `${isLightMode ? 'bg-yellow-200 hover:bg-yellow-300 text-gray-800 ring-4 ring-yellow-500 border-2 border-yellow-500' : 'bg-yellow-900/60 hover:bg-yellow-900/70 ring-4 ring-yellow-400 border-2 border-yellow-400'} hover:shadow-xl hover:scale-105 backdrop-blur-sm`
                                    : `${isLightMode ? 'bg-gray-200 hover:bg-gray-300 text-gray-800' : 'bg-gray-700/80 hover:bg-gray-600/90'} hover:shadow-xl hover:scale-105 backdrop-blur-sm`
                                }`}
                                style={{
                                  position: 'relative',
                                  ...(isRecommended ? {
                                    border: '3px solid #fbbf24',
                                    boxShadow: '0 0 0 3px rgba(251, 191, 36, 0.5), 0 0 10px rgba(251, 191, 36, 0.3)',
                                    backgroundColor: isLightMode ? '#fef3c7' : 'rgba(234, 179, 8, 0.3)'
                                  } : {})
                                }}
                              >
                                {isRecommended && (
                                  <span 
                                    className="bg-yellow-500 text-black font-black px-1.5 sm:px-2 py-0.5 sm:py-1 rounded-full leading-none shadow-xl border-3 border-yellow-700 text-[10px] sm:text-[11px] flex items-center justify-center" 
                                    title="Recomendado" 
                                    style={{
                                      position: 'absolute',
                                      top: '2px',
                                      right: '2px',
                                      zIndex: 10,
                                      lineHeight: '1',
                                      display: 'flex',
                                      whiteSpace: 'nowrap',
                                      minWidth: 'fit-content',
                                      borderWidth: '3px',
                                      boxShadow: '0 2px 4px rgba(0, 0, 0, 0.5), 0 0 8px rgba(251, 191, 36, 0.8)'
                                    }}
                                  >
                                    ‚≠ê
                                  </span>
                                )}
                                <div className="flex items-center justify-center">
                                  {count}
                                </div>
                              </button>
                            );
                          });
                        })()}
                      </div>

                      <div className={`${isLightMode ? 'bg-gray-100' : 'bg-gray-800/70'} rounded-xl p-4 sm:p-6 mb-6 sm:mb-8 border-2 ${isLightMode ? 'border-gray-300' : 'border-gray-700'}`}>
                        <div className="text-center mb-4">
                          <p className={`text-xs sm:text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-1`}>Jugadores</p>
                          <p className={`text-2xl sm:text-3xl font-bold ${isLightMode ? 'text-gray-800' : 'text-white'}`}>{playerCount}</p>
                        </div>
                        {(() => {
                          const specialCount = (jesterMode ? 1 : 0) + (accompliceMode ? 1 : 0) + (lostMode ? 1 : 0) + ((additionalImpostorsMode && additionalImpostorsProbability > 0) ? additionalImpostorsCount : 0);
                          const hasSpecial = specialCount > 0;
                          return (
                            <div className={`grid gap-4 mb-4 ${hasSpecial ? 'grid-cols-3' : 'grid-cols-2'}`}>
                              <div className="text-center">
                                <p className={`text-xs sm:text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-1`}>Impostores</p>
                                <p className={`text-2xl sm:text-3xl font-bold ${isLightMode ? 'text-red-600' : 'text-red-400'}`}>{impostorCount}</p>
                              </div>
                              <div className="text-center">
                                <p className={`text-xs sm:text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-1`}>Civiles</p>
                                <p className={`text-2xl sm:text-3xl font-bold ${isLightMode ? 'text-green-600' : 'text-green-400'}`}>{playerCount - impostorCount - specialCount}</p>
                              </div>
                              {hasSpecial && (
                                <div className="text-center">
                                  <p className={`text-xs sm:text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-1`}>Especiales</p>
                                  <p className={`text-2xl sm:text-3xl font-bold ${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`}>{specialCount}</p>
                                </div>
                              )}
                            </div>
                          );
                        })()}
                        <p className={`text-xs sm:text-sm text-center ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                          Los jugadores conocen la palabra secreta. ¬°Los impostores deben fingir que la conocen!
                        </p>
                      </div>
                    </div>

                    {/* Cuadrado 3: Modo Pro (Eventos Especiales) */}
                    <div className={`${isLightMode ? 'bg-white/90' : 'bg-gray-900/80'} backdrop-blur-sm rounded-2xl p-4 sm:p-6 md:p-8 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-gray-800'} mb-4 sm:mb-6`}>
                      <div className="flex items-center justify-between mb-4 sm:mb-5 md:mb-6">
                        <h2 className={`text-lg sm:text-xl md:text-2xl font-bold flex items-center gap-2 sm:gap-3 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                          <svg className="w-6 h-6 sm:w-7 sm:h-7" viewBox="0 0 24 24" fill="none">
                            <defs>
                              <linearGradient id="orangeGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stopColor="#f97316" />
                                <stop offset="100%" stopColor="#ea580c" />
                              </linearGradient>
                            </defs>
                            <path d="M5 16L3 5l5.5 5L12 4l3.5 6L21 5l-2 11H5zm2 4h10v2H7v-2z" fill="url(#orangeGradient)" />
                            <path d="M9 11l3-2 3 2" fill="url(#orangeGradient)" opacity="0.8" />
                          </svg>
                          Modo Pro (Eventos Especiales)
                        </h2>
                        {isPremium && (
                          <div className="px-3 sm:px-4 py-1.5 sm:py-2 bg-gradient-to-r from-green-500 to-green-600 rounded-xl font-semibold text-white text-xs sm:text-sm flex items-center gap-2">
                            <span className="text-base sm:text-lg">‚úì</span>
                            <span>Pro Activo</span>
                          </div>
                        )}
                      </div>
                      {!isPremium && (
                        <div className="mb-4 sm:mb-5 md:mb-6">
                          <button
                            onClick={() => setShowUnlockModal(true)}
                            className="w-full px-4 sm:px-6 py-3 sm:py-4 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 rounded-xl font-semibold transition-all duration-300 shadow-lg shadow-orange-500/50 hover:shadow-xl hover:scale-105 text-white text-sm sm:text-base flex items-center justify-center gap-2"
                          >
                            <svg className="w-5 h-5 sm:w-6 sm:h-6" viewBox="0 0 24 24" fill="none">
                              <defs>
                                <linearGradient id="orangeGradientButton" x1="0%" y1="0%" x2="100%" y2="100%">
                                  <stop offset="0%" stopColor="#ffffff" />
                                  <stop offset="100%" stopColor="#ffffff" />
                                </linearGradient>
                              </defs>
                              <path d="M5 16L3 5l5.5 5L12 4l3.5 6L21 5l-2 11H5zm2 4h10v2H7v-2z" fill="url(#orangeGradientButton)" />
                              <path d="M9 11l3-2 3 2" fill="url(#orangeGradientButton)" opacity="0.8" />
                            </svg>
                            <span>Desbloquear Pro</span>
                          </button>
                        </div>
                      )}
                      
                      {/* Impostores Adicionales */}
                      {(() => {
                        const minPlayersForAdditional = 5;
                        const maxAdditional = getMaxAdditionalImpostors(playerCount, impostorCount);
                        const isPremiumRequired = !isPremium;
                        const isDisabledByPlayers = playerCount < minPlayersForAdditional;
                        
                        // Validar m√°ximo 50% de impostores + roles especiales juntos
                        const currentSpecialRoles = (jesterMode ? 1 : 0) + (accompliceMode ? 1 : 0) + (lostMode ? 1 : 0);
                        const maxTotal = Math.floor(playerCount * 0.5);
                        const currentTotal = impostorCount + currentSpecialRoles;
                        const wouldExceedLimit = currentTotal >= maxTotal;
                        
                        const isDisabled = isDisabledByPlayers || !IMPOSTORES_ADICIONALES_HABILITADOS || isPremiumRequired || wouldExceedLimit;
                        
                        // Generar opciones de probabilidad: 1, 2, 3, 4, 5, luego de 5 en 5 hasta 50
                        const probabilityOptions = [1, 2, 3, 4, 5];
                        for (let i = 10; i <= 50; i += 5) {
                          probabilityOptions.push(i);
                        }
                        return (
                          <>
                            {/* Card style for Additional Impostors */}
                            <div className={`mb-4 rounded-xl transition-all duration-300 ${
                              !IMPOSTORES_ADICIONALES_HABILITADOS || !isPremium || isDisabledByPlayers || wouldExceedLimit
                                ? isLightMode ? 'bg-gray-100 border border-gray-300 opacity-60' : 'bg-gray-800/50 border border-gray-800 opacity-50'
                                : isLightMode 
                                  ? additionalImpostorsMode ? 'bg-orange-50 border border-orange-300' : 'bg-gray-50 border border-gray-200'
                                  : additionalImpostorsMode ? 'bg-orange-900/30 border border-orange-700' : 'bg-gray-800/50 border border-gray-800'
                            }`}>
                              {/* Header de la tarjeta con toggle */}
                              <div className="p-4 sm:p-5 flex items-center justify-between">
                                <div className="flex items-center gap-3 sm:gap-4 flex-1">
                                  {/* Icono cuadrado naranja con + */}
                                  <div className={`w-12 h-12 sm:w-14 sm:h-14 rounded-lg flex items-center justify-center flex-shrink-0 ${
                                    IMPOSTORES_ADICIONALES_HABILITADOS && additionalImpostorsMode && !isDisabledByPlayers && !wouldExceedLimit ? 'bg-gradient-to-r from-orange-500 to-orange-600' : (isLightMode ? 'bg-gray-300' : 'bg-gray-700')
                                  }`}>
                                    <svg className={`w-6 h-6 sm:w-7 sm:h-7 ${IMPOSTORES_ADICIONALES_HABILITADOS && additionalImpostorsMode && !isDisabledByPlayers && !wouldExceedLimit ? 'text-white' : (isLightMode ? 'text-gray-500' : 'text-gray-400')}`} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="3">
                                      <path strokeLinecap="round" strokeLinejoin="round" d="M12 4v16m8-8H4" />
                                    </svg>
                                  </div>
                                  <div className="flex-1 min-w-0">
                                    <p className={`text-base sm:text-lg font-bold ${
                                      IMPOSTORES_ADICIONALES_HABILITADOS && isPremium && !isDisabledByPlayers && !wouldExceedLimit
                                        ? (isLightMode ? 'text-gray-800' : 'text-white')
                                        : (isLightMode ? 'text-gray-500' : 'text-gray-500')
                                    }`}>
                                      Impostores adicionales
                                    </p>
                                    <p className={`text-xs sm:text-sm ${
                                      IMPOSTORES_ADICIONALES_HABILITADOS && isPremium && !isDisabledByPlayers && !wouldExceedLimit
                                        ? (isLightMode ? 'text-gray-600' : 'text-gray-400')
                                        : (isLightMode ? 'text-gray-500' : 'text-gray-500')
                                    }`}>
                                      {!isPremium 
                                        ? 'Requiere Pro'
                                        : isDisabledByPlayers
                                          ? `Disponible a partir de ${minPlayersForAdditional} jugadores`
                                          : wouldExceedLimit
                                            ? `‚ö†Ô∏è L√≠mite alcanzado`
                                            : IMPOSTORES_ADICIONALES_HABILITADOS 
                                              ? (additionalImpostorsMode ? 'Habilitado' : 'Deshabilitado')
                                              : 'Pr√≥ximamente'}
                                    </p>
                                  </div>
                                </div>
                                {/* Toggle switch */}
                                <label className={IMPOSTORES_ADICIONALES_HABILITADOS && !isDisabled && isPremium ? 'cursor-pointer' : 'cursor-not-allowed'}>
                                  <input
                                    type="checkbox"
                                    checked={additionalImpostorsMode && !isDisabledByPlayers && !wouldExceedLimit}
                                    onChange={(e) => {
                                      if (!isPremium) {
                                        setShowUnlockModal(true);
                                        return;
                                      }
                                      if (isDisabledByPlayers) {
                                        showToast(`Disponible a partir de ${minPlayersForAdditional} jugadores`, 'warning', 4000);
                                        return;
                                      }
                                      if (wouldExceedLimit && e.target.checked) {
                                        showToast(`‚ö†Ô∏è M√°ximo ${maxTotal} impostores y especiales permitidos (50% de ${playerCount} jugadores). Actualmente tienes ${currentTotal}.`, 'warning', 5000);
                                        return;
                                      }
                                      if (IMPOSTORES_ADICIONALES_HABILITADOS && !isDisabled) {
                                        setAdditionalImpostorsMode(e.target.checked);
                                      }
                                    }}
                                    disabled={!IMPOSTORES_ADICIONALES_HABILITADOS || isDisabled || !isPremium}
                                    className="sr-only"
                                  />
                                  <div className={`w-12 h-6 rounded-full transition-all duration-300 relative ${
                                    !IMPOSTORES_ADICIONALES_HABILITADOS || isDisabled || !isPremium
                                      ? `${isLightMode ? 'bg-gray-300' : 'bg-gray-700'} opacity-50`
                                      : (additionalImpostorsMode && !isDisabledByPlayers && !wouldExceedLimit)
                                        ? 'bg-gradient-to-r from-orange-500 to-orange-600' 
                                        : isLightMode ? 'bg-gray-300' : 'bg-gray-600'
                                  }`}>
                                    <div className={`w-5 h-5 bg-white rounded-full shadow-md absolute top-0.5 transition-all duration-300 ${
                                      (additionalImpostorsMode && !isDisabledByPlayers && !wouldExceedLimit) ? 'left-7' : 'left-0.5'
                                    } ${!IMPOSTORES_ADICIONALES_HABILITADOS || isDisabled || !isPremium ? 'opacity-50' : ''}`}></div>
                                  </div>
                                </label>
                              </div>
                              
                              {/* Contenido expandible dentro de la misma tarjeta */}
                              {IMPOSTORES_ADICIONALES_HABILITADOS && additionalImpostorsMode && !isDisabled && isPremium && (
                              <div className="px-4 sm:px-5 pb-4 sm:pb-5 border-t border-opacity-20" style={{borderColor: isLightMode ? 'rgba(0,0,0,0.1)' : 'rgba(255,255,255,0.1)'}}>
                              <>
                                <div className="mt-4">
                                  <label className={`block text-sm sm:text-base font-semibold mb-3 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                    Cantidad de impostores adicionales: {additionalImpostorsCount}
                                    {maxAdditional > 0 && (
                                      <span className={`text-xs ml-2 ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                        (m√°x: {maxAdditional})
                                      </span>
                                    )}
                                  </label>
                                  <div className="flex flex-wrap gap-2 justify-center sm:justify-start">
                                    {Array.from({ length: Math.max(1, maxAdditional) }, (_, i) => i + 1).map((value) => {
                                      // Validar l√≠mite del 50% al cambiar cantidad de impostores adicionales
                                      const specialRolesCount = (jesterMode ? 1 : 0) + (accompliceMode ? 1 : 0) + (lostMode ? 1 : 0);
                                      const maxTotal = Math.floor(playerCount * 0.5);
                                      const currentTotal = impostorCount + specialRolesCount;
                                      const wouldExceedWithThisValue = additionalImpostorsProbability > 0 && (currentTotal + value) > maxTotal;
                                      
                                      return (
                                        <button
                                          key={value}
                                          onClick={() => {
                                            if (wouldExceedWithThisValue) {
                                              showToast(`‚ö†Ô∏è M√°ximo ${maxTotal} impostores y especiales permitidos (50% de ${playerCount} jugadores). Con ${value} impostores adicionales tendr√≠as ${currentTotal + value}.`, 'warning', 5000);
                                              return;
                                            }
                                            setAdditionalImpostorsCount(value);
                                          }}
                                          className={`px-3 sm:px-4 py-2 text-sm font-semibold rounded transition-all min-w-[50px] text-center ${
                                            additionalImpostorsCount === value
                                              ? 'bg-orange-600 text-white shadow-lg'
                                              : wouldExceedWithThisValue
                                                ? isLightMode
                                                  ? 'bg-red-200 text-red-700 hover:bg-red-300 opacity-60'
                                                  : 'bg-red-800 text-red-300 hover:bg-red-700 opacity-60'
                                                : isLightMode
                                                  ? 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                  : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                          }`}
                                          disabled={wouldExceedWithThisValue}
                                        >
                                          +{value}
                                        </button>
                                      );
                                    })}
                                    {maxAdditional === 0 && (
                                      <span className={`text-xs px-3 py-2 ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                        No se pueden agregar m√°s impostores (l√≠mite alcanzado)
                                      </span>
                                    )}
                                  </div>
                                </div>
                                
                                <div className="mt-4">
                                  <label className={`block text-sm sm:text-base font-semibold mb-3 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                    Probabilidad de activaci√≥n: {additionalImpostorsProbability}%
                                  </label>
                                  <div className="flex flex-wrap gap-2 justify-center sm:justify-start">
                                    {probabilityOptions.map((value) => {
                                      // Validar l√≠mite del 50% al cambiar probabilidad
                                      const specialRolesCount = (jesterMode ? 1 : 0) + (accompliceMode ? 1 : 0) + (lostMode ? 1 : 0);
                                      const maxTotal = Math.floor(playerCount * 0.5);
                                      const currentTotal = impostorCount + specialRolesCount;
                                      const wouldExceedWithThisProbability = value > 0 && (currentTotal + additionalImpostorsCount) > maxTotal;
                                      
                                      return (
                                        <button
                                          key={value}
                                          onClick={() => {
                                            if (wouldExceedWithThisProbability) {
                                              showToast(`‚ö†Ô∏è M√°ximo ${maxTotal} impostores y especiales permitidos (50% de ${playerCount} jugadores). Con ${additionalImpostorsCount} impostores adicionales tendr√≠as ${currentTotal + additionalImpostorsCount}.`, 'warning', 5000);
                                              return;
                                            }
                                            setAdditionalImpostorsProbability(value);
                                          }}
                                          className={`px-3 sm:px-4 py-2 text-sm font-semibold rounded transition-all min-w-[50px] text-center ${
                                            additionalImpostorsProbability === value
                                              ? 'bg-orange-600 text-white shadow-lg'
                                              : wouldExceedWithThisProbability
                                                ? isLightMode
                                                  ? 'bg-red-200 text-red-700 hover:bg-red-300 opacity-60'
                                                  : 'bg-red-800 text-red-300 hover:bg-red-700 opacity-60'
                                                : isLightMode
                                                  ? 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                  : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                          }`}
                                          disabled={wouldExceedWithThisProbability}
                                        >
                                          {value}%
                                        </button>
                                      );
                                    })}
                                  </div>
                                </div>
                              </>
                              </div>
                              )}
                            </div>
                          </>
                        );
                      })()}

                      {/* Modo Buf√≥n */}
                      {(() => {
                        // REGLA DE BALANCE: Buf√≥n requiere m√≠nimo 5 jugadores, pero NO en 4-5 jugadores (rompe el balance)
                        const minPlayersForJester = 5;
                        const maxPlayersForJester = 5; // M√°ximo 5 jugadores donde NO se permite
                        const canEnableJester = playerCount >= minPlayersForJester && playerCount > maxPlayersForJester;
                        const isJesterDisabledByPlayers = !canEnableJester;
                        
                        // Validar m√°ximo 50% de impostores + roles especiales juntos
                        const currentSpecialRoles = (accompliceMode ? 1 : 0) + (lostMode ? 1 : 0);
                        const additionalImpostorsToCount = (additionalImpostorsMode && additionalImpostorsProbability > 0) ? additionalImpostorsCount : 0;
                        const currentTotalSpecial = currentSpecialRoles + additionalImpostorsToCount;
                        const maxTotal = Math.floor(playerCount * 0.5);
                        const currentTotal = impostorCount + currentTotalSpecial;
                        const wouldExceedLimit = !jesterMode && currentTotal >= maxTotal;
                        
                        return (
                          <div className={`mb-4 rounded-xl transition-all duration-300 ${
                            !BUFON_MODE_HABILITADO || !isPremium || isJesterDisabledByPlayers || wouldExceedLimit
                              ? isLightMode ? 'bg-gray-100 border border-gray-300 opacity-60' : 'bg-gray-800/50 border border-gray-800 opacity-50'
                              : isLightMode 
                                ? jesterMode ? 'bg-yellow-50 border border-yellow-300' : 'bg-gray-50 border border-gray-200'
                                : jesterMode ? 'bg-yellow-900/30 border border-yellow-700' : 'bg-gray-800/50 border border-gray-800'
                          }`}>
                            <div className="p-4 sm:p-5 flex items-center justify-between">
                              <div className="flex items-center gap-3 sm:gap-4 flex-1">
                                <div className={`w-12 h-12 sm:w-14 sm:h-14 rounded-lg flex items-center justify-center flex-shrink-0 ${
                                  BUFON_MODE_HABILITADO && jesterMode && canEnableJester ? 'bg-yellow-500' : (isLightMode ? 'bg-gray-300' : 'bg-gray-700')
                                }`}>
                                  <JesterIcon size={36} className={`${BUFON_MODE_HABILITADO && jesterMode && canEnableJester ? 'text-white' : (isLightMode ? 'text-gray-500' : 'text-gray-400')}`} fill={BUFON_MODE_HABILITADO && jesterMode && canEnableJester ? 'currentColor' : (isLightMode ? 'currentColor' : 'currentColor')}/>
                                </div>
                                <div className="flex-1 min-w-0">
                                  <p className={`text-base sm:text-lg font-bold ${
                                    BUFON_MODE_HABILITADO && isPremium && canEnableJester
                                      ? (isLightMode ? 'text-gray-800' : 'text-white')
                                      : (isLightMode ? 'text-gray-500' : 'text-gray-500')
                                  }`}>
                                    A√±adir Buf√≥n
                                  </p>
                                  <p className={`text-xs sm:text-sm ${
                                    BUFON_MODE_HABILITADO && isPremium && canEnableJester && !wouldExceedLimit
                                      ? (isLightMode ? 'text-gray-600' : 'text-gray-400')
                                      : (isLightMode ? 'text-gray-500' : 'text-gray-500')
                                  }`}>
                                    {!isPremium 
                                      ? 'Requiere Pro'
                                      : isJesterDisabledByPlayers
                                        ? `Disponible a partir de ${minPlayersForJester + 1} jugadores`
                                        : wouldExceedLimit
                                          ? `‚ö†Ô∏è L√≠mite alcanzado`
                                          : BUFON_MODE_HABILITADO 
                                            ? (jesterMode ? 'Habilitado' : 'Deshabilitado')
                                            : 'Pr√≥ximamente'}
                                  </p>
                                </div>
                              </div>
                              <label className={BUFON_MODE_HABILITADO && isPremium && canEnableJester && !wouldExceedLimit ? 'cursor-pointer' : 'cursor-not-allowed'}>
                                <input
                                  type="checkbox"
                                  checked={jesterMode && !isJesterDisabledByPlayers && !wouldExceedLimit}
                                  onChange={(e) => {
                                    if (!isPremium) {
                                      setShowUnlockModal(true);
                                      return;
                                    }
                                    if (!canEnableJester) {
                                      showToast(`Disponible a partir de ${minPlayersForJester + 1} jugadores`, 'warning', 4000);
                                      return;
                                    }
                                    if (wouldExceedLimit && e.target.checked) {
                                      showToast(`‚ö†Ô∏è M√°ximo ${maxSpecialRoles} rol${maxSpecialRoles !== 1 ? 'es' : ''} especial${maxSpecialRoles !== 1 ? 'es' : ''} permitido${maxSpecialRoles !== 1 ? 's' : ''} (40% de ${playerCount} jugadores). Actualmente tienes ${currentTotalSpecial}.`, 'warning', 5000);
                                      return;
                                    }
                                    if (BUFON_MODE_HABILITADO) {
                                      setJesterMode(e.target.checked);
                                    }
                                  }}
                                  disabled={!BUFON_MODE_HABILITADO || !isPremium || isJesterDisabledByPlayers || wouldExceedLimit}
                                  className="sr-only"
                                />
                                <div className={`w-12 h-6 rounded-full transition-all duration-300 relative ${
                                  !BUFON_MODE_HABILITADO || !isPremium || isJesterDisabledByPlayers || wouldExceedLimit
                                    ? `${isLightMode ? 'bg-gray-300' : 'bg-gray-700'} opacity-50`
                                    : (jesterMode && !isJesterDisabledByPlayers && !wouldExceedLimit)
                                      ? 'bg-yellow-500' 
                                      : isLightMode ? 'bg-gray-300' : 'bg-gray-600'
                                }`}>
                                  <div className={`w-5 h-5 bg-white rounded-full shadow-md absolute top-0.5 transition-all duration-300 ${
                                    (jesterMode && !isJesterDisabledByPlayers && !wouldExceedLimit) ? 'left-7' : 'left-0.5'
                                  } ${!BUFON_MODE_HABILITADO || !isPremium || isJesterDisabledByPlayers || wouldExceedLimit ? 'opacity-50' : ''}`}></div>
                                </div>
                              </label>
                            </div>
                            {BUFON_MODE_HABILITADO && jesterMode && isPremium && canEnableJester && (
                              <div className="px-4 sm:px-5 pb-4 sm:pb-5 border-t border-opacity-20" style={{borderColor: isLightMode ? 'rgba(0,0,0,0.1)' : 'rgba(255,255,255,0.1)'}}>
                                <p className={`text-xs sm:text-sm mt-3 ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                  Gana si lo eliminan (no aplica en la primera ronda)
                                </p>
                              </div>
                            )}
                          </div>
                        );
                      })()}

                      {/* Modo El C√≥mplice */}
                      {(() => {
                        // REGLA DE BALANCE: C√≥mplice requiere m√≠nimo 6 jugadores, pero NO en 4-5 jugadores (rompe el balance)
                        const minPlayersForAccomplice = 6;
                        const maxPlayersForAccomplice = 5; // M√°ximo 5 jugadores donde NO se permite
                        const minImpostorsForAccomplice = 2;
                        // Puede habilitarse con 6+ jugadores O 2+ impostores, pero NO en 4-5 jugadores
                        const canEnableAccomplice = (playerCount >= minPlayersForAccomplice && playerCount > maxPlayersForAccomplice) || 
                                                     (impostorCount >= minImpostorsForAccomplice && playerCount > maxPlayersForAccomplice);
                        const isAccompliceDisabledByPlayers = !canEnableAccomplice;
                        
                        // Validar m√°ximo 50% de impostores + roles especiales juntos
                        const currentSpecialRoles = (jesterMode ? 1 : 0) + (lostMode ? 1 : 0);
                        const additionalImpostorsToCount = (additionalImpostorsMode && additionalImpostorsProbability > 0) ? additionalImpostorsCount : 0;
                        const currentTotalSpecial = currentSpecialRoles + additionalImpostorsToCount;
                        const maxTotal = Math.floor(playerCount * 0.5);
                        const currentTotal = impostorCount + currentTotalSpecial;
                        const wouldExceedLimit = !accompliceMode && currentTotal >= maxTotal;
                        
                        return (
                          <div className={`mb-4 rounded-xl transition-all duration-300 ${
                            !COMPLICE_MODE_HABILITADO || !isPremium || isAccompliceDisabledByPlayers || wouldExceedLimit
                              ? isLightMode ? 'bg-gray-100 border border-gray-300 opacity-60' : 'bg-gray-800/50 border border-gray-800 opacity-50'
                              : isLightMode 
                                ? accompliceMode ? 'bg-blue-50 border border-blue-300' : 'bg-gray-50 border border-gray-200'
                                : accompliceMode ? 'bg-blue-900/30 border border-blue-700' : 'bg-gray-800/50 border border-gray-800'
                          }`}>
                            <div className="p-4 sm:p-5 flex items-center justify-between">
                              <div className="flex items-center gap-3 sm:gap-4 flex-1">
                                <div className={`w-12 h-12 sm:w-14 sm:h-14 rounded-lg flex items-center justify-center flex-shrink-0 ${
                                  COMPLICE_MODE_HABILITADO && accompliceMode && canEnableAccomplice ? 'bg-blue-500' : (isLightMode ? 'bg-gray-300' : 'bg-gray-700')
                                }`}>
                                  <svg className={`w-8 h-8 sm:w-9 sm:h-9 ${COMPLICE_MODE_HABILITADO && accompliceMode && canEnableAccomplice ? 'text-white' : (isLightMode ? 'text-gray-500' : 'text-gray-400')}`} viewBox="0 0 24 24" fill="currentColor">
                                    <circle cx="6" cy="12" r="4" fill="currentColor"/>
                                    <circle cx="18" cy="12" r="4" fill="currentColor"/>
                                    <rect x="10" y="11" width="4" height="2" fill="currentColor"/>
                                  </svg>
                                </div>
                                <div className="flex-1 min-w-0">
                                  <p className={`text-base sm:text-lg font-bold ${
                                    COMPLICE_MODE_HABILITADO && isPremium && canEnableAccomplice
                                      ? (isLightMode ? 'text-gray-800' : 'text-white')
                                      : (isLightMode ? 'text-gray-500' : 'text-gray-500')
                                  }`}>
                                    El C√≥mplice
                                  </p>
                                  <p className={`text-xs sm:text-sm ${
                                    COMPLICE_MODE_HABILITADO && isPremium && canEnableAccomplice && !wouldExceedLimit
                                      ? (isLightMode ? 'text-gray-600' : 'text-gray-400')
                                      : (isLightMode ? 'text-gray-500' : 'text-gray-500')
                                  }`}>
                                    {!isPremium 
                                      ? 'Requiere Pro'
                                      : isAccompliceDisabledByPlayers
                                        ? `Disponible a partir de ${minPlayersForAccomplice} jugadores`
                                        : wouldExceedLimit
                                          ? `‚ö†Ô∏è L√≠mite alcanzado`
                                          : COMPLICE_MODE_HABILITADO 
                                            ? (accompliceMode ? 'Habilitado' : 'Deshabilitado')
                                            : 'Pr√≥ximamente'}
                                  </p>
                                </div>
                              </div>
                              <label className={COMPLICE_MODE_HABILITADO && isPremium && canEnableAccomplice && !wouldExceedLimit ? 'cursor-pointer' : 'cursor-not-allowed'}>
                                <input
                                  type="checkbox"
                                  checked={accompliceMode && !isAccompliceDisabledByPlayers && !wouldExceedLimit}
                                  onChange={(e) => {
                                    if (!isPremium) {
                                      setShowUnlockModal(true);
                                      return;
                                    }
                                    if (!canEnableAccomplice) {
                                      showToast(`Disponible a partir de ${minPlayersForAccomplice} jugadores`, 'warning', 4000);
                                      return;
                                    }
                                    if (wouldExceedLimit && e.target.checked) {
                                      showToast(`‚ö†Ô∏è M√°ximo ${maxTotal} impostores y especiales permitidos (50% de ${playerCount} jugadores). Actualmente tienes ${currentTotal}.`, 'warning', 5000);
                                      return;
                                    }
                                    if (COMPLICE_MODE_HABILITADO) {
                                      setAccompliceMode(e.target.checked);
                                    }
                                  }}
                                  disabled={!COMPLICE_MODE_HABILITADO || !isPremium || isAccompliceDisabledByPlayers || wouldExceedLimit}
                                  className="sr-only"
                                />
                                <div className={`w-12 h-6 rounded-full transition-all duration-300 relative ${
                                  !COMPLICE_MODE_HABILITADO || !isPremium || isAccompliceDisabledByPlayers || wouldExceedLimit
                                    ? `${isLightMode ? 'bg-gray-300' : 'bg-gray-700'} opacity-50`
                                    : (accompliceMode && !isAccompliceDisabledByPlayers && !wouldExceedLimit)
                                      ? 'bg-blue-500' 
                                      : isLightMode ? 'bg-gray-300' : 'bg-gray-600'
                                }`}>
                                  <div className={`w-5 h-5 bg-white rounded-full shadow-md absolute top-0.5 transition-all duration-300 ${
                                    (accompliceMode && !isAccompliceDisabledByPlayers && !wouldExceedLimit) ? 'left-7' : 'left-0.5'
                                  } ${!COMPLICE_MODE_HABILITADO || !isPremium || isAccompliceDisabledByPlayers || wouldExceedLimit ? 'opacity-50' : ''}`}></div>
                                </div>
                              </label>
                            </div>
                            {COMPLICE_MODE_HABILITADO && accompliceMode && isPremium && canEnableAccomplice && (
                              <div className="px-4 sm:px-5 pb-4 sm:pb-5 border-t border-opacity-20" style={{borderColor: isLightMode ? 'rgba(0,0,0,0.1)' : 'rgba(255,255,255,0.1)'}}>
                                <p className={`text-xs sm:text-sm mt-3 ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                  Conoce la palabra secreta y a uno de los impostores, juega como civil y puede ayudar a los impostores.
                                </p>
                              </div>
                            )}
                          </div>
                        );
                      })()}

                      {/* Modo El Perdido */}
                      {(() => {
                        const minPlayersForLost = 5;
                        const canEnableLost = playerCount >= minPlayersForLost;
                        const isLostDisabledByPlayers = !canEnableLost;
                        
                        // Validar m√°ximo 50% de impostores + roles especiales juntos
                        const currentSpecialRoles = (jesterMode ? 1 : 0) + (accompliceMode ? 1 : 0);
                        const additionalImpostorsToCount = (additionalImpostorsMode && additionalImpostorsProbability > 0) ? additionalImpostorsCount : 0;
                        const currentTotalSpecial = currentSpecialRoles + additionalImpostorsToCount;
                        const maxTotal = Math.floor(playerCount * 0.5);
                        const currentTotal = impostorCount + currentTotalSpecial;
                        const wouldExceedLimit = !lostMode && currentTotal >= maxTotal;
                        
                        return (
                          <div className={`mb-4 rounded-xl transition-all duration-300 ${
                            !PERDIDO_MODE_HABILITADO || !isPremium || isLostDisabledByPlayers || wouldExceedLimit
                              ? isLightMode ? 'bg-gray-100 border border-gray-300 opacity-60' : 'bg-gray-800/50 border border-gray-800 opacity-50'
                              : isLightMode 
                                ? lostMode ? 'bg-purple-50 border border-purple-300' : 'bg-gray-50 border border-gray-200'
                                : lostMode ? 'bg-purple-900/30 border border-purple-700' : 'bg-gray-800/50 border border-gray-800'
                          }`}>
                            <div className="p-4 sm:p-5 flex items-center justify-between">
                              <div className="flex items-center gap-3 sm:gap-4 flex-1">
                                <div className={`w-12 h-12 sm:w-14 sm:h-14 rounded-lg flex items-center justify-center flex-shrink-0 ${
                                  PERDIDO_MODE_HABILITADO && lostMode && canEnableLost ? 'bg-purple-500' : (isLightMode ? 'bg-gray-300' : 'bg-gray-700')
                                }`}>
                                  <svg className={`w-8 h-8 sm:w-9 sm:h-9 ${PERDIDO_MODE_HABILITADO && lostMode && canEnableLost ? 'text-white' : (isLightMode ? 'text-gray-500' : 'text-gray-400')}`} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/>
                                    <path d="M12 17h.01"/>
                                  </svg>
                                </div>
                                <div className="flex-1 min-w-0">
                                  <p className={`text-base sm:text-lg font-bold ${
                                    PERDIDO_MODE_HABILITADO && isPremium && canEnableLost
                                      ? (isLightMode ? 'text-gray-800' : 'text-white')
                                      : (isLightMode ? 'text-gray-500' : 'text-gray-500')
                                  }`}>
                                    El Perdido
                                  </p>
                                  <p className={`text-xs sm:text-sm ${
                                    PERDIDO_MODE_HABILITADO && isPremium && canEnableLost && !wouldExceedLimit
                                      ? (isLightMode ? 'text-gray-600' : 'text-gray-400')
                                      : (isLightMode ? 'text-gray-500' : 'text-gray-500')
                                  }`}>
                                    {!isPremium 
                                      ? 'Requiere Pro'
                                      : isLostDisabledByPlayers
                                        ? `Disponible a partir de ${minPlayersForLost} jugadores`
                                        : wouldExceedLimit
                                          ? `‚ö†Ô∏è L√≠mite alcanzado`
                                          : PERDIDO_MODE_HABILITADO 
                                            ? (lostMode ? 'Habilitado' : 'Deshabilitado')
                                            : 'Pr√≥ximamente'}
                                  </p>
                                </div>
                              </div>
                              <label className={PERDIDO_MODE_HABILITADO && isPremium && canEnableLost && !wouldExceedLimit ? 'cursor-pointer' : 'cursor-not-allowed'}>
                                <input
                                  type="checkbox"
                                  checked={lostMode && !isLostDisabledByPlayers && !wouldExceedLimit}
                                  onChange={(e) => {
                                    if (!isPremium) {
                                      setShowUnlockModal(true);
                                      return;
                                    }
                                    if (!canEnableLost) {
                                      showToast(`Disponible a partir de ${minPlayersForLost} jugadores`, 'warning', 4000);
                                      return;
                                    }
                                    if (wouldExceedLimit && e.target.checked) {
                                      showToast(`‚ö†Ô∏è M√°ximo ${maxTotal} impostores y especiales permitidos (50% de ${playerCount} jugadores). Actualmente tienes ${currentTotal}.`, 'warning', 5000);
                                      return;
                                    }
                                    if (PERDIDO_MODE_HABILITADO) {
                                      setLostMode(e.target.checked);
                                    }
                                  }}
                                  disabled={!PERDIDO_MODE_HABILITADO || !isPremium || isLostDisabledByPlayers || wouldExceedLimit}
                                  className="sr-only"
                                />
                                <div className={`w-12 h-6 rounded-full transition-all duration-300 relative ${
                                  !PERDIDO_MODE_HABILITADO || !isPremium || isLostDisabledByPlayers || wouldExceedLimit
                                    ? `${isLightMode ? 'bg-gray-300' : 'bg-gray-700'} opacity-50`
                                    : (lostMode && !isLostDisabledByPlayers && !wouldExceedLimit)
                                      ? 'bg-purple-500' 
                                      : isLightMode ? 'bg-gray-300' : 'bg-gray-600'
                                }`}>
                                  <div className={`w-5 h-5 bg-white rounded-full shadow-md absolute top-0.5 transition-all duration-300 ${
                                    (lostMode && !isLostDisabledByPlayers && !wouldExceedLimit) ? 'left-7' : 'left-0.5'
                                  } ${!PERDIDO_MODE_HABILITADO || !isPremium || isLostDisabledByPlayers || wouldExceedLimit ? 'opacity-50' : ''}`}></div>
                                </div>
                              </label>
                            </div>
                            {PERDIDO_MODE_HABILITADO && lostMode && isPremium && canEnableLost && (
                              <div className="px-4 sm:px-5 pb-4 sm:pb-5 border-t border-opacity-20" style={{borderColor: isLightMode ? 'rgba(0,0,0,0.1)' : 'rgba(255,255,255,0.1)'}}>
                                <p className={`text-xs sm:text-sm mt-3 ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                  Ve una palabra diferente de la misma categor√≠a. No sabe que tiene este rol hasta el final.
                                </p>
                              </div>
                            )}
                          </div>
                        );
                      })()}
                    </div>

                    {/* Botones de acci√≥n */}
                    <div className={`flex justify-between items-center gap-2 sm:gap-3`}>
                      <button
                        onClick={() => setShowHowToPlayModal(true)}
                        className={`px-4 sm:px-6 py-3 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base shadow-lg hover:shadow-xl hover:scale-105 ${
                          isLightMode 
                            ? 'bg-blue-500 hover:bg-blue-600 text-white' 
                            : 'bg-blue-600 hover:bg-blue-700 text-white'
                        }`}
                      >
                        ¬øC√≥mo jugar?
                      </button>
                      {/* Bot√≥n de WhatsApp en el medio */}
                      <button
                        onClick={handleShareWhatsApp}
                        className={`p-3 sm:p-3.5 rounded-xl transition-all duration-300 shadow-lg flex items-center justify-center hover:shadow-xl hover:scale-105 ${
                          isLightMode 
                            ? 'bg-green-500 hover:bg-green-600 text-white' 
                            : 'bg-green-600 hover:bg-green-700 text-white'
                        }`}
                        title="Compartir en WhatsApp"
                      >
                        <svg className="w-5 h-5 sm:w-6 sm:h-6" fill="currentColor" viewBox="0 0 24 24">
                          <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                        </svg>
                      </button>
                      <button
                        onClick={() => {
                          if (useNames && getDuplicateNameIndices().length > 0) {
                            setImportErrorMsg('‚ö†Ô∏è Hay nombres duplicados. Por favor, usa nombres √∫nicos para cada jugador antes de continuar.');
                            setShowImportErrorModal(true);
                            return;
                          }
                          setStep(2);
                        }}
                        disabled={playerCount < 3 || (useNames && getDuplicateNameIndices().length > 0)}
                        className={`px-4 sm:px-8 py-3 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base shadow-lg flex items-center gap-2 ${
                          playerCount >= 3 && !(useNames && getDuplicateNameIndices().length > 0)
                            ? 'bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 shadow-purple-500/50 hover:shadow-xl'
                            : 'bg-gray-600 cursor-not-allowed opacity-50'
                        }`}
                      >
                        <span>Continuar</span>
                        <svg className="w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7" />
                        </svg>
                      </button>
                    </div>
                  </>
                )}

                {/* Step 2: Select Categories */}
                {step === 2 && !showCustomCategoryEditor && (
                  <div className={`${isLightMode ? 'bg-white/90' : 'bg-gray-900/80'} backdrop-blur-sm rounded-2xl p-4 sm:p-8 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-gray-800'}`}>
                    <h2 className={`text-xl sm:text-2xl font-bold mb-4 sm:mb-6 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>Seleccionar Categor√≠as</h2>
                    
                    <div className="mb-4 sm:mb-6 flex gap-2 flex-wrap">
                      {/* Bot√≥n M√∫ltiples est√° oculto pero siempre seleccionado cuando categoryMode !== 'all' */}
                      <button
                        onClick={() => {
                          if (categoryMode === 'all') {
                            // Si est√° en 'all', cambiar a 'multiple'
                            setCategoryMode('multiple');
                            setCategories([]);
                          } else {
                            // Si est√° en 'multiple', cambiar a 'all'
                            setCategoryMode('all');
                            // Seleccionar todas las categor√≠as autom√°ticamente (filtrar VIP si no hay premium)
                            const availableCategories = categoryList.filter(cat => !cat.premium || isPremium);
                            const allCatNames = [...availableCategories.map(c => c.name), ...customCategories.map(c => c.name)];
                            setCategories(allCatNames);
                          }
                        }}
                        className={`px-4 sm:px-5 py-2.5 rounded-xl font-semibold transition-all duration-300 text-xs sm:text-sm shadow-lg ${
                          categoryMode === 'all'
                            ? 'bg-gradient-to-r from-blue-600 to-cyan-600 ring-4 ring-blue-400 shadow-blue-500/70 transform scale-105 text-white font-bold'
                            : `${isLightMode ? 'bg-gray-300 hover:bg-gray-400 text-gray-600' : 'bg-gray-700/50 hover:bg-gray-600/70 text-gray-400'} opacity-60 hover:opacity-80`
                        }`}
                      >
                        üé≤ Random
                      </button>
                      {/* Bot√≥n de crear categor√≠a personalizada */}
                      <button
                        onClick={() => {
                          setEditingCustomCategory(null);
                          setCustomCategoryName('');
                          setCustomCategoryWords([]);
                          setNewWord('');
                          setShowCustomCategoryEditor(true);
                        }}
                        className={`px-4 sm:px-5 py-2.5 rounded-xl font-semibold transition-all duration-300 text-xs sm:text-sm shadow-lg flex items-center gap-2 ${
                          isLightMode 
                            ? 'bg-yellow-200 hover:bg-yellow-300 text-gray-800 border-2 border-yellow-400' 
                            : 'bg-yellow-900/60 hover:bg-yellow-900/70 text-white border-2 border-yellow-600'
                        } hover:shadow-xl`}
                      >
                        <span className="text-base sm:text-lg">‚≠ê</span>
                        <span>Personalizado</span>
                      </button>
                    </div>

                    <>
                      <p className={`text-sm sm:text-base mb-4 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                        {categoryMode === 'single' 
                          ? 'Elige una categor√≠a' 
                          : categoryMode === 'all'
                            ? (() => {
                                const totalWords = categories.reduce((total, catName) => {
                                  // Buscar en categoryWords primero, luego en customCategories
                                  let words = categoryWords[catName];
                                  if (!words || !Array.isArray(words)) {
                                    const customCat = customCategories.find(c => c.name === catName);
                                    words = customCat ? customCat.words : [];
                                  }
                                  return total + (Array.isArray(words) ? words.length : 0);
                                }, 0);
                                return `Seleccionaste ${totalWords} palabras`;
                              })()
                            : categories.length > 0
                              ? (() => {
                                  const totalWords = categories.reduce((total, catName) => {
                                    // Buscar en categoryWords primero, luego en customCategories
                                    let words = categoryWords[catName];
                                    if (!words || !Array.isArray(words)) {
                                      const customCat = customCategories.find(c => c.name === catName);
                                      words = customCat ? customCat.words : [];
                                    }
                                    return total + (Array.isArray(words) ? words.length : 0);
                                  }, 0);
                                  return `Seleccionaste ${totalWords} palabras`;
                                })()
                              : 'Elige una o m√°s categor√≠as (se elegir√° una al azar)'}
                      </p>

                        {/* Categor√≠as normales */}
                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-6 sm:mb-8">
                          {categoryList.map((cat) => {
                            // Calcular el conteo de manera expl√≠cita y forzar evaluaci√≥n
                            const wordsArray = categoryWords[cat.name];
                            const wordCount = Array.isArray(wordsArray) ? wordsArray.length : 0;
                            const isPremiumCategory = cat.premium === true;
                            const isVIPLocked = isPremiumCategory && !isPremium;
                            
                            return (
                            <div key={cat.name} className="relative" style={{ zIndex: categories.includes(cat.name) || categoryMode === 'all' ? 10 : 1 }}>
                              <button
                                onClick={() => toggleCategory(cat.name)}
                                disabled={categoryMode === 'all'}
                                className={`w-full p-3 sm:p-4 rounded-xl font-semibold transition-all duration-300 flex items-center gap-2 sm:gap-3 text-sm sm:text-base shadow-lg relative ${
                                  isVIPLocked
                                    ? `bg-gradient-to-r from-orange-500/30 to-orange-600/30 border-2 border-orange-500/50 text-white cursor-pointer opacity-70 ring-2 ring-orange-500/30 hover:opacity-90 hover:ring-orange-500/50`
                                    : categories.includes(cat.name) || categoryMode === 'all'
                                      ? categoryMode === 'all'
                                        ? 'bg-gradient-to-r from-blue-600 to-cyan-600 ring-2 ring-blue-400 shadow-blue-500/50 cursor-default'
                                        : 'bg-gradient-to-r from-purple-600 to-pink-600 ring-2 ring-purple-400 shadow-purple-500/50'
                                      : `${isLightMode ? 'bg-gray-200 hover:bg-gray-300 text-gray-800' : 'bg-gray-700/80 hover:bg-gray-600/90'} hover:shadow-xl backdrop-blur-sm`
                                }`}
                              >
                                <span className="text-lg sm:text-2xl flex-shrink-0">{cat.emoji}</span>
                                <span className="flex-1 text-left break-words text-sm sm:text-base leading-tight min-w-0">{cat.name}</span>
                                <span className={`text-xs sm:text-sm font-bold flex-shrink-0 px-1.5 py-0.5 rounded ${isLightMode ? 'bg-gray-300 text-gray-800' : 'bg-gray-600 text-white'}`}>
                                  {wordCount}
                                </span>
                              </button>
                            </div>
                            );
                          })}
                        </div>

                        {/* Categor√≠as personalizadas - Secci√≥n separada */}
                        {customCategories.length > 0 && (
                          <div className="mt-8 sm:mt-10 mb-6 sm:mb-8">
                            <h3 className={`text-lg sm:text-xl font-bold mb-4 sm:mb-6 ${isLightMode ? 'text-gray-800' : 'text-white'} flex items-center gap-2`}>
                              <span className="text-2xl sm:text-3xl">‚≠ê</span>
                              <span>Categor√≠as Personalizadas</span>
                            </h3>
                            <div className="space-y-3 sm:space-y-4">
                              {customCategories.map((cat) => {
                                const wordsArray = categoryWords[cat.name] || cat.words || [];
                                const wordCount = Array.isArray(wordsArray) ? wordsArray.length : 0;
                                return (
                                  <div 
                                    key={cat.name} 
                                    className={`rounded-xl p-3 sm:p-4 shadow-lg border-2 ${
                                      categories.includes(cat.name) || categoryMode === 'all'
                                        ? categoryMode === 'all'
                                          ? `${isLightMode ? 'bg-blue-50 border-blue-300' : 'bg-blue-900/30 border-blue-600'}`
                                          : `${isLightMode ? 'bg-purple-50 border-purple-300' : 'bg-purple-900/30 border-purple-600'}`
                                        : `${isLightMode ? 'bg-white border-yellow-300' : 'bg-gray-800 border-yellow-600'}`
                                    } transition-all duration-300`}
                                    style={{ zIndex: categories.includes(cat.name) || categoryMode === 'all' ? 10 : 1 }}
                                  >
                                    <div className="flex items-center gap-3 sm:gap-4">
                                      {/* Bot√≥n principal de la categor√≠a */}
                                      <button
                                        onClick={() => toggleCategory(cat.name)}
                                        disabled={categoryMode === 'all'}
                                        className={`flex-1 p-3 sm:p-4 rounded-lg font-semibold transition-all duration-300 flex items-center gap-2 sm:gap-3 text-sm sm:text-base ${
                                          categories.includes(cat.name) || categoryMode === 'all'
                                            ? categoryMode === 'all'
                                              ? 'bg-gradient-to-r from-blue-600 to-cyan-600 ring-2 ring-blue-400 shadow-blue-500/50 cursor-default text-white'
                                              : 'bg-gradient-to-r from-purple-600 to-pink-600 ring-2 ring-purple-400 shadow-purple-500/50 text-white'
                                            : `${isLightMode ? 'bg-gray-200 hover:bg-gray-300 text-gray-800' : 'bg-gray-700/80 hover:bg-gray-600/90 text-white'} hover:shadow-xl`
                                        }`}
                                      >
                                        <span className="text-lg sm:text-2xl flex-shrink-0">{cat.emoji || '‚≠ê'}</span>
                                        <span className="flex-1 text-left break-words font-semibold leading-tight min-w-0">{cat.name}</span>
                                        <span className={`text-xs sm:text-sm font-bold flex-shrink-0 px-2 py-1 rounded ${isLightMode ? 'bg-white/80 text-gray-800' : 'bg-black/30 text-white'}`}>
                                          {wordCount}
                                        </span>
                                      </button>
                                      
                                      {/* Botones de opciones inline */}
                                      <div className="flex items-center gap-1.5 sm:gap-2 flex-shrink-0">
                                        <button
                                          onClick={(e) => {
                                            e.stopPropagation();
                                            editCustomCategory(cat);
                                          }}
                                          className={`p-2 sm:p-2.5 rounded-lg transition-all duration-300 flex items-center justify-center ${
                                            isLightMode 
                                              ? 'bg-blue-100 hover:bg-blue-200 text-blue-700' 
                                              : 'bg-blue-600 hover:bg-blue-500 text-white'
                                          } shadow-md hover:shadow-lg hover:scale-105`}
                                          title="Editar categor√≠a"
                                        >
                                          <span className="text-base sm:text-lg">‚úèÔ∏è</span>
                                        </button>
                                        <button
                                          onClick={(e) => {
                                            e.stopPropagation();
                                            shareCustomCategory(cat);
                                          }}
                                          className={`p-2 sm:p-2.5 rounded-lg transition-all duration-300 flex items-center justify-center ${
                                            isLightMode 
                                              ? 'bg-green-100 hover:bg-green-200 text-green-700' 
                                              : 'bg-green-600 hover:bg-green-500 text-white'
                                          } shadow-md hover:shadow-lg hover:scale-105`}
                                          title="Compartir categor√≠a"
                                        >
                                          <span className="text-base sm:text-lg">üîó</span>
                                        </button>
                                        <button
                                          onClick={(e) => {
                                            e.stopPropagation();
                                            deleteCustomCategory(cat.name);
                                          }}
                                          className={`p-2 sm:p-2.5 rounded-lg transition-all duration-300 flex items-center justify-center ${
                                            isLightMode 
                                              ? 'bg-red-100 hover:bg-red-200 text-red-700' 
                                              : 'bg-red-600 hover:bg-red-500 text-white'
                                          } shadow-md hover:shadow-lg hover:scale-105`}
                                          title="Eliminar categor√≠a"
                                        >
                                          <span className="text-base sm:text-lg">üóëÔ∏è</span>
                                        </button>
                                      </div>
                                    </div>
                                  </div>
                                );
                              })}
                            </div>
                          </div>
                        )}
                    </>
                  </div>
                )}

                    {/* Editor de Categor√≠a Personalizada */}
                {step === 2 && showCustomCategoryEditor && (
                  <div className={`${isLightMode ? 'bg-white' : 'bg-gray-900'} rounded-2xl p-4 sm:p-6 md:p-8 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-gray-800'}`}>
                    <div className="mb-4 sm:mb-6">
                      <button
                        onClick={() => {
                          setShowCustomCategoryEditor(false);
                          setEditingCustomCategory(null);
                          setCustomCategoryName('');
                          setCustomCategoryWords([]);
                          setNewWord('');
                        }}
                        className="mb-4 sm:mb-6 cursor-pointer inline-flex items-center gap-2 text-sm sm:text-base hover:opacity-80 transition-opacity"
                      >
                        <svg className={`w-5 h-5 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        <span className={isLightMode ? 'text-gray-700' : 'text-gray-300'}>Volver a categor√≠as</span>
                      </button>
                      
                      <h3 className={`text-lg sm:text-xl md:text-2xl font-bold mb-4 sm:mb-5 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                        {editingCustomCategory ? 'Editar Categor√≠a Personalizada' : 'Crear Categor√≠a Personalizada'}
                      </h3>
                    </div>
                          
                          <div className="mb-4 sm:mb-5">
                            <label className={`block text-xs sm:text-sm md:text-base font-semibold mb-2 sm:mb-3 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                              Nombre de la categor√≠a:
                            </label>
                            <input
                              type="text"
                              value={customCategoryName}
                              onChange={(e) => setCustomCategoryName(e.target.value)}
                              placeholder="Ej: Mis Amigos"
                              className={`w-full px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg sm:rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 text-base ${
                                isLightMode 
                                  ? 'bg-white border-2 border-gray-300 text-gray-800' 
                                  : 'bg-gray-700 border-2 border-gray-600 text-white'
                              }`}
                              style={{ fontSize: '16px' }}
                            />
                          </div>
                          
                          <div className="mb-4 sm:mb-5">
                            <label className={`block text-xs sm:text-sm md:text-base font-semibold mb-2 sm:mb-3 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                              Agregar palabras (m√≠nimo 6):
                            </label>
                            <div className="flex flex-col sm:flex-row gap-2 sm:gap-3 mb-3">
                              <input
                                type="text"
                                value={newWord}
                                onChange={(e) => setNewWord(e.target.value)}
                                onKeyPress={(e) => {
                                  if (e.key === 'Enter') {
                                    e.preventDefault();
                                    addWord();
                                  }
                                }}
                                placeholder="Escribe una palabra..."
                                className={`flex-1 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg sm:rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 text-base ${
                                  isLightMode 
                                    ? 'bg-white border-2 border-gray-300 text-gray-800' 
                                    : 'bg-gray-700 border-2 border-gray-600 text-white'
                                }`}
                                style={{ fontSize: '16px' }}
                              />
                              <button
                                onClick={addWord}
                                disabled={!newWord.trim() || customCategoryWords.includes(newWord.trim())}
                                className={`px-4 sm:px-6 md:px-8 py-2.5 sm:py-3 rounded-lg sm:rounded-xl font-bold transition-all duration-300 text-sm sm:text-base shadow-lg min-w-full sm:min-w-[100px] md:min-w-[120px] ${
                                  newWord.trim() && !customCategoryWords.includes(newWord.trim())
                                    ? 'bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white shadow-purple-500/50 hover:shadow-xl hover:scale-105 active:scale-95'
                                    : 'bg-gray-600 cursor-not-allowed opacity-50 text-white'
                                }`}
                              >
                                ‚ûï A√±adir
                              </button>
                            </div>
                            
                            {customCategoryWords.length > 0 && (
                              <div className={`mt-3 sm:mt-4 p-3 sm:p-4 rounded-lg sm:rounded-xl border-2 ${
                                isLightMode 
                                  ? 'bg-gray-50 border-gray-200' 
                                  : 'bg-gray-800 border-gray-700'
                              }`}>
                                <p className={`text-xs sm:text-sm font-semibold mb-2 sm:mb-3 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                  Palabras agregadas ({customCategoryWords.length}):
                                </p>
                                <div className="flex flex-wrap gap-2">
                                  {customCategoryWords.map((word, index) => (
                                    <div
                                      key={index}
                                      className={`inline-flex items-center gap-1.5 sm:gap-2 px-2 sm:px-3 py-1 sm:py-1.5 rounded-md sm:rounded-lg ${
                                        isLightMode 
                                          ? 'bg-white border border-gray-300' 
                                          : 'bg-gray-700 border border-gray-600'
                                      }`}
                                    >
                                      <span className={`text-xs sm:text-sm ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                                        {word}
                                      </span>
                                      <button
                                        onClick={() => removeWord(word)}
                                        className={`text-red-500 hover:text-red-700 transition-colors ${
                                          isLightMode ? 'hover:bg-red-50' : 'hover:bg-red-900/20'
                                        } rounded p-0.5 flex-shrink-0`}
                                        title="Eliminar palabra"
                                      >
                                        <svg className="w-3.5 h-3.5 sm:w-4 sm:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                      </button>
                                    </div>
                                  ))}
                                </div>
                              </div>
                            )}
                            
                            <p className={`text-xs mt-2 ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                              {customCategoryWords.length} palabra{customCategoryWords.length !== 1 ? 's' : ''} (m√≠nimo 6)
                            </p>
                          </div>
                          
                          <div className={`flex flex-col sm:flex-row gap-2 sm:gap-3 justify-end mt-4 sm:mt-6 pt-4 border-t ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                            <button
                              onClick={() => {
                                setShowCustomCategoryEditor(false);
                                setEditingCustomCategory(null);
                                setCustomCategoryName('');
                                setCustomCategoryWords([]);
                                setNewWord('');
                              }}
                              className={`px-4 sm:px-6 py-2.5 sm:py-3 rounded-lg sm:rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base ${
                                isLightMode 
                                  ? 'bg-gray-300 hover:bg-gray-400 text-gray-800' 
                                  : 'bg-gray-700 hover:bg-gray-600 text-white'
                              }`}
                            >
                              Cancelar
                            </button>
                            <button
                              onClick={saveCustomCategory}
                              disabled={customCategoryWords.length < 6 || !customCategoryName.trim()}
                              className={`px-4 sm:px-6 py-2.5 sm:py-3 rounded-lg sm:rounded-xl font-bold transition-all duration-300 text-sm sm:text-base shadow-lg ${
                                customCategoryWords.length >= 6 && customCategoryName.trim()
                                  ? 'bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white shadow-purple-500/50 hover:shadow-xl hover:scale-105 active:scale-95'
                                  : 'bg-gray-600 cursor-not-allowed opacity-50 text-white'
                              }`}
                            >
                              {editingCustomCategory ? 'Guardar Cambios' : 'Crear Categor√≠a'}
                            </button>
                          </div>
                  </div>
                )}

                {/* Botones de navegaci√≥n del Step 2 */}
                {step === 2 && !showCustomCategoryEditor && (
                  <div className="flex justify-between items-center pt-4 border-t border-gray-700 gap-2 sm:gap-3">
                    <button
                      onClick={() => setStep(1)}
                      className="px-3 sm:px-6 py-3 bg-gray-700/80 hover:bg-gray-600/90 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base shadow-lg hover:shadow-xl backdrop-blur-sm flex items-center gap-1.5 sm:gap-2"
                    >
                      <svg className="w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 19l-7-7 7-7" />
                      </svg>
                      <span>Volver</span>
                    </button>
                    <button
                      onClick={() => {
                        if (categoryMode !== 'all' && categories.length === 0) {
                          setImportErrorMsg('‚ö†Ô∏è Debes seleccionar al menos una categor√≠a antes de continuar.');
                          setShowImportErrorModal(true);
                          return;
                        }
                        if (useNames && getDuplicateNameIndices().length > 0) {
                          setImportErrorMsg('‚ö†Ô∏è Hay nombres duplicados. Por favor, usa nombres √∫nicos para cada jugador antes de continuar.');
                          setShowImportErrorModal(true);
                          return;
                        }
                        startGame();
                      }}
                      disabled={categoryMode !== 'all' && categories.length === 0}
                      className={`px-3 sm:px-8 py-3 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base shadow-lg flex items-center gap-1.5 sm:gap-2 ${
                        categoryMode === 'all' || categories.length > 0
                          ? 'bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 shadow-purple-500/50 hover:shadow-xl'
                          : 'bg-gray-600 cursor-not-allowed opacity-50'
                      }`}
                    >
                      <span>Iniciar Juego</span>
                      <svg className="w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                      </svg>
                    </button>
                  </div>
                )}

              </>
            ) : currentlyRevealingPlayer && !allRolesRevealed ? (
              // Vista de revelaci√≥n individual del jugador con animaci√≥n 3D de carta (fase inicial)
              <div className={`${isLightMode ? 'bg-white/90' : 'bg-black'} backdrop-blur-sm rounded-2xl p-4 sm:p-6 shadow-2xl border-4 ${isLightMode ? 'border-gray-300' : 'border-black'} relative overflow-hidden`} style={{borderRadius: '1rem'}}>
                {/* Bot√≥n para cancelar/volver arriba - siempre visible si hay jugadores anteriores */}
                {currentPlayerIndex > 0 && (
                  <button
                    onClick={() => {
                      if (currentPlayerIndex > 0) {
                        setCurrentPlayerIndex(currentPlayerIndex - 1);
                        setRoleRevealed(false);
                        const prevPlayer = gameStarted[currentPlayerIndex - 1];
                        setCurrentlyRevealingPlayer(prevPlayer);
                        setCardFlipped(false);
                        // Remover el jugador anterior de revealedPlayers si est√°
                        setRevealedPlayers(prev => prev.filter(num => num !== prevPlayer.number));
                      }
                    }}
                    className="absolute top-4 left-4 px-4 sm:px-6 py-2 sm:py-3 bg-gray-600 hover:bg-gray-700 rounded-xl font-bold text-sm sm:text-base transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 text-white z-50"
                    style={{zIndex: 1000}}
                  >
                    ‚Üê Volver
                  </button>
                )}
                {/* Bot√≥n para cancelar revelaci√≥n completamente - solo visible cuando la carta est√° cerrada */}
                {!cardFlipped && (
                  <button
                    onClick={() => {
                      setCurrentlyRevealingPlayer(null);
                      setCardFlipped(false);
                      setRoleRevealed(false);
                    }}
                    className="absolute top-4 right-4 px-4 sm:px-6 py-2 sm:py-3 bg-red-600 hover:bg-red-700 rounded-xl font-bold text-sm sm:text-base transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 text-white z-50"
                    style={{zIndex: 1000}}
                  >
                    ‚úï Cancelar
                  </button>
                )}
                <div className="text-center py-4 sm:py-6 flex items-center justify-center" style={{minHeight: '60vh'}}>
                  <div className="card-flip-container" style={{width: '90%', maxWidth: '400px', height: '400px', position: 'relative'}}>
                    <div className={`card-flip ${cardFlipped ? 'flipped' : ''}`} style={{width: '100%', height: '100%'}}>
                      {/* Lado frontal de la carta - Candado */}
                      <div 
                        className="card-front" 
                        onClick={() => setCardFlipped(true)}
                        style={{display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', padding: '1.5rem', borderRadius: '1rem', border: '4px solid #9333ea', cursor: 'pointer'}}
                      >
                        <div className="relative w-full text-center">
                          <p className={`text-xl sm:text-2xl font-bold mb-4 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                            {getPlayerDisplay(currentlyRevealingPlayer)}
                          </p>
                          <div className="mb-6 flex justify-center">
                            <span className="text-6xl sm:text-7xl">üîí</span>
                          </div>
                          <p className={`text-lg sm:text-xl font-bold uppercase ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                            CLICK PARA VER
                          </p>
                        </div>
                      </div>
                      
                      {/* Lado trasero de la carta - Contenido revelado */}
                      <div className="card-back" style={{display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '1.5rem', borderRadius: '1rem', border: `4px solid ${currentlyRevealingPlayer.isImpostor ? '#ef4444' : currentlyRevealingPlayer.isJester ? '#eab308' : currentlyRevealingPlayer.isAccomplice ? '#3b82f6' : currentlyRevealingPlayer.isLost ? '#a855f7' : '#22c55e'}`}}>
                        <div className="animate-flip-in w-full">
                          <h3 className={`text-xl sm:text-2xl font-bold mb-3 sm:mb-4 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                            {getPlayerDisplay(currentlyRevealingPlayer)}
                          </h3>
                          {currentlyRevealingPlayer.isImpostor ? (
                            <div className={`${isLightMode ? 'bg-red-100 border-2 border-red-300' : 'bg-red-900/50'} p-4 sm:p-6 rounded-xl mb-4 sm:mb-6`}>
                              <p className="text-4xl sm:text-5xl mb-3">üïµÔ∏è</p>
                              <p className={`text-xl sm:text-2xl font-bold mb-2 ${isLightMode ? 'text-red-600' : 'text-red-400'}`}>
                                ¬°Eres el IMPOSTOR!
                              </p>
                              {impostorsKnowEachOther && gameStarted.filter(p => p.isImpostor && p.number !== currentlyRevealingPlayer.number).length > 0 && (
                                <div className={`mt-3 p-3 rounded-xl ${isLightMode ? 'bg-red-200 border-2 border-red-400' : 'bg-red-800/70 border-2 border-red-600'}`}>
                                  <p className={`text-base sm:text-lg font-bold mb-2 ${isLightMode ? 'text-red-800' : 'text-red-300'}`}>
                                    üïµÔ∏è Tus compa√±eros impostores:
                                  </p>
                                  <div className="flex flex-wrap gap-2 justify-center">
                                    {gameStarted.filter(p => p.isImpostor && p.number !== currentlyRevealingPlayer.number).map((impostor) => (
                                      <div key={impostor.number} className={`px-3 py-1.5 rounded-lg font-bold text-sm sm:text-base ${isLightMode ? 'bg-red-300 text-red-900' : 'bg-red-700 text-white'}`}>
                                        {getPlayerDisplay(impostor)}
                                      </div>
                                    ))}
                                  </div>
                                </div>
                              )}
                            </div>
                          ) : currentlyRevealingPlayer.isJester ? (
                            <div className={`${isLightMode ? 'bg-yellow-100 border-2 border-yellow-300' : 'bg-yellow-900/50'} p-4 sm:p-6 rounded-xl mb-4 sm:mb-6`}>
                              <div className="flex justify-center mb-3">
                                <JesterIcon size={64} className={`${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`} fill={isLightMode ? '#ca8a04' : '#eab308'}/>
                              </div>
                              <p className={`text-xl sm:text-2xl font-bold mb-2 ${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`}>
                                ¬°Eres el BUF√ìN!
                              </p>
                              <p className={`text-sm sm:text-base mb-3 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                Tu palabra es:
                              </p>
                              <p className={`text-3xl sm:text-4xl font-bold mb-3 ${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`}>{currentlyRevealingPlayer.word}</p>
                            </div>
                          ) : currentlyRevealingPlayer.isAccomplice ? (
                            <div className={`${isLightMode ? 'bg-blue-100 border-2 border-blue-300' : 'bg-blue-900/50'} p-4 sm:p-6 rounded-xl mb-4 sm:mb-6`}>
                              <p className="text-4xl sm:text-5xl mb-3">üï∂Ô∏è</p>
                              <p className={`text-xl sm:text-2xl font-bold mb-2 ${isLightMode ? 'text-blue-600' : 'text-blue-400'}`}>
                                ¬°Eres el C√ìMPLICE!
                              </p>
                              <p className={`text-sm sm:text-base mb-3 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                Tu palabra es:
                              </p>
                              <p className={`text-3xl sm:text-4xl font-bold mb-3 ${isLightMode ? 'text-blue-600' : 'text-blue-400'}`}>{currentlyRevealingPlayer.word}</p>
                              {currentlyRevealingPlayer.knowsImpostor && currentlyRevealingPlayer.knowsImpostor.length > 0 && (
                                <div className={`mt-4 p-3 rounded-lg ${isLightMode ? 'bg-blue-50' : 'bg-blue-800/30'}`}>
                                  <p className={`text-sm font-semibold mb-2 text-center ${isLightMode ? 'text-blue-700' : 'text-blue-300'}`}>
                                    Conoces al impostor:
                                  </p>
                                  <div className="flex flex-wrap gap-2 justify-center">
                                    {currentlyRevealingPlayer.knowsImpostor.map(impNum => {
                                      const impostor = gameStarted.find(p => p.number === impNum);
                                      return impostor ? (
                                        <span key={impNum} className={`px-3 py-1 rounded-lg text-sm font-bold ${isLightMode ? 'bg-red-200 text-red-700' : 'bg-red-800 text-red-300'}`}>
                                          {getPlayerDisplay(impostor)}
                                        </span>
                                      ) : null;
                                    })}
                                  </div>
                                </div>
                              )}
                            </div>
                          ) : currentlyRevealingPlayer.isLost ? (
                            // El Perdido no sabe que es el Perdido - se muestra como inocente normal pero con otra palabra
                            <div className={`${isLightMode ? 'bg-green-100 border-2 border-green-300' : 'bg-green-900/50'} p-4 sm:p-6 rounded-xl mb-4 sm:mb-6`}>
                              <p className="text-4xl sm:text-5xl mb-3">‚úÖ</p>
                              <p className={`text-sm sm:text-base mb-3 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                Tu palabra es:
                              </p>
                              <p className={`text-3xl sm:text-4xl font-bold mb-3 ${isLightMode ? 'text-green-600' : 'text-green-400'}`}>{currentlyRevealingPlayer.word}</p>
                            </div>
                          ) : (
                            <div className={`${isLightMode ? 'bg-green-100 border-2 border-green-300' : 'bg-green-900/50'} p-4 sm:p-6 rounded-xl mb-4 sm:mb-6`}>
                              <p className="text-4xl sm:text-5xl mb-3">‚úÖ</p>
                              <p className={`text-sm sm:text-base mb-3 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                Tu palabra es:
                              </p>
                              <p className={`text-3xl sm:text-4xl font-bold mb-3 ${isLightMode ? 'text-green-600' : 'text-green-400'}`}>{currentlyRevealingPlayer.word}</p>
                            </div>
                          )}
                          <button
                            onClick={() => {
                              const newRevealed = [...revealedPlayers];
                              const isLastPlayer = !newRevealed.includes(currentlyRevealingPlayer.number) && 
                                                   newRevealed.length + 1 === gameStarted.length;
                              
                              if (!newRevealed.includes(currentlyRevealingPlayer.number)) {
                                newRevealed.push(currentlyRevealingPlayer.number);
                                setRevealedPlayers(newRevealed);
                              }
                              
                              // Si es el √∫ltimo jugador, ir directamente a la discusi√≥n
                              if (isLastPlayer) {
                                selectFirstPlayerAndStartDiscussion();
                              }
                              
                              setCurrentlyRevealingPlayer(null);
                              setCardFlipped(false);
                            }}
                            className={`px-6 sm:px-8 py-2 sm:py-3 rounded-xl font-bold text-sm sm:text-base transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 text-white w-full ${
                              !revealedPlayers.includes(currentlyRevealingPlayer.number) && revealedPlayers.length + 1 === gameStarted.length
                                ? 'bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 shadow-green-500/50'
                                : 'bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 shadow-purple-500/50'
                            }`}
                          >
                            {!revealedPlayers.includes(currentlyRevealingPlayer.number) && revealedPlayers.length + 1 === gameStarted.length ? 'Comenzar Discusi√≥n ‚Üí' : '‚Üê Volver'}
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            ) : !allRolesRevealed ? (
              // Nueva interfaz de cartas para revelaci√≥n inicial de roles
              <div className={`${isLightMode ? 'bg-white/90' : 'bg-gray-800/50'} backdrop-blur-sm rounded-2xl p-4 sm:p-8 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-transparent'}`}>
                {/* Header */}
                <div className="flex items-center gap-3 mb-6">
                  <h2 className={`text-2xl sm:text-3xl font-bold flex-1 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>Elige Tu Carta</h2>
                </div>

                {/* Mensaje de evento especial: Impostores Adicionales */}
                {isAdditionalImpostorsActive && (
                  <div className={`${isLightMode ? 'bg-orange-100 border-2 border-orange-400' : 'bg-orange-900/50 border-2 border-orange-600'} p-4 sm:p-6 rounded-xl mb-6 animate-pulse`}>
                    <p className="text-3xl sm:text-4xl mb-2 text-center">‚ö°</p>
                    <p className={`text-lg sm:text-xl font-bold mb-2 text-center ${isLightMode ? 'text-orange-700' : 'text-orange-300'}`}>
                      üéä EVENTO ESPECIAL ACTIVADO üéä
                    </p>
                    <p className={`text-base sm:text-lg font-semibold text-center ${isLightMode ? 'text-orange-600' : 'text-orange-400'}`}>
                      ‚ö° IMPOSTORES ADICIONALES ‚ö°
                    </p>
                    <p className={`text-sm sm:text-base mt-2 text-center ${isLightMode ? 'text-orange-700' : 'text-orange-300'}`}>
                      Se {additionalImpostorsCount === 1 ? 'ha agregado' : 'han agregado'} {additionalImpostorsCount} impostor{additionalImpostorsCount > 1 ? 'es' : ''} adicional{additionalImpostorsCount > 1 ? 'es' : ''} en esta partida
                    </p>
                  </div>
                )}

                {/* Badge de estado */}
                <div className={`${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-xl px-4 py-2 mb-6 text-center`}>
                  <p className={`text-sm sm:text-base font-semibold ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                    {revealedPlayers.length} de {gameStarted.length} jugadores revelados
                  </p>
                </div>

                {/* Grid de cartas */}
                <div className="grid grid-cols-2 gap-3 sm:gap-4">
                  {[...gameStarted].sort((a, b) => a.number - b.number).map((player) => {
                    const isRevealed = revealedPlayers.includes(player.number);
                    const displayText = useNames ? (player.name || `Jugador ${player.number}`) : `Jugador ${player.number}`;
                    
                    return (
                      <button
                        key={player.number}
                        onClick={() => {
                          if (!isRevealed) {
                            setCardFlipped(false);
                            setCurrentlyRevealingPlayer(player);
                          }
                        }}
                        disabled={isRevealed}
                        className={`relative w-full p-4 sm:p-6 rounded-xl transition-all duration-300 text-center ${
                          isRevealed
                            ? `${isLightMode ? 'bg-gray-300 opacity-60' : 'bg-gray-700 opacity-60'} cursor-default`
                            : `${isLightMode ? 'bg-gray-200 hover:bg-gray-300' : 'bg-gray-700 hover:bg-gray-600'} cursor-pointer hover:scale-105`
                        } border-4 border-purple-500`}
                        style={{minHeight: '180px', display: 'flex', flexDirection: 'column', justifyContent: 'center', alignItems: 'center'}}
                      >
                        {/* Texto del jugador */}
                        <p className={`text-base sm:text-lg font-semibold ${isRevealed ? (isLightMode ? 'text-gray-500' : 'text-gray-500') : (isLightMode ? 'text-gray-800' : 'text-white')}`}>
                          {displayText}
                        </p>
                        
                        {/* Texto "Toca para revelar" */}
                        {!isRevealed && (
                          <p className={`text-xs sm:text-sm mt-2 ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                            Toca para revelar
                          </p>
                        )}
                        
                        {isRevealed && (
                          <p className={`text-xs sm:text-sm mt-2 ${isLightMode ? 'text-gray-500' : 'text-gray-500'}`}>
                            ‚úì Revelado
                          </p>
                        )}
                      </button>
                    );
                  })}
                </div>

                {/* Auto-navegar cuando todos est√°n revelados */}
              </div>
            ) : !showDiscussion ? (
              <div className={`${isLightMode ? 'bg-white/90' : 'bg-gray-800/50'} backdrop-blur-sm rounded-2xl p-4 sm:p-8 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-transparent'}`}>
                <div className="text-center py-8 sm:py-12">
                  <h2 className={`text-2xl sm:text-3xl font-bold mb-6 sm:mb-8 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>¬°Todos conocen su rol!</h2>
                  
                  {/* Mensaje de evento especial: Impostores Adicionales */}
                  {isAdditionalImpostorsActive && (
                    <div className={`${isLightMode ? 'bg-orange-100 border-2 border-orange-400' : 'bg-orange-900/50 border-2 border-orange-600'} p-4 sm:p-6 rounded-xl mb-6 sm:mb-8 animate-pulse`}>
                      <p className="text-3xl sm:text-4xl mb-2">‚ö°</p>
                      <p className={`text-lg sm:text-xl font-bold mb-2 ${isLightMode ? 'text-orange-700' : 'text-orange-300'}`}>
                        üéä EVENTO ESPECIAL ACTIVADO üéä
                      </p>
                      <p className={`text-base sm:text-lg font-semibold ${isLightMode ? 'text-orange-600' : 'text-orange-400'}`}>
                        ‚ö° IMPOSTORES ADICIONALES ‚ö°
                      </p>
                      <p className={`text-sm sm:text-base mt-2 ${isLightMode ? 'text-orange-700' : 'text-orange-300'}`}>
                        Se {additionalImpostorsCount === 1 ? 'ha agregado' : 'han agregado'} {additionalImpostorsCount} impostor{additionalImpostorsCount > 1 ? 'es' : ''} adicional{additionalImpostorsCount > 1 ? 'es' : ''} en esta partida
                      </p>
                    </div>
                  )}
                  
                  <div className="bg-gradient-to-r from-yellow-600 to-orange-600 p-6 sm:p-8 rounded-xl mb-6 sm:mb-8">
                    <p className="text-base sm:text-xl text-gray-100 mb-4">El jugador que comienza es:</p>
                    <p className="text-4xl sm:text-5xl lg:text-7xl font-bold text-white break-words">
                      {getPlayerDisplay(gameStarted.find(p => p.number === firstPlayer))}
                    </p>
                  </div>
                  <button
                    onClick={startDiscussion}
                    className="px-8 sm:px-12 py-3 sm:py-4 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 rounded-xl font-bold text-base sm:text-xl transition-all duration-300 shadow-lg shadow-green-500/50 hover:shadow-xl hover:scale-105"
                  >
                    Comenzar Discusi√≥n üí¨
                  </button>
                </div>
              </div>
            ) : !showFinalReveal ? (
              <div className={`${isLightMode ? 'bg-white/90' : 'bg-gray-800/50'} backdrop-blur-sm rounded-2xl p-4 sm:p-8 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-transparent'}`}>
                {anonymousVoting ? (
                  // Modo an√≥nimo (voto individual)
                  !votingStarted ? (
                    // Pantalla inicial: bot√≥n para ir a votar
                    <>
                      <div className="text-center mb-6 sm:mb-8">
                        <h2 className={`text-3xl sm:text-4xl font-bold mb-4 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>¬°Hora de Discutir!</h2>
                        <p className={`text-lg sm:text-xl ${isLightMode ? 'text-purple-600' : 'text-purple-300'}`}>Voto an√≥nimo - Cada jugador votar√° individualmente</p>
                      </div>

                      <div className="space-y-4 sm:space-y-6 mb-6 sm:mb-8">
                        <div className={`${isLightMode ? 'bg-yellow-100 border-2 border-yellow-400' : 'bg-yellow-900/30 border-2 border-yellow-600'} p-4 sm:p-6 rounded-xl`}>
                          <p className={`text-sm sm:text-base mb-2 ${isLightMode ? 'text-gray-700' : 'text-gray-400'}`}>Comienza la discusi√≥n</p>
                          <p className={`text-xl sm:text-2xl font-bold break-words ${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`}>
                            üëâ {getPlayerDisplay(gameStarted.find(p => p.number === firstPlayer))}
                          </p>
                        </div>

                        <div className={`${isLightMode ? 'bg-gray-100' : 'bg-gray-700/50'} p-4 sm:p-6 rounded-xl`}>
                          <p className={`text-base sm:text-lg mb-3 ${isLightMode ? 'text-gray-700' : 'text-gray-400'}`}>Jugadores</p>
                          <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4">
                            {[...gameStarted].sort((a, b) => a.number - b.number).map((player) => (
                              <div
                                key={player.number}
                                className={`px-5 py-4 sm:px-6 sm:py-5 rounded-xl text-center font-bold text-base sm:text-lg md:text-xl transition-all duration-300 relative shadow-lg min-h-[100px] sm:min-h-[110px] flex flex-col items-center justify-center ${
                                  player.isEliminated
                                    ? `${isLightMode ? 'bg-gray-300 text-gray-500' : 'bg-gray-800 text-gray-600'} opacity-50`
                                    : `${isLightMode ? 'bg-gray-200 text-gray-800' : 'bg-gray-600 text-white'}`
                                }`}
                              >
                                <div className="break-words w-full px-2 text-base sm:text-lg md:text-xl">
                                  {useNames ? player.name : `Jugador ${player.number}`}
                                </div>
                                {player.isEliminated && (
                                  <div className="text-sm sm:text-base mt-2">üíÄ Eliminado</div>
                                )}
                                {!player.isEliminated && (
                                  <div className="text-sm sm:text-base mt-2 opacity-75">‚úÖ Activo</div>
                                )}
                              </div>
                            ))}
                          </div>
                        </div>
                      </div>

                      <button
                        onClick={startAnonymousVoting}
                        className="w-full px-6 sm:px-8 py-4 sm:py-5 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 rounded-xl font-bold text-lg sm:text-xl transition-all duration-300 shadow-lg shadow-purple-500/50 hover:shadow-xl hover:scale-105"
                      >
                        Ir a Votar üó≥Ô∏è
                      </button>

                      <button
                        onClick={() => setShowResultsConfirm(true)}
                        className={`w-full mt-4 px-6 sm:px-8 py-3 sm:py-4 rounded-xl font-bold text-base sm:text-xl transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 ${isLightMode ? 'bg-gray-300 hover:bg-gray-400 text-gray-800' : 'bg-gray-700/80 hover:bg-gray-600/90 text-white'}`}
                      >
                        Terminar Juego y Ver Resultados
                      </button>
                    </>
                  ) : !revealingVote ? (
                    // Pantalla de votaci√≥n: preguntar jugador por jugador
                    (() => {
                      const activePlayers = gameStarted.filter(p => !p.isEliminated);
                      const currentPlayer = activePlayers[currentVotingPlayerIndex];
                      const totalPlayers = activePlayers.length;
                      const currentPlayerNumber = currentVotingPlayerIndex + 1;
                      // Filtrar el jugador actual de la lista (no puede votarse a s√≠ mismo)
                      const availablePlayers = activePlayers.filter(p => p.number !== currentPlayer.number);
                      
                      return (
                        <div className="text-center py-8 sm:py-12">
                          <h2 className={`text-2xl sm:text-3xl font-bold mb-6 sm:mb-8 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>Votaci√≥n An√≥nima</h2>
                          
                          <div className={`${isLightMode ? 'bg-blue-100 border-2 border-blue-400' : 'bg-blue-900/30 border-2 border-blue-600'} p-6 sm:p-8 rounded-xl mb-6 sm:mb-8`}>
                            <p className={`text-lg sm:text-xl mb-4 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                              Jugador {currentPlayerNumber} de {totalPlayers}
                            </p>
                            <p className={`text-2xl sm:text-3xl font-bold mb-4 break-words ${isLightMode ? 'text-blue-600' : 'text-blue-400'}`}>
                              {getPlayerDisplay(currentPlayer)}
                            </p>
                            <p className={`text-base sm:text-lg ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                              ¬øA qui√©n quieres eliminar?
                            </p>
                          </div>

                          {!lockUnlocked ? (
                            // Pantalla del candado
                            <div className={`${isLightMode ? 'bg-gray-100' : 'bg-gray-700/50'} p-8 sm:p-12 rounded-xl mb-6 sm:mb-8`}>
                              <div className="flex flex-col items-center justify-center">
                                <button
                                  onClick={() => setLockUnlocked(true)}
                                  className="mb-6 p-6 sm:p-8 rounded-full bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-110 active:scale-95"
                                >
                                  <svg className="w-16 h-16 sm:w-20 sm:h-20 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                  </svg>
                                </button>
                                <p className={`text-lg sm:text-xl font-semibold ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                  Toca el candado para desbloquear
                                </p>
                                <p className={`text-sm sm:text-base mt-2 ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                  Luego podr√°s seleccionar a qui√©n eliminar
                                </p>
                              </div>
                            </div>
                          ) : (
                            // Lista de jugadores disponibles (sin el jugador actual)
                            <div className={`${isLightMode ? 'bg-gray-100' : 'bg-gray-700/50'} p-4 sm:p-6 rounded-xl mb-6 sm:mb-8`}>
                              <p className={`text-base sm:text-lg mb-3 ${isLightMode ? 'text-gray-700' : 'text-gray-400'}`}>Selecciona un jugador</p>
                              <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4">
                                {availablePlayers.map((player) => (
                                  <button
                                    key={player.number}
                                    onClick={() => !player.isEliminated && votePlayer(player)}
                                    disabled={player.isEliminated}
                                    className={`px-5 py-4 sm:px-6 sm:py-5 rounded-xl text-center font-bold text-base sm:text-lg md:text-xl transition-all duration-300 relative shadow-lg min-h-[100px] sm:min-h-[110px] flex flex-col items-center justify-center ${
                                      player.isEliminated
                                        ? `${isLightMode ? 'bg-gray-300 text-gray-500' : 'bg-gray-800 text-gray-600'} opacity-50 cursor-not-allowed`
                                        : selectedVoteTarget && selectedVoteTarget.number === player.number
                                        ? 'bg-gradient-to-r from-red-600 to-red-700 ring-4 ring-red-400 text-white cursor-pointer shadow-red-500/50'
                                        : 'bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white cursor-pointer ring-2 ring-purple-400 hover:ring-purple-300 shadow-purple-500/50 hover:shadow-xl hover:scale-105'
                                    }`}
                                  >
                                    <div className="break-words w-full px-2 text-base sm:text-lg md:text-xl">
                                      {useNames ? player.name : `Jugador ${player.number}`}
                                    </div>
                                    {selectedVoteTarget && selectedVoteTarget.number === player.number && (
                                      <div className="text-sm sm:text-base mt-2">‚úì Seleccionado</div>
                                    )}
                                    {player.isEliminated && (
                                      <div className="text-sm sm:text-base mt-2">üíÄ Eliminado</div>
                                    )}
                                  </button>
                                ))}
                              </div>
                            </div>
                          )}

                          <div className="flex gap-3 sm:gap-4 justify-center">
                            <button
                              onClick={() => {
                                setVotingStarted(false);
                                setCurrentVotingPlayerIndex(0);
                                setAnonymousVotes({});
                                setSelectedVoteTarget(null);
                                setLockUnlocked(false);
                              }}
                              className={`px-6 sm:px-8 py-3 sm:py-4 rounded-xl font-bold text-base sm:text-lg transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 ${isLightMode ? 'bg-gray-300 hover:bg-gray-400 text-gray-800' : 'bg-gray-700/80 hover:bg-gray-600/90 text-white'}`}
                            >
                              Cancelar
                            </button>
                            {lockUnlocked && (
                              <button
                                onClick={confirmAnonymousVote}
                                disabled={!selectedVoteTarget}
                                className={`px-6 sm:px-8 py-3 sm:py-4 rounded-xl font-bold text-base sm:text-lg transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 ${
                                  selectedVoteTarget
                                    ? 'bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 shadow-red-500/50'
                                    : `${isLightMode ? 'bg-gray-300 text-gray-500' : 'bg-gray-700 text-gray-500'} cursor-not-allowed`
                                }`}
                              >
                                {currentPlayerNumber < totalPlayers ? 'Confirmar y Siguiente' : 'Confirmar Voto Final'}
                              </button>
                            )}
                          </div>
                        </div>
                      );
                    })()
                  ) : (
                    // Resultado del voto an√≥nimo
                    <div className="text-center py-8 sm:py-12">
                      <h2 className={`text-2xl sm:text-3xl font-bold mb-6 sm:mb-8 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>Resultado</h2>
                      {votingPlayer.isJester ? (
                        <div className={`${isLightMode ? 'bg-yellow-100 border-2 border-yellow-400' : 'bg-yellow-900/50 border-2 border-yellow-500'} p-6 sm:p-8 rounded-xl mb-6 flex flex-col items-center`}>
                          <div className="mb-4">
                            <JesterIcon size={80} className={`${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`} fill={isLightMode ? '#ca8a04' : '#eab308'}/>
                          </div>
                          <p className={`text-2xl sm:text-3xl font-bold mb-4 ${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`}>Gano el Bufon</p>
                          <button
                            onClick={() => {
                              if (roundNumber === 1) {
                                // Primera ronda: continuar el juego
                                // El buf√≥n ya fue eliminado, solo limpiar estado y continuar
                                setVotingPlayer(null);
                                setRevealingVote(false);
                                setRoundNumber(2);
                                // Limpiar votos para la pr√≥xima ronda
                                if (!anonymousVoting) {
                                  setPublicVotes({});
                                } else {
                                  setVotingStarted(false);
                                  setCurrentVotingPlayerIndex(0);
                                  setAnonymousVotes({});
                                  setSelectedVoteTarget(null);
                                }
                              } else {
                                // Otras rondas: mostrar resultados finales
                                setFinalRevealedPlayers(gameStarted.map(p => p.number));
                                setCurrentlyRevealingPlayer(null);
                                setCardFlipped(false);
                                setShowFinalReveal(true);
                                setVotingPlayer(null);
                                setRevealingVote(false);
                              }
                            }}
                            className="px-8 sm:px-12 py-3 sm:py-4 bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 rounded-xl font-bold text-base sm:text-xl transition-all duration-300 shadow-lg shadow-yellow-500/50 hover:shadow-xl hover:scale-105 text-white"
                          >
                            {roundNumber === 1 ? 'Continuar Juego' : 'Ver Resultados Finales'}
                          </button>
                        </div>
                      ) : (
                        <>
                          <div className={`p-6 sm:p-8 rounded-xl mb-6 sm:mb-8 ${
                            votingPlayer.isImpostor 
                              ? isLightMode ? 'bg-green-100 border-2 border-green-400' : 'bg-green-900/50 border-2 border-green-600'
                              : isLightMode ? 'bg-red-100 border-2 border-red-400' : 'bg-red-900/50 border-2 border-red-600'
                          }`}>
                            <p className="text-4xl sm:text-5xl mb-4">{votingPlayer.isImpostor ? 'üéâ' : 'üò¢'}</p>
                            <p className={`text-xl sm:text-2xl font-bold mb-4 break-words ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                              {getPlayerDisplay(votingPlayer)}
                            </p>
                            {votingPlayer.isImpostor ? (
                              <>
                                <p className={`text-2xl sm:text-3xl font-bold mb-2 ${isLightMode ? 'text-green-600' : 'text-green-400'}`}>¬°ERA IMPOSTOR!</p>
                                {(() => {
                                  const allAreImpostors = gameStarted && gameStarted.length > 0 && gameStarted.every(p => p.isImpostor);
                                  const newImpostorsRemaining = impostorsRemaining - 1;
                                  
                                  // Mostrar mensaje cuando queden 2 o menos impostores y todos son impostores
                                  if (allAreImpostors && newImpostorsRemaining <= 2) {
                                    return (
                                      <div className={`mt-4 p-4 rounded-xl ${isLightMode ? 'bg-gradient-to-r from-red-500 to-orange-500 border-4 border-red-600' : 'bg-gradient-to-r from-red-700 to-orange-700 border-4 border-red-500'}`}>
                                        <p className="text-4xl sm:text-5xl mb-2">üïµÔ∏èüïµÔ∏èüïµÔ∏è</p>
                                        <p className={`text-2xl sm:text-3xl font-bold text-white drop-shadow-lg`}>
                                          ¬°TODOS SON IMPOSTORES!
                                        </p>
                                      </div>
                                    );
                                  }
                                  
                                  if (newImpostorsRemaining === 0) {
                                    return (
                                      <p className={`text-xl sm:text-2xl font-bold mt-4 ${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`}>
                                        üéä ¬°GANARON LOS JUGADORES! üéä
                                      </p>
                                    );
                                  }
                                  
                                  return null;
                                })()}
                              </>
                            ) : (
                              <>
                                <p className={`text-2xl sm:text-3xl font-bold mb-2 ${isLightMode ? 'text-red-600' : 'text-red-400'}`}>Era Inocente...</p>
                            {(() => {
                              // Calcular jugadores honestos restantes despu√©s de eliminar este jugador
                              const honestPlayersRemaining = gameStarted.filter(p => 
                                !p.isEliminated && 
                                p.number !== votingPlayer.number && 
                                !p.isImpostor
                              ).length;
                              // Los impostores ganan solo cuando se eliminan TODOS los inocentes
                              if (honestPlayersRemaining === 0) {
                                return (
                                  <p className={`text-xl sm:text-2xl font-bold mt-4 ${isLightMode ? 'text-red-600' : 'text-red-400'}`}>
                                    üéä ¬°GANARON {impostorCount === 1 ? 'EL IMPOSTOR' : 'LOS IMPOSTORES'}! üéä
                                  </p>
                                );
                              }
                              return null;
                            })()}
                              </>
                            )}
                          </div>
                        </>
                      )}
                      {(() => {
                        // Calcular si los impostores e inocentes est√°n equilibrados despu√©s de eliminar este jugador
                        const remainingPlayers = gameStarted.filter(p => 
                          !p.isEliminated && p.number !== votingPlayer.number
                        );
                        const honestPlayersRemaining = remainingPlayers.filter(p => !p.isImpostor).length;
                        const impostorsRemainingCount = remainingPlayers.filter(p => p.isImpostor).length;
                        const isBalanced = honestPlayersRemaining > 0 && impostorsRemainingCount > 0 && impostorsRemainingCount === honestPlayersRemaining;
                        
                        // Verificar si hay ganadores
                        const hasWinners = (() => {
                          const newImpostorsRemaining = votingPlayer.isImpostor ? impostorsRemaining - 1 : impostorsRemaining;
                          if (newImpostorsRemaining === 0) return true;
                          if (honestPlayersRemaining === 0) return true;
                          if (impostorsRemainingCount >= honestPlayersRemaining) return true;
                          return false;
                        })();
                        
                        // No mostrar el bot√≥n si el buf√≥n fue eliminado (ya se mostr√≥ antes)
                        if (votingPlayer && votingPlayer.isJester) {
                          return null;
                        }
                        
                        return (
                          <>
                            <button
                              onClick={() => {
                                if (isBalanced || hasWinners) {
                                  // Si hay ganadores o est√°n equilibrados, ir directamente a resultados finales
                                  setFinalRevealedPlayers(gameStarted.map(p => p.number));
                                  setCurrentlyRevealingPlayer(null);
                                  setCardFlipped(false);
                                  setShowFinalReveal(true);
                                  setVotingPlayer(null);
                                  setRevealingVote(false);
                                } else {
                                  continueAfterVote();
                                }
                              }}
                              className="px-8 sm:px-12 py-3 sm:py-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 rounded-xl font-bold text-base sm:text-xl transition-all duration-300 shadow-lg shadow-purple-500/50 hover:shadow-xl hover:scale-105"
                            >
                              {(isBalanced || hasWinners) ? 'Ver Resultados Finales' : 'Continuar Juego'}
                            </button>
                            {isBalanced && (
                              <div className={`mt-4 p-3 sm:p-4 rounded-xl text-center ${isLightMode ? 'bg-yellow-50 border-2 border-yellow-400' : 'bg-yellow-900/30 border-2 border-yellow-500'}`}>
                                <p className={`text-sm sm:text-base font-semibold ${isLightMode ? 'text-yellow-800' : 'text-yellow-400'}`}>
                                  ‚öñÔ∏è Los impostores e inocentes est√°n equilibrados ({impostorsRemainingCount} vs {honestPlayersRemaining}). Los impostores ganan.
                                </p>
                              </div>
                            )}
                          </>
                        );
                      })()}
                    </div>
                  )
                ) : (
                  // Modo p√∫blico (voto todos juntos)
                  !votingPlayer ? (
                    <>
                      <div className="text-center mb-6 sm:mb-8">
                        <h2 className={`text-3xl sm:text-4xl font-bold mb-4 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>¬°Hora de Discutir!</h2>
                        <p className={`text-lg sm:text-xl ${isLightMode ? 'text-purple-600' : 'text-purple-300'}`}>Voten para eliminar a un jugador</p>
                      </div>

                      <div className="space-y-4 sm:space-y-6 mb-6 sm:mb-8">
                        <div className={`${isLightMode ? 'bg-yellow-100 border-2 border-yellow-400' : 'bg-yellow-900/30 border-2 border-yellow-600'} p-4 sm:p-6 rounded-xl`}>
                          <p className={`text-sm sm:text-base mb-2 ${isLightMode ? 'text-gray-700' : 'text-gray-400'}`}>Comienza la discusi√≥n</p>
                          <p className={`text-xl sm:text-2xl font-bold break-words ${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`}>
                            üëâ {getPlayerDisplay(gameStarted.find(p => p.number === firstPlayer))}
                          </p>
                        </div>

                        <div className={`${isLightMode ? 'bg-gray-100' : 'bg-gray-700/50'} p-4 sm:p-6 rounded-xl`}>
                          <p className={`text-base sm:text-lg mb-3 ${isLightMode ? 'text-gray-700' : 'text-gray-400'}`}>Jugadores (Toca para votar)</p>
                          <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4">
                            {[...gameStarted].sort((a, b) => a.number - b.number).map((player) => (
                              <button
                                key={player.number}
                                onClick={() => !player.isEliminated && votePlayer(player)}
                                disabled={player.isEliminated}
                                className={`px-5 py-4 sm:px-6 sm:py-5 rounded-xl text-center font-bold text-base sm:text-lg md:text-xl transition-all duration-300 relative shadow-lg min-h-[100px] sm:min-h-[110px] flex flex-col items-center justify-center ${
                                  player.isEliminated
                                    ? `${isLightMode ? 'bg-gray-300 text-gray-500' : 'bg-gray-800 text-gray-600'} opacity-50 cursor-not-allowed`
                                    : 'bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white cursor-pointer ring-2 ring-purple-400 hover:ring-purple-300 shadow-purple-500/50 hover:shadow-xl hover:scale-105'
                                }`}
                              >
                                <div className="break-words w-full px-2 text-base sm:text-lg md:text-xl">
                                  {useNames ? player.name : `Jugador ${player.number}`}
                                </div>
                                {!player.isEliminated && (
                                  <div className="text-sm sm:text-base mt-2 opacity-75">üëÜ Votar</div>
                                )}
                                {player.isEliminated && (
                                  <div className="text-sm sm:text-base mt-2">üíÄ Eliminado</div>
                                )}
                              </button>
                            ))}
                          </div>
                        </div>
                      </div>

                      <button
                        onClick={() => setShowResultsConfirm(true)}
                        className={`w-full px-6 sm:px-8 py-3 sm:py-4 rounded-xl font-bold text-base sm:text-xl transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 ${isLightMode ? 'bg-gray-300 hover:bg-gray-400 text-gray-800' : 'bg-gray-700/80 hover:bg-gray-600/90 text-white'}`}
                      >
                        Terminar Juego y Ver Resultados
                      </button>
                    </>
                  ) : !revealingVote ? (
                    <div className="text-center py-8 sm:py-12">
                      <h2 className={`text-2xl sm:text-3xl font-bold mb-6 sm:mb-8 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>Votaci√≥n</h2>
                      <div className={`${isLightMode ? 'bg-yellow-100 border-2 border-yellow-400' : 'bg-yellow-900/30 border-2 border-yellow-600'} p-6 sm:p-8 rounded-xl mb-6 sm:mb-8`}>
                        <p className={`text-lg sm:text-xl mb-4 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>¬øEliminar a este jugador?</p>
                        <p className={`text-4xl sm:text-5xl font-bold break-words ${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`}>
                          {getPlayerDisplay(votingPlayer)}
                        </p>
                      </div>
                      <div className="flex gap-3 sm:gap-4 justify-center">
                        <button
                          onClick={() => setVotingPlayer(null)}
                          className={`px-6 sm:px-8 py-3 sm:py-4 rounded-xl font-bold text-base sm:text-lg transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 ${isLightMode ? 'bg-gray-300 hover:bg-gray-400 text-gray-800' : 'bg-gray-700/80 hover:bg-gray-600/90 text-white'}`}
                        >
                          Cancelar
                        </button>
                        <button
                          onClick={confirmVote}
                          className="px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 rounded-xl font-bold text-base sm:text-lg transition-all duration-300 shadow-lg shadow-red-500/50 hover:shadow-xl hover:scale-105"
                        >
                          Confirmar Eliminaci√≥n
                        </button>
                      </div>
                    </div>
                  ) : (
                    // Resultado del voto p√∫blico
                    <div className="text-center py-8 sm:py-12">
                      <h2 className={`text-2xl sm:text-3xl font-bold mb-6 sm:mb-8 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>Resultado</h2>
                      {votingPlayer.isJester ? (
                        <div className={`${isLightMode ? 'bg-yellow-100 border-2 border-yellow-400' : 'bg-yellow-900/50 border-2 border-yellow-500'} p-6 sm:p-8 rounded-xl mb-6 flex flex-col items-center`}>
                          <div className="mb-4">
                            <JesterIcon size={80} className={`${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`} fill={isLightMode ? '#ca8a04' : '#eab308'}/>
                          </div>
                          <p className={`text-2xl sm:text-3xl font-bold mb-4 ${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`}>Gano el Bufon</p>
                          <button
                            onClick={() => {
                              if (roundNumber === 1) {
                                // Primera ronda: continuar el juego
                                // El buf√≥n ya fue eliminado, solo limpiar estado y continuar
                                setVotingPlayer(null);
                                setRevealingVote(false);
                                setRoundNumber(2);
                                // Limpiar votos para la pr√≥xima ronda
                                if (!anonymousVoting) {
                                  setPublicVotes({});
                                } else {
                                  setVotingStarted(false);
                                  setCurrentVotingPlayerIndex(0);
                                  setAnonymousVotes({});
                                  setSelectedVoteTarget(null);
                                }
                              } else {
                                // Otras rondas: mostrar resultados finales
                                setFinalRevealedPlayers(gameStarted.map(p => p.number));
                                setCurrentlyRevealingPlayer(null);
                                setCardFlipped(false);
                                setShowFinalReveal(true);
                                setVotingPlayer(null);
                                setRevealingVote(false);
                              }
                            }}
                            className="px-8 sm:px-12 py-3 sm:py-4 bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 rounded-xl font-bold text-base sm:text-xl transition-all duration-300 shadow-lg shadow-yellow-500/50 hover:shadow-xl hover:scale-105 text-white"
                          >
                            {roundNumber === 1 ? 'Continuar Juego' : 'Ver Resultados Finales'}
                          </button>
                        </div>
                      ) : (
                        <>
                          <div className={`p-6 sm:p-8 rounded-xl mb-6 sm:mb-8 ${
                            votingPlayer.isImpostor 
                              ? isLightMode ? 'bg-green-100 border-2 border-green-400' : 'bg-green-900/50 border-2 border-green-600'
                              : isLightMode ? 'bg-red-100 border-2 border-red-400' : 'bg-red-900/50 border-2 border-red-600'
                          }`}>
                            <p className="text-4xl sm:text-5xl mb-4">{votingPlayer.isImpostor ? 'üéâ' : 'üò¢'}</p>
                            <p className={`text-xl sm:text-2xl font-bold mb-4 break-words ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                              {getPlayerDisplay(votingPlayer)}
                            </p>
                            {votingPlayer.isImpostor ? (
                              <>
                                <p className={`text-2xl sm:text-3xl font-bold mb-2 ${isLightMode ? 'text-green-600' : 'text-green-400'}`}>¬°ERA IMPOSTOR!</p>
                                {(() => {
                                  const allAreImpostors = gameStarted && gameStarted.length > 0 && gameStarted.every(p => p.isImpostor);
                                  const newImpostorsRemaining = impostorsRemaining - 1;
                                  
                                  // Mostrar mensaje cuando queden 2 o menos impostores y todos son impostores
                                  if (allAreImpostors && newImpostorsRemaining <= 2) {
                                    return (
                                      <div className={`mt-4 p-4 rounded-xl ${isLightMode ? 'bg-gradient-to-r from-red-500 to-orange-500 border-4 border-red-600' : 'bg-gradient-to-r from-red-700 to-orange-700 border-4 border-red-500'}`}>
                                        <p className="text-4xl sm:text-5xl mb-2">üïµÔ∏èüïµÔ∏èüïµÔ∏è</p>
                                        <p className={`text-2xl sm:text-3xl font-bold text-white drop-shadow-lg`}>
                                          ¬°TODOS SON IMPOSTORES!
                                        </p>
                                      </div>
                                    );
                                  }
                                  
                                  if (newImpostorsRemaining === 0) {
                                    return (
                                      <p className={`text-xl sm:text-2xl font-bold mt-4 ${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`}>
                                        üéä ¬°GANARON LOS JUGADORES! üéä
                                      </p>
                                    );
                                  }
                                  
                                  return null;
                                })()}
                              </>
                            ) : (
                              <>
                                <p className={`text-2xl sm:text-3xl font-bold mb-2 ${isLightMode ? 'text-red-600' : 'text-red-400'}`}>Era Inocente...</p>
                            {(() => {
                              // Calcular jugadores honestos restantes despu√©s de eliminar este jugador
                              const honestPlayersRemaining = gameStarted.filter(p => 
                                !p.isEliminated && 
                                p.number !== votingPlayer.number && 
                                !p.isImpostor
                              ).length;
                              // Los impostores ganan solo cuando se eliminan TODOS los inocentes
                              if (honestPlayersRemaining === 0) {
                                return (
                                  <p className={`text-xl sm:text-2xl font-bold mt-4 ${isLightMode ? 'text-red-600' : 'text-red-400'}`}>
                                    üéä ¬°GANARON {impostorCount === 1 ? 'EL IMPOSTOR' : 'LOS IMPOSTORES'}! üéä
                                  </p>
                                );
                              }
                              return null;
                            })()}
                              </>
                            )}
                          </div>
                        </>
                      )}
                      {(() => {
                        // Calcular si los impostores e inocentes est√°n equilibrados despu√©s de eliminar este jugador
                        const remainingPlayers = gameStarted.filter(p => 
                          !p.isEliminated && p.number !== votingPlayer.number
                        );
                        const honestPlayersRemaining = remainingPlayers.filter(p => !p.isImpostor).length;
                        const impostorsRemainingCount = remainingPlayers.filter(p => p.isImpostor).length;
                        const isBalanced = honestPlayersRemaining > 0 && impostorsRemainingCount > 0 && impostorsRemainingCount === honestPlayersRemaining;
                        
                        // Verificar si hay ganadores
                        const hasWinners = (() => {
                          const newImpostorsRemaining = votingPlayer.isImpostor ? impostorsRemaining - 1 : impostorsRemaining;
                          if (newImpostorsRemaining === 0) return true;
                          if (honestPlayersRemaining === 0) return true;
                          if (impostorsRemainingCount >= honestPlayersRemaining) return true;
                          return false;
                        })();
                        
                        // No mostrar el bot√≥n si el buf√≥n fue eliminado (ya se mostr√≥ antes)
                        if (votingPlayer && votingPlayer.isJester) {
                          return null;
                        }
                        
                        return (
                          <>
                            <button
                              onClick={() => {
                                if (isBalanced || hasWinners) {
                                  // Si hay ganadores o est√°n equilibrados, ir directamente a resultados finales
                                  setFinalRevealedPlayers(gameStarted.map(p => p.number));
                                  setCurrentlyRevealingPlayer(null);
                                  setCardFlipped(false);
                                  setShowFinalReveal(true);
                                  setVotingPlayer(null);
                                  setRevealingVote(false);
                                } else {
                                  continueAfterVote();
                                }
                              }}
                              className="px-8 sm:px-12 py-3 sm:py-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 rounded-xl font-bold text-base sm:text-xl transition-all duration-300 shadow-lg shadow-purple-500/50 hover:shadow-xl hover:scale-105"
                            >
                              {(isBalanced || hasWinners) ? 'Ver Resultados Finales' : 'Continuar Juego'}
                            </button>
                            {isBalanced && (
                              <div className={`mt-4 p-3 sm:p-4 rounded-xl text-center ${isLightMode ? 'bg-yellow-50 border-2 border-yellow-400' : 'bg-yellow-900/30 border-2 border-yellow-500'}`}>
                                <p className={`text-sm sm:text-base font-semibold ${isLightMode ? 'text-yellow-800' : 'text-yellow-400'}`}>
                                  ‚öñÔ∏è Los impostores e inocentes est√°n equilibrados ({impostorsRemainingCount} vs {honestPlayersRemaining}). Los impostores ganan.
                                </p>
                              </div>
                            )}
                          </>
                        );
                      })()}
                    </div>
                  )
                )}
              </div>
            ) : finalRevealedPlayers.length === gameStarted.length ? (
              // Vista de resultados finales (todos los jugadores revelados)
              <div className={`${isLightMode ? 'bg-white/90' : 'bg-gray-800/50'} backdrop-blur-sm rounded-2xl p-4 sm:p-8 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-transparent'}`}>
                <h2 className={`text-2xl sm:text-3xl font-bold mb-6 sm:mb-8 text-center ${isLightMode ? 'text-gray-800' : 'text-white'}`}>¬°Resultados Finales!</h2>

                {(() => {
                  const allAreImpostors = gameStarted && gameStarted.length > 0 && gameStarted.every(p => p.isImpostor);
                  return allAreImpostors ? (
                    <div className={`${isLightMode ? 'bg-gradient-to-r from-red-500 to-orange-500 border-4 border-red-600' : 'bg-gradient-to-r from-red-700 to-orange-700 border-4 border-red-500'} p-6 sm:p-8 rounded-xl mb-6 sm:mb-8 text-center shadow-2xl animate-pulse`}>
                      <p className="text-6xl sm:text-7xl mb-4">üïµÔ∏èüïµÔ∏èüïµÔ∏è</p>
                      <p className={`text-4xl sm:text-5xl md:text-6xl font-bold text-white drop-shadow-lg`}>
                        ¬°TODOS SON IMPOSTORES!
                      </p>
                    </div>
                  ) : null;
                })()}

                {winners === 'players' && (
                  <div className={`${isLightMode ? 'bg-yellow-100 border-2 border-yellow-400' : 'bg-yellow-900/50 border-2 border-yellow-500'} p-6 sm:p-8 rounded-xl mb-4 sm:mb-6 text-center`}>
                    <p className={`text-3xl sm:text-4xl font-bold mb-2 ${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`}>
                      üéä ¬°GANARON LOS JUGADORES! üéä
                    </p>
                    <p className={`text-lg sm:text-xl ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                      Todos los impostores fueron eliminados
                    </p>
                  </div>
                )}

                {winners === 'impostors' && (
                  <div className={`${isLightMode ? 'bg-red-100 border-2 border-red-400' : 'bg-red-900/50 border-2 border-red-500'} p-6 sm:p-8 rounded-xl mb-4 sm:mb-6 text-center`}>
                    <p className={`text-3xl sm:text-4xl font-bold mb-2 ${isLightMode ? 'text-red-600' : 'text-red-400'}`}>
                      üéä ¬°GANARON {impostorCount === 1 ? 'EL IMPOSTOR' : 'LOS IMPOSTORES'}! üéä
                    </p>
                    <p className={`text-lg sm:text-xl ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                      {impostorCount === 1 
                        ? 'El impostor super√≥ en n√∫mero a los jugadores honestos'
                        : 'Los impostores superaron en n√∫mero a los jugadores honestos'}
                    </p>
                  </div>
                )}

                {winners === 'jester' && (
                  <div className={`${isLightMode ? 'bg-yellow-100 border-2 border-yellow-400' : 'bg-yellow-900/50 border-2 border-yellow-500'} p-6 sm:p-8 rounded-xl mb-4 sm:mb-6 text-center`}>
                    <div className="flex justify-center mb-4">
                      <JesterIcon size={80} className={`${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`} fill={isLightMode ? '#ca8a04' : '#eab308'}/>
                    </div>
                    <p className={`text-3xl sm:text-4xl font-bold mb-2 ${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`}>
                      El buf√≥n fue eliminado
                    </p>
                  </div>
                )}

                {(() => {
                  const allAreImpostors = gameStarted && gameStarted.length > 0 && gameStarted.every(p => p.isImpostor);
                  return !allAreImpostors ? (
                    <div className={`${isLightMode ? 'bg-green-100 border-2 border-green-400' : 'bg-green-900/50'} p-6 sm:p-8 rounded-xl mb-4 sm:mb-6`}>
                      <p className={`text-base sm:text-xl mb-3 text-center ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>La palabra secreta era:</p>
                      <p className={`text-4xl sm:text-5xl font-bold text-center break-words ${isLightMode ? 'text-green-600' : 'text-green-400'}`}>{selectedWord}</p>
                      <p className={`text-sm sm:text-lg mt-3 text-center ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>Categor√≠a: {selectedCategory}</p>
                    </div>
                  ) : null;
                })()}

                <div className={`${isLightMode ? 'bg-red-100 border-2 border-red-400' : 'bg-red-900/50'} p-4 sm:p-6 rounded-xl mb-4 sm:mb-6`}>
                  <p className={`text-lg sm:text-xl font-bold mb-4 text-center ${isLightMode ? 'text-red-600' : 'text-red-400'}`}>üïµÔ∏è IMPOSTORES üïµÔ∏è</p>
                  <div className="flex justify-center gap-2 sm:gap-3 flex-wrap">
                    {gameStarted.filter(p => p.isImpostor).map((player) => (
                      <div key={player.number} className={`px-4 sm:px-6 py-2 sm:py-3 rounded-lg font-bold text-base sm:text-xl break-words ${isLightMode ? 'bg-red-200 text-red-800' : 'bg-red-700 text-white'}`}>
                        {getPlayerDisplay(player)}
                      </div>
                    ))}
                  </div>
                </div>

                {(() => {
                  const jesterPlayer = gameStarted.find(p => p.isJester);
                  const accomplicePlayer = gameStarted.find(p => p.isAccomplice);
                  const lostPlayer = gameStarted.find(p => p.isLost);
                  
                  if (!jesterPlayer && !accomplicePlayer && !lostPlayer) return null;
                  
                  return (
                    <div className="space-y-4 mb-4 sm:mb-6">
                      {jesterPlayer && (
                        <div className={`${isLightMode ? 'bg-yellow-100 border-2 border-yellow-400' : 'bg-yellow-900/50 border-2 border-yellow-500'} p-4 sm:p-6 rounded-xl`}>
                          <div className="flex items-center justify-center gap-2 mb-3">
                            <JesterIcon size={32} className={`${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`} fill={isLightMode ? '#ca8a04' : '#eab308'}/>
                            <p className={`text-lg sm:text-xl font-bold ${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`}>BUF√ìN</p>
                            <JesterIcon size={32} className={`${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`} fill={isLightMode ? '#ca8a04' : '#eab308'}/>
                          </div>
                          <div className="flex justify-center">
                            <div className={`px-4 sm:px-6 py-2 sm:py-3 rounded-lg font-bold text-base sm:text-xl break-words ${isLightMode ? 'bg-yellow-200 text-yellow-800' : 'bg-yellow-700 text-white'}`}>
                              {getPlayerDisplay(jesterPlayer)}
                            </div>
                          </div>
                        </div>
                      )}
                      
                      {accomplicePlayer && (
                        <div className={`${isLightMode ? 'bg-blue-100 border-2 border-blue-400' : 'bg-blue-900/50 border-2 border-blue-500'} p-4 sm:p-6 rounded-xl`}>
                          <p className={`text-lg sm:text-xl font-bold mb-3 text-center ${isLightMode ? 'text-blue-600' : 'text-blue-400'}`}>üï∂Ô∏è C√ìMPLICE üï∂Ô∏è</p>
                          <div className="flex justify-center">
                            <div className={`px-4 sm:px-6 py-2 sm:py-3 rounded-lg font-bold text-base sm:text-xl break-words ${isLightMode ? 'bg-blue-200 text-blue-800' : 'bg-blue-700 text-white'}`}>
                              {getPlayerDisplay(accomplicePlayer)}
                            </div>
                          </div>
                        </div>
                      )}
                      
                      {lostPlayer && (
                        <div className={`${isLightMode ? 'bg-purple-100 border-2 border-purple-400' : 'bg-purple-900/50 border-2 border-purple-500'} p-4 sm:p-6 rounded-xl`}>
                          <p className={`text-lg sm:text-xl font-bold mb-3 text-center ${isLightMode ? 'text-purple-600' : 'text-purple-400'}`}>üîç EL PERDIDO üîç</p>
                          <div className="flex justify-center">
                            <div className={`px-4 sm:px-6 py-2 sm:py-3 rounded-lg font-bold text-base sm:text-xl break-words ${isLightMode ? 'bg-purple-200 text-purple-800' : 'bg-purple-700 text-white'}`}>
                              {getPlayerDisplay(lostPlayer)}
                            </div>
                          </div>
                          <p className={`text-sm sm:text-base mt-3 text-center ${isLightMode ? 'text-purple-700' : 'text-purple-300'}`}>
                            Su palabra era: <span className="font-bold">{lostPlayer.word}</span>
                          </p>
                        </div>
                      )}
                    </div>
                  );
                })()}

                {(() => {
                  const allAreImpostors = gameStarted && gameStarted.length > 0 && gameStarted.every(p => p.isImpostor);
                  const honestPlayers = gameStarted.filter(p => !p.isImpostor && !p.isLost);
                  
                  return allAreImpostors ? (
                    <div className={`${isLightMode ? 'bg-gray-100 border-2 border-gray-300' : 'bg-gray-800/50 border-2 border-gray-700'} p-4 sm:p-6 rounded-xl mb-6 sm:mb-8`}>
                      <p className={`text-lg sm:text-xl font-bold mb-2 text-center ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>‚úÖ JUGADORES HONESTOS ‚úÖ</p>
                      <p className={`text-base sm:text-lg text-center ${isLightMode ? 'text-gray-500' : 'text-gray-500'}`}>
                        No hay jugadores honestos en esta partida
                      </p>
                    </div>
                  ) : (
                    <div className={`${isLightMode ? 'bg-blue-100 border-2 border-blue-400' : 'bg-blue-900/50'} p-4 sm:p-6 rounded-xl mb-6 sm:mb-8`}>
                      <p className={`text-lg sm:text-xl font-bold mb-4 text-center ${isLightMode ? 'text-blue-600' : 'text-blue-400'}`}>‚úÖ JUGADORES HONESTOS ‚úÖ</p>
                      <div className="flex justify-center gap-2 sm:gap-3 flex-wrap">
                        {honestPlayers.map((player) => (
                          <div key={player.number} className={`px-4 sm:px-5 py-2.5 sm:py-3 rounded-lg font-bold text-sm sm:text-base break-words min-w-fit ${isLightMode ? 'bg-blue-200 text-blue-800' : 'bg-blue-700 text-white'}`}>
                            {useNames ? player.name : player.number}
                          </div>
                        ))}
                      </div>
                    </div>
                  );
                })()}

                <div className="flex flex-col sm:flex-row gap-3 sm:gap-4">
                  <button
                    onClick={playAgain}
                    className="flex-1 px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 rounded-xl font-bold text-base sm:text-xl transition-all duration-300 shadow-lg shadow-purple-500/50 hover:shadow-xl hover:scale-105 flex items-center justify-center gap-2"
                  >
                    <svg className="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span className="text-center">Siguiente ronda</span>
                  </button>
                  <button
                    onClick={goToStart}
                    className="flex-1 px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 rounded-xl font-bold text-base sm:text-xl transition-all duration-300 shadow-lg shadow-gray-500/50 hover:shadow-xl hover:scale-105 flex items-center justify-center gap-2"
                  >
                    <svg className="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    <span className="text-center">Reiniciar Juego y Configuraci√≥n</span>
                  </button>
                </div>
              </div>
            ) : currentlyRevealingPlayer && showFinalReveal ? (
              // Vista de revelaci√≥n individual del jugador con animaci√≥n 3D de carta (fase final)
              <div className={`${isLightMode ? 'bg-white/90' : 'bg-black'} backdrop-blur-sm rounded-2xl p-4 sm:p-6 shadow-2xl border-4 ${isLightMode ? 'border-gray-300' : 'border-black'} relative overflow-hidden`} style={{borderRadius: '1rem'}}>
                <div className="text-center py-4 sm:py-6 flex items-center justify-center" style={{minHeight: '60vh'}}>
                  <div className="card-flip-container" style={{width: '90%', maxWidth: '400px', height: '400px', position: 'relative'}}>
                    <div className={`card-flip ${cardFlipped ? 'flipped' : ''}`} style={{width: '100%', height: '100%'}}>
                      {/* Lado frontal de la carta - Candado */}
                      <div 
                        className="card-front" 
                        onClick={() => setCardFlipped(true)}
                        style={{display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', padding: '1.5rem', borderRadius: '1rem', border: '4px solid #9333ea', cursor: 'pointer'}}
                      >
                        <div className="relative w-full text-center">
                          <p className={`text-xl sm:text-2xl font-bold mb-4 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                            {getPlayerDisplay(currentlyRevealingPlayer)}
                          </p>
                          <div className="mb-6 flex justify-center">
                            <span className="text-6xl sm:text-7xl">üîí</span>
                          </div>
                          <p className={`text-lg sm:text-xl font-bold uppercase ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                            CLICK PARA VER
                          </p>
                        </div>
                      </div>
                      
                      {/* Lado trasero de la carta - Contenido revelado */}
                      <div className="card-back" style={{display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '1.5rem', borderRadius: '1rem', border: `4px solid ${currentlyRevealingPlayer.isImpostor ? '#ef4444' : currentlyRevealingPlayer.isJester ? '#eab308' : currentlyRevealingPlayer.isAccomplice ? '#3b82f6' : currentlyRevealingPlayer.isLost ? '#a855f7' : '#22c55e'}`}}>
                        <div className="animate-flip-in w-full">
                          <h3 className={`text-xl sm:text-2xl font-bold mb-3 sm:mb-4 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                            {getPlayerDisplay(currentlyRevealingPlayer)}
                          </h3>
                          {currentlyRevealingPlayer.isImpostor ? (
                            <div className={`${isLightMode ? 'bg-red-100 border-2 border-red-300' : 'bg-red-900/50'} p-4 sm:p-6 rounded-xl mb-4 sm:mb-6`}>
                              <p className="text-4xl sm:text-5xl mb-3">üïµÔ∏è</p>
                              <p className={`text-xl sm:text-2xl font-bold mb-2 ${isLightMode ? 'text-red-600' : 'text-red-400'}`}>
                                ¬°Es el IMPOSTOR!
                              </p>
                            </div>
                          ) : currentlyRevealingPlayer.isJester ? (
                            <div className={`${isLightMode ? 'bg-yellow-100 border-2 border-yellow-300' : 'bg-yellow-900/50'} p-4 sm:p-6 rounded-xl mb-4 sm:mb-6`}>
                              <div className="flex justify-center mb-3">
                                <JesterIcon size={64} className={`${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`} fill={isLightMode ? '#ca8a04' : '#eab308'}/>
                              </div>
                              <p className={`text-xl sm:text-2xl font-bold mb-2 ${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`}>
                                ¬°Es el BUF√ìN!
                              </p>
                              <p className={`text-sm sm:text-base mb-3 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                Su palabra era:
                              </p>
                              <p className={`text-3xl sm:text-4xl font-bold mb-3 ${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`}>{currentlyRevealingPlayer.word}</p>
                            </div>
                          ) : currentlyRevealingPlayer.isAccomplice ? (
                            <div className={`${isLightMode ? 'bg-blue-100 border-2 border-blue-300' : 'bg-blue-900/50'} p-4 sm:p-6 rounded-xl mb-4 sm:mb-6`}>
                              <p className="text-4xl sm:text-5xl mb-3">üï∂Ô∏è</p>
                              <p className={`text-xl sm:text-2xl font-bold mb-2 ${isLightMode ? 'text-blue-600' : 'text-blue-400'}`}>
                                ¬°Es el C√ìMPLICE!
                              </p>
                              <p className={`text-sm sm:text-base mb-3 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                Su palabra era:
                              </p>
                              <p className={`text-3xl sm:text-4xl font-bold mb-3 ${isLightMode ? 'text-blue-600' : 'text-blue-400'}`}>{currentlyRevealingPlayer.word}</p>
                              {currentlyRevealingPlayer.knowsImpostor && currentlyRevealingPlayer.knowsImpostor.length > 0 && (
                                <div className={`mt-4 p-3 rounded-lg ${isLightMode ? 'bg-blue-50' : 'bg-blue-800/30'}`}>
                                  <p className={`text-sm font-semibold mb-2 ${isLightMode ? 'text-blue-700' : 'text-blue-300'}`}>
                                    Conoce al impostor:
                                  </p>
                                  <div className="flex flex-wrap gap-2">
                                    {currentlyRevealingPlayer.knowsImpostor.map(impNum => {
                                      const impostor = gameStarted.find(p => p.number === impNum);
                                      return impostor ? (
                                        <span key={impNum} className={`px-3 py-1 rounded-lg text-sm font-bold ${isLightMode ? 'bg-red-200 text-red-700' : 'bg-red-800 text-red-300'}`}>
                                          {getPlayerDisplay(impostor)}
                                        </span>
                                      ) : null;
                                    })}
                                  </div>
                                </div>
                              )}
                            </div>
                          ) : currentlyRevealingPlayer.isLost ? (
                            // El Perdido se muestra como jugador normal en la fase final tambi√©n
                            <div className={`${isLightMode ? 'bg-green-100 border-2 border-green-300' : 'bg-green-900/50'} p-4 sm:p-6 rounded-xl mb-4 sm:mb-6`}>
                              <p className="text-4xl sm:text-5xl mb-3">‚úÖ</p>
                              <p className={`text-sm sm:text-base mb-3 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                Su palabra era:
                              </p>
                              <p className={`text-3xl sm:text-4xl font-bold mb-3 ${isLightMode ? 'text-green-600' : 'text-green-400'}`}>{currentlyRevealingPlayer.word}</p>
                            </div>
                          ) : (
                            <div className={`${isLightMode ? 'bg-green-100 border-2 border-green-300' : 'bg-green-900/50'} p-4 sm:p-6 rounded-xl mb-4 sm:mb-6`}>
                              <p className="text-4xl sm:text-5xl mb-3">‚úÖ</p>
                              <p className={`text-sm sm:text-base mb-3 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                Su palabra era:
                              </p>
                              <p className={`text-3xl sm:text-4xl font-bold mb-3 ${isLightMode ? 'text-green-600' : 'text-green-400'}`}>{currentlyRevealingPlayer.word}</p>
                            </div>
                          )}
                          <button
                            onClick={() => {
                              if (!finalRevealedPlayers.includes(currentlyRevealingPlayer.number)) {
                                setFinalRevealedPlayers([...finalRevealedPlayers, currentlyRevealingPlayer.number]);
                              }
                              setCurrentlyRevealingPlayer(null);
                              setCardFlipped(false);
                            }}
                            className="px-6 sm:px-8 py-2 sm:py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 rounded-xl font-bold text-sm sm:text-base transition-all duration-300 shadow-lg shadow-purple-500/50 hover:shadow-xl hover:scale-105 text-white w-full"
                          >
                            ‚Üê Volver
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            ) : (
              // Vista de selecci√≥n de cartas (interfaz principal de revelaci√≥n)
              <div className={`${isLightMode ? 'bg-white/90' : 'bg-gray-800/50'} backdrop-blur-sm rounded-2xl p-4 sm:p-8 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-transparent'}`}>
                {/* Header con bot√≥n de volver y t√≠tulo */}
                <div className="flex items-center gap-3 mb-6">
                  <button
                    onClick={() => setShowFinalReveal(false)}
                    className={`p-2 rounded-xl transition-all duration-300 ${isLightMode ? 'bg-gray-200 hover:bg-gray-300' : 'bg-gray-700 hover:bg-gray-600'}`}
                  >
                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 19l-7-7 7-7" />
                    </svg>
                  </button>
                  <h2 className={`text-2xl sm:text-3xl font-bold flex-1 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>Elige Tu Carta</h2>
                </div>

                {/* Badge de estado */}
                <div className={`${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-xl px-4 py-2 mb-6 text-center`}>
                  <p className={`text-sm sm:text-base font-semibold ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                    {finalRevealedPlayers.length} de {gameStarted.length} jugadores revelados
                  </p>
                </div>

                {/* Grid de cartas */}
                <div className="grid grid-cols-2 gap-3 sm:gap-4">
                  {[...gameStarted].sort((a, b) => a.number - b.number).map((player) => {
                    const isRevealed = finalRevealedPlayers.includes(player.number);
                    const displayText = useNames ? (player.name || `Jugador ${player.number}`) : `Jugador ${player.number}`;
                    
                    return (
                      <button
                        key={player.number}
                        onClick={() => {
                          if (!isRevealed) {
                            setCardFlipped(false);
                            setCurrentlyRevealingPlayer(player);
                          }
                        }}
                        disabled={isRevealed}
                        className={`relative w-full p-4 sm:p-6 rounded-xl transition-all duration-300 text-center ${
                          isRevealed
                            ? `${isLightMode ? 'bg-gray-300 opacity-60' : 'bg-gray-700 opacity-60'} cursor-default`
                            : `${isLightMode ? 'bg-gray-200 hover:bg-gray-300' : 'bg-gray-700 hover:bg-gray-600'} cursor-pointer hover:scale-105`
                        } border-4 border-purple-500`}
                        style={{minHeight: '180px', display: 'flex', flexDirection: 'column', justifyContent: 'center', alignItems: 'center'}}
                      >
                        {/* Texto del jugador */}
                        <p className={`text-base sm:text-lg font-semibold ${isRevealed ? (isLightMode ? 'text-gray-500' : 'text-gray-500') : (isLightMode ? 'text-gray-800' : 'text-white')}`}>
                          {displayText}
                        </p>
                        
                        {/* Texto "Toca para revelar" */}
                        {!isRevealed && (
                          <p className={`text-xs sm:text-sm mt-2 ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                            Toca para revelar
                          </p>
                        )}
                        
                        {isRevealed && (
                          <p className={`text-xs sm:text-sm mt-2 ${isLightMode ? 'text-gray-500' : 'text-gray-500'}`}>
                            ‚úì Revelado
                          </p>
                        )}
                      </button>
                    );
                  })}
                </div>
              </div>
            )}

            {/* Footer */}
            <div className="text-center mt-6 sm:mt-8 text-gray-400 text-xs sm:text-sm">
              <p>V BETA 0.17.1</p>
              <p className="mt-1">¬©2026 Argentores. Hecho por LosTomobri</p>
            </div>
          </div>


          {/* Modal de Confirmaci√≥n para Salir */}
          {showExitConfirm && (
            <div className={`fixed inset-0 z-50 flex items-center justify-center p-4 ${isLightMode ? 'bg-black/50' : 'bg-black/80'} backdrop-blur-sm`} onClick={() => setShowExitConfirm(false)}>
              <div 
                className={`${isLightMode ? 'bg-white' : 'bg-gray-900'} rounded-2xl p-6 sm:p-8 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-gray-800'} max-w-md w-full`}
                onClick={(e) => e.stopPropagation()}
              >
                <div className="text-center mb-6">
                  <div className="text-5xl sm:text-6xl mb-4">‚ö†Ô∏è</div>
                  <h3 className={`text-xl sm:text-2xl font-bold mb-2 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                    ¬øSalir de la partida?
                  </h3>
                  <p className={`text-sm sm:text-base ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>
                    Se perder√° el progreso actual de la partida. ¬øEst√°s seguro de que quieres continuar?
                  </p>
                </div>
                
                <div className="flex gap-3 sm:gap-4">
                  <button
                    onClick={() => setShowExitConfirm(false)}
                    className={`flex-1 px-6 py-3 rounded-xl font-semibold transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 ${
                      isLightMode 
                        ? 'bg-gray-200 hover:bg-gray-300 text-gray-800' 
                        : 'bg-gray-700/80 hover:bg-gray-600/90 text-white'
                    }`}
                  >
                    Cancelar
                  </button>
                  <button
                    onClick={() => {
                      setShowExitConfirm(false);
                      goToStart();
                    }}
                    className="flex-1 px-6 py-3 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 rounded-xl font-semibold transition-all duration-300 shadow-lg shadow-red-500/50 hover:shadow-xl hover:scale-105 text-white"
                  >
                    Salir
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* Modal de Confirmaci√≥n para Ver Resultados */}
          {showResultsConfirm && (() => {
            // Calcular si los impostores e inocentes est√°n equilibrados
            const remainingPlayers = gameStarted ? gameStarted.filter(p => !p.isEliminated) : [];
            const honestPlayersRemaining = remainingPlayers.filter(p => !p.isImpostor).length;
            const impostorsRemainingCount = remainingPlayers.filter(p => p.isImpostor).length;
            const isBalanced = honestPlayersRemaining > 0 && impostorsRemainingCount > 0 && impostorsRemainingCount === honestPlayersRemaining;
            
            return (
              <div className={`fixed inset-0 z-50 flex items-center justify-center p-4 ${isLightMode ? 'bg-black/50' : 'bg-black/80'} backdrop-blur-sm`} onClick={() => setShowResultsConfirm(false)}>
                <div 
                  className={`${isLightMode ? 'bg-white' : 'bg-gray-900'} rounded-2xl p-6 sm:p-8 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-gray-800'} max-w-md w-full`}
                  onClick={(e) => e.stopPropagation()}
                >
                  <div className="text-center mb-6">
                    <div className="text-5xl sm:text-6xl mb-4">üèÅ</div>
                    <h3 className={`text-xl sm:text-2xl font-bold mb-2 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                      ¬øVer Resultados Finales?
                    </h3>
                    <p className={`text-sm sm:text-base ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>
                      Se terminar√° la partida y se mostrar√°n los resultados. ¬øEst√°s seguro de que quieres continuar?
                    </p>
                  </div>
                  
                  <div className="flex gap-3 sm:gap-4">
                    <button
                      onClick={() => setShowResultsConfirm(false)}
                      className={`flex-1 px-6 py-3 rounded-xl font-semibold transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 ${
                        isLightMode 
                          ? 'bg-gray-200 hover:bg-gray-300 text-gray-800' 
                          : 'bg-gray-700/80 hover:bg-gray-600/90 text-white'
                      }`}
                    >
                      Cancelar
                    </button>
                    <button
                      onClick={() => {
                        setShowResultsConfirm(false);
                        // Si hay una votaci√≥n en curso, usar continueAfterVote, sino solo mostrar resultados
                        if (votingPlayer) {
                          continueAfterVote();
                        } else {
                          // Establecer todos los jugadores como revelados para mostrar resultados finales directamente
                          setFinalRevealedPlayers(gameStarted.map(p => p.number));
                          setCurrentlyRevealingPlayer(null);
                          setCardFlipped(false);
                          setShowFinalReveal(true);
                        }
                      }}
                      className="flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 rounded-xl font-semibold transition-all duration-300 shadow-lg shadow-purple-500/50 hover:shadow-xl hover:scale-105 text-white"
                    >
                      Ver Resultados
                    </button>
                  </div>
                  
                  {isBalanced && (
                    <div className={`mt-4 p-3 sm:p-4 rounded-xl text-center ${isLightMode ? 'bg-yellow-50 border-2 border-yellow-400' : 'bg-yellow-900/30 border-2 border-yellow-500'}`}>
                      <p className={`text-sm sm:text-base font-semibold ${isLightMode ? 'text-yellow-800' : 'text-yellow-400'}`}>
                        ‚öñÔ∏è Los impostores e inocentes est√°n equilibrados ({impostorsRemainingCount} vs {honestPlayersRemaining}). Los impostores ganan.
                      </p>
                    </div>
                  )}
                </div>
              </div>
            );
          })()}

          {/* Modal de Confirmaci√≥n para Eliminar Categor√≠a */}
          {showDeleteCategoryModal && (
            <div className={`fixed inset-0 z-50 flex items-center justify-center p-4 ${isLightMode ? 'bg-black/50' : 'bg-black/80'} backdrop-blur-sm`} onClick={() => setShowDeleteCategoryModal(false)}>
              <div 
                className={`${isLightMode ? 'bg-white' : 'bg-gray-900'} rounded-2xl p-6 sm:p-8 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-gray-800'} max-w-md w-full`}
                onClick={(e) => e.stopPropagation()}
              >
                <div className="text-center mb-6">
                  <div className="text-5xl sm:text-6xl mb-4">üóëÔ∏è</div>
                  <h3 className={`text-xl sm:text-2xl font-bold mb-2 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                    ¬øEliminar categor√≠a?
                  </h3>
                  <p className={`text-sm sm:text-base ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>
                    ¬øEst√°s seguro de que quieres eliminar la categor√≠a <strong className={isLightMode ? 'text-gray-800' : 'text-white'}>"{categoryToDelete}"</strong>? Esta acci√≥n no se puede deshacer.
                  </p>
                </div>
                
                <div className="flex gap-3 sm:gap-4">
                  <button
                    onClick={() => {
                      setShowDeleteCategoryModal(false);
                      setCategoryToDelete(null);
                    }}
                    className={`flex-1 px-6 py-3 rounded-xl font-semibold transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 ${
                      isLightMode 
                        ? 'bg-gray-200 hover:bg-gray-300 text-gray-800' 
                        : 'bg-gray-700/80 hover:bg-gray-600/90 text-white'
                    }`}
                  >
                    Cancelar
                  </button>
                  <button
                    onClick={confirmDeleteCategory}
                    className="flex-1 px-6 py-3 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 rounded-xl font-semibold transition-all duration-300 shadow-lg shadow-red-500/50 hover:shadow-xl hover:scale-105 text-white"
                  >
                    Eliminar
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* Modal de √âxito de Importaci√≥n */}
          {showImportSuccessModal && (
            <div className={`fixed inset-0 z-50 flex items-center justify-center p-4 ${isLightMode ? 'bg-black/50' : 'bg-black/80'} backdrop-blur-sm`} onClick={() => setShowImportSuccessModal(false)}>
              <div 
                className={`${isLightMode ? 'bg-white' : 'bg-gray-900'} rounded-2xl p-6 sm:p-8 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-gray-800'} max-w-md w-full`}
                onClick={(e) => e.stopPropagation()}
              >
                <div className="text-center mb-6">
                  <div className="text-5xl sm:text-6xl mb-4">‚úÖ</div>
                  <h3 className={`text-xl sm:text-2xl font-bold mb-2 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                    ¬°√âxito!
                  </h3>
                  <p className={`text-sm sm:text-base ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>
                    {importedCategoryName.includes('Perfil') 
                      ? importedCategoryName
                      : `Categor√≠a "${importedCategoryName}" importada correctamente.`}
                  </p>
                </div>
                
                <button
                  onClick={() => setShowImportSuccessModal(false)}
                  className="w-full px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 rounded-xl font-semibold transition-all duration-300 shadow-lg shadow-green-500/50 hover:shadow-xl hover:scale-105 text-white"
                >
                  Aceptar
                </button>
              </div>
            </div>
          )}

          {/* Modal de Error de Importaci√≥n */}
          {showImportErrorModal && (
            <div className={`fixed inset-0 z-50 flex items-center justify-center p-4 ${isLightMode ? 'bg-black/50' : 'bg-black/80'} backdrop-blur-sm`} onClick={() => setShowImportErrorModal(false)}>
              <div 
                className={`${isLightMode ? 'bg-white' : 'bg-gray-900'} rounded-2xl p-6 sm:p-8 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-gray-800'} max-w-md w-full`}
                onClick={(e) => e.stopPropagation()}
              >
                <div className="text-center mb-6">
                  <div className="text-5xl sm:text-6xl mb-4">‚ö†Ô∏è</div>
                  <h3 className={`text-xl sm:text-2xl font-bold mb-2 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                    Error
                  </h3>
                  <p className={`text-sm sm:text-base ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>
                    {importErrorMsg}
                  </p>
                </div>
                
                <button
                  onClick={() => setShowImportErrorModal(false)}
                  className="w-full px-6 py-3 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 rounded-xl font-semibold transition-all duration-300 shadow-lg shadow-red-500/50 hover:shadow-xl hover:scale-105 text-white"
                >
                  Aceptar
                </button>
              </div>
            </div>
          )}

          {/* Modal de Confirmaci√≥n para Eliminar Perfil */}
          {showDeleteProfileModal && (
            <div className={`fixed inset-0 z-50 flex items-center justify-center p-4 ${isLightMode ? 'bg-black/50' : 'bg-black/80'} backdrop-blur-sm`} onClick={() => setShowDeleteProfileModal(false)}>
              <div 
                className={`${isLightMode ? 'bg-white' : 'bg-gray-900'} rounded-2xl p-6 sm:p-8 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-gray-800'} max-w-md w-full`}
                onClick={(e) => e.stopPropagation()}
              >
                <div className="text-center mb-6">
                  <div className="text-5xl sm:text-6xl mb-4">üóëÔ∏è</div>
                  <h3 className={`text-xl sm:text-2xl font-bold mb-2 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                    ¬øEliminar perfil?
                  </h3>
                  <p className={`text-sm sm:text-base ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>
                    ¬øEst√°s seguro de que quieres eliminar este perfil? Esta acci√≥n no se puede deshacer.
                  </p>
                </div>
                
                <div className="flex gap-3 sm:gap-4">
                  <button
                    onClick={() => {
                      setShowDeleteProfileModal(false);
                      setProfileToDelete(null);
                    }}
                    className={`flex-1 px-6 py-3 rounded-xl font-semibold transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 ${
                      isLightMode 
                        ? 'bg-gray-200 hover:bg-gray-300 text-gray-800' 
                        : 'bg-gray-700/80 hover:bg-gray-600/90 text-white'
                    }`}
                  >
                    Cancelar
                  </button>
                  <button
                    onClick={confirmDeleteProfile}
                    className="flex-1 px-6 py-3 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 rounded-xl font-semibold transition-all duration-300 shadow-lg shadow-red-500/50 hover:shadow-xl hover:scale-105 text-white"
                  >
                    Eliminar
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* Modal para Guardar Perfil */}
          {showSaveProfileModal && (
            <div className={`fixed inset-0 z-50 flex items-center justify-center p-4 ${isLightMode ? 'bg-black/50' : 'bg-black/80'} backdrop-blur-sm`} onClick={() => {
              setShowSaveProfileModal(false);
              setProfileNameInput('');
            }}>
              <div 
                className={`${isLightMode ? 'bg-white' : 'bg-gray-900'} rounded-2xl p-6 sm:p-8 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-gray-800'} max-w-md w-full`}
                onClick={(e) => e.stopPropagation()}
              >
                <div className="text-center mb-6">
                  <div className="text-5xl sm:text-6xl mb-4">üíæ</div>
                  <h3 className={`text-xl sm:text-2xl font-bold mb-2 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                    Guardar Perfil
                  </h3>
                  <p className={`text-sm sm:text-base mb-4 ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>
                    Ingresa un nombre para este perfil:
                  </p>
                  <input
                    type="text"
                    value={profileNameInput}
                    onChange={(e) => setProfileNameInput(e.target.value)}
                    onKeyPress={(e) => {
                      if (e.key === 'Enter' && profileNameInput.trim()) {
                        confirmSaveProfile();
                      }
                    }}
                    placeholder="Ej: Amigos del trabajo"
                    autoFocus
                    className={`w-full px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm sm:text-base ${
                      isLightMode 
                        ? 'bg-white border-2 border-gray-300 text-gray-800' 
                        : 'bg-gray-700 border-2 border-gray-600 text-white'
                    }`}
                  />
                </div>
                
                <div className="flex gap-3 sm:gap-4">
                  <button
                    onClick={() => {
                      setShowSaveProfileModal(false);
                      setProfileNameInput('');
                    }}
                    className={`flex-1 px-6 py-3 rounded-xl font-semibold transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 ${
                      isLightMode 
                        ? 'bg-gray-200 hover:bg-gray-300 text-gray-800' 
                        : 'bg-gray-700/80 hover:bg-gray-600/90 text-white'
                    }`}
                  >
                    Cancelar
                  </button>
                  <button
                    onClick={confirmSaveProfile}
                    disabled={!profileNameInput.trim()}
                    className={`flex-1 px-6 py-3 rounded-xl font-semibold transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 ${
                      profileNameInput.trim()
                        ? 'bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white'
                        : 'bg-gray-600 cursor-not-allowed opacity-50 text-white'
                    }`}
                  >
                    Guardar
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* Modal de Confirmaci√≥n para Reemplazar Categor√≠a */}
          {showReplaceCategoryModal && (
            <div className={`fixed inset-0 z-50 flex items-center justify-center p-4 ${isLightMode ? 'bg-black/50' : 'bg-black/80'} backdrop-blur-sm`} onClick={() => {
              setShowReplaceCategoryModal(false);
              setPendingImport(null);
            }}>
              <div 
                className={`${isLightMode ? 'bg-white' : 'bg-gray-900'} rounded-2xl p-6 sm:p-8 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-gray-800'} max-w-md w-full`}
                onClick={(e) => e.stopPropagation()}
              >
                <div className="text-center mb-6">
                  <div className="text-5xl sm:text-6xl mb-4">‚ö†Ô∏è</div>
                  <h3 className={`text-xl sm:text-2xl font-bold mb-2 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                    Categor√≠a existente
                  </h3>
                  <p className={`text-sm sm:text-base ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>
                    La categor√≠a <strong className={isLightMode ? 'text-gray-800' : 'text-white'}>"{pendingImport?.name}"</strong> ya existe. ¬øQuieres reemplazarla?
                  </p>
                </div>
                
                <div className="flex gap-3 sm:gap-4">
                  <button
                    onClick={() => {
                      setShowReplaceCategoryModal(false);
                      setPendingImport(null);
                    }}
                    className={`flex-1 px-6 py-3 rounded-xl font-semibold transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 ${
                      isLightMode 
                        ? 'bg-gray-200 hover:bg-gray-300 text-gray-800' 
                        : 'bg-gray-700/80 hover:bg-gray-600/90 text-white'
                    }`}
                  >
                    Cancelar
                  </button>
                  <button
                    onClick={confirmReplaceCategory}
                    className="flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 rounded-xl font-semibold transition-all duration-300 shadow-lg shadow-purple-500/50 hover:shadow-xl hover:scale-105 text-white"
                  >
                    Reemplazar
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* Modal de ¬øC√≥mo jugar? */}
          {/* Modal de PWA - Ir a la aplicaci√≥n */}
          {showPWAOpenModal && (
            <div className={`fixed inset-0 z-50 flex items-center justify-center p-4 ${isLightMode ? 'bg-black/50' : 'bg-black/80'} backdrop-blur-sm`} onClick={() => {
              setShowPWAOpenModal(false);
              sessionStorage.setItem('pwa_open_modal_dismissed', 'true');
            }}>
              <div 
                className={`${isLightMode ? 'bg-white' : 'bg-gray-900'} rounded-2xl p-6 sm:p-8 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-gray-800'} max-w-md w-full`}
                onClick={(e) => e.stopPropagation()}
              >
                <div className="text-center mb-6">
                  <div className="text-5xl sm:text-6xl mb-4">üì±</div>
                  <h3 className={`text-xl sm:text-2xl font-bold mb-2 ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                    ¬øIr a la aplicaci√≥n?
                  </h3>
                  <p className={`text-sm sm:text-base ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>
                    Tienes la aplicaci√≥n instalada. ¬øQuieres abrirla en lugar de usar la versi√≥n web?
                  </p>
                </div>
                
                <div className="flex gap-3 sm:gap-4">
                  <button
                    onClick={() => {
                      setShowPWAOpenModal(false);
                      sessionStorage.setItem('pwa_open_modal_dismissed', 'true');
                    }}
                    className={`flex-1 px-6 py-3 rounded-xl font-semibold transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 ${
                      isLightMode 
                        ? 'bg-gray-200 hover:bg-gray-300 text-gray-800' 
                        : 'bg-gray-700/80 hover:bg-gray-600/90 text-white'
                    }`}
                  >
                    Continuar aqu√≠
                  </button>
                  <button
                    onClick={() => {
                      // Intentar abrir la app usando el protocolo personalizado o la URL de la app
                      // En Android, intentar abrir con intent://
                      // En iOS, no hay forma directa, pero podemos mostrar instrucciones
                      const userAgent = navigator.userAgent;
                      const isAndroid = /Android/i.test(userAgent);
                      const isIOS = /iPad|iPhone|iPod/.test(userAgent);
                      
                      if (isAndroid) {
                        // Intentar abrir la app en Android
                        window.location.href = 'intent://#Intent;scheme=https;package=com.android.chrome;end';
                        // Fallback: mostrar instrucciones
                        setTimeout(() => {
                          setImportErrorMsg('Para abrir la aplicaci√≥n:\n1. Cierra esta pesta√±a\n2. Abre la aplicaci√≥n desde el men√∫ de aplicaciones');
                          setShowImportErrorModal(true);
                          setShowPWAOpenModal(false);
                        }, 1000);
                      } else if (isIOS) {
                        setImportErrorMsg('Para abrir la aplicaci√≥n:\n1. Cierra esta pesta√±a\n2. Abre la aplicaci√≥n desde la pantalla de inicio');
                        setShowImportErrorModal(true);
                        setShowPWAOpenModal(false);
                      } else {
                        // Desktop: mostrar instrucciones
                        setImportErrorMsg('Para abrir la aplicaci√≥n:\n1. Busca "ARGENTORES" en tu men√∫ de aplicaciones\n2. O usa el acceso directo en tu escritorio');
                        setShowImportErrorModal(true);
                        setShowPWAOpenModal(false);
                      }
                      sessionStorage.setItem('pwa_open_modal_dismissed', 'true');
                    }}
                    className="flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 rounded-xl font-semibold transition-all duration-300 shadow-lg shadow-purple-500/50 hover:shadow-xl hover:scale-105 text-white"
                  >
                    Ir a la app
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* Modal de Desbloqueo Premium */}
          {showUnlockModal && (
            <div className={`fixed inset-0 z-50 flex items-center justify-center p-4 ${isLightMode ? 'bg-black/50' : 'bg-black/80'} backdrop-blur-sm`} onClick={() => {
              setShowUnlockModal(false);
              setPremiumCodeInput('');
              setPremiumError('');
            }}>
              <div 
                className={`${isLightMode ? 'bg-white' : 'bg-gray-900'} rounded-2xl p-6 sm:p-8 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-gray-800'} max-w-md w-full`}
                onClick={(e) => e.stopPropagation()}
              >
                {/* Header con t√≠tulo y bot√≥n cerrar */}
                <div className="flex items-center justify-between mb-6">
                  <div className="flex items-center gap-3">
                    <svg className="w-6 h-6 sm:w-7 sm:h-7" viewBox="0 0 24 24" fill="none">
                      <defs>
                        <linearGradient id="orangeGradientModal" x1="0%" y1="0%" x2="100%" y2="100%">
                          <stop offset="0%" stopColor="#f97316" />
                          <stop offset="100%" stopColor="#ea580c" />
                        </linearGradient>
                      </defs>
                      <path d="M5 16L3 5l5.5 5L12 4l3.5 6L21 5l-2 11H5zm2 4h10v2H7v-2z" fill="url(#orangeGradientModal)" />
                      <path d="M9 11l3-2 3 2" fill="url(#orangeGradientModal)" opacity="0.8" />
                    </svg>
                    <h3 className={`text-xl sm:text-2xl font-bold ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                      Desbloquear Pro
                    </h3>
                  </div>
                  <button
                    onClick={() => {
                      setShowUnlockModal(false);
                      setPremiumCodeInput('');
                      setPremiumError('');
                    }}
                    className={`p-2 rounded-lg transition-all duration-300 ${isLightMode ? 'hover:bg-gray-200 text-gray-600' : 'hover:bg-gray-700 text-gray-400'}`}
                  >
                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>

                {/* Descripci√≥n */}
                <p className={`text-sm sm:text-base mb-6 ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>
                  El modo Pro a√±ade roles especiales como el Buf√≥n y el C√≥mplice. Adem√°s, desbloquea m√°s categor√≠as para divertirse.
                </p>

                {/* Label para el input */}
                <label className={`block text-xs sm:text-sm font-semibold mb-2 ${isLightMode ? 'text-gray-700' : 'text-white'}`}>
                  INTRODUCE C√ìDIGO
                </label>

                {/* Input de c√≥digo */}
                <input
                  type="text"
                  value={premiumCodeInput}
                  onChange={(e) => {
                    setPremiumCodeInput(e.target.value);
                    setPremiumError('');
                  }}
                  onKeyPress={(e) => {
                    if (e.key === 'Enter') {
                      validatePremiumCode(premiumCodeInput);
                    }
                  }}
                  placeholder="TU-CODIGO-SECRETO"
                  className={`w-full px-4 py-3 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base mb-4 ${
                    isLightMode 
                      ? 'bg-gray-100 text-gray-800 border-2 border-gray-300 focus:border-blue-500' 
                      : 'bg-gray-800 text-white border-2 border-gray-700 focus:border-blue-500'
                  } focus:outline-none focus:ring-2 focus:ring-blue-500/50`}
                />

                {/* Mensaje de error */}
                {premiumError && (
                  <p className={`text-sm mb-4 ${isLightMode ? 'text-red-600' : 'text-red-400'}`}>
                    {premiumError}
                  </p>
                )}

                {/* Bot√≥n de desbloquear */}
                <button
                  onClick={() => validatePremiumCode(premiumCodeInput)}
                  className="w-full px-6 py-4 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 rounded-xl font-semibold transition-all duration-300 shadow-lg shadow-orange-500/50 hover:shadow-xl hover:scale-105 text-white text-sm sm:text-base"
                >
                  Desbloquear
                </button>
              </div>
            </div>
          )}

          {showHowToPlayModal && (
            <div className={`fixed inset-0 z-50 flex items-center justify-center p-2 sm:p-4 ${isLightMode ? 'bg-black/50' : 'bg-black/80'} backdrop-blur-sm overflow-y-auto`} onClick={() => setShowHowToPlayModal(false)}>
              <div 
                className={`${isLightMode ? 'bg-white' : 'bg-gray-900'} rounded-xl sm:rounded-2xl p-4 sm:p-6 md:p-8 shadow-2xl border ${isLightMode ? 'border-gray-200' : 'border-gray-800'} max-w-2xl w-full my-4 sm:my-8 max-h-[95vh] overflow-y-auto`}
                onClick={(e) => e.stopPropagation()}
              >
                <div className="flex items-center justify-between mb-4 sm:mb-6">
                  <h2 className={`text-xl sm:text-2xl md:text-3xl font-bold ${isLightMode ? 'text-yellow-600' : 'text-yellow-400'}`}>
                    C√ìMO JUGAR
                  </h2>
                  <button
                    onClick={() => setShowHowToPlayModal(false)}
                    className={`text-2xl sm:text-3xl hover:scale-110 transition-transform ${isLightMode ? 'text-gray-600 hover:text-gray-800' : 'text-gray-400 hover:text-white'}`}
                  >
                    √ó
                  </button>
                </div>

                {/* Lista de reglas */}
                <div className="space-y-2 sm:space-y-3 md:space-y-4 mb-6 sm:mb-8">
                  <div className={`flex items-start gap-2 sm:gap-3 md:gap-4 p-3 sm:p-4 rounded-lg sm:rounded-xl ${isLightMode ? 'bg-gray-50' : 'bg-gray-800'}`}>
                    <span className="text-2xl sm:text-3xl md:text-4xl flex-shrink-0">üé≠</span>
                    <p className={`flex-1 text-xs sm:text-sm md:text-base ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                      Los jugadores reciben una palabra secreta
                    </p>
                  </div>

                  <div className={`flex items-start gap-2 sm:gap-3 md:gap-4 p-3 sm:p-4 rounded-lg sm:rounded-xl ${isLightMode ? 'bg-gray-50' : 'bg-gray-800'}`}>
                    <span className="text-2xl sm:text-3xl md:text-4xl flex-shrink-0">üïµÔ∏è</span>
                    <p className={`flex-1 text-xs sm:text-sm md:text-base ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                      Los impostores no reciben nada
                    </p>
                  </div>

                  <div className={`flex items-start gap-2 sm:gap-3 md:gap-4 p-3 sm:p-4 rounded-lg sm:rounded-xl ${isLightMode ? 'bg-gray-50' : 'bg-gray-800'}`}>
                    <span className="text-2xl sm:text-3xl md:text-4xl flex-shrink-0">üí¨</span>
                    <p className={`flex-1 text-xs sm:text-sm md:text-base ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                      Todos dicen una palabra relacionada en sentido horario
                    </p>
                  </div>

                  <div className={`flex items-start gap-2 sm:gap-3 md:gap-4 p-3 sm:p-4 rounded-lg sm:rounded-xl ${isLightMode ? 'bg-gray-50' : 'bg-gray-800'}`}>
                    <span className="text-2xl sm:text-3xl md:text-4xl flex-shrink-0">üó≥Ô∏è</span>
                    <p className={`flex-1 text-xs sm:text-sm md:text-base ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                      Luego de una ronda votan para eliminar sospechosos
                    </p>
                  </div>

                  <div className={`flex items-start gap-2 sm:gap-3 md:gap-4 p-3 sm:p-4 rounded-lg sm:rounded-xl ${isLightMode ? 'bg-gray-50' : 'bg-gray-800'}`}>
                    <span className="text-2xl sm:text-3xl md:text-4xl flex-shrink-0">üèÜ</span>
                    <p className={`flex-1 text-xs sm:text-sm md:text-base ${isLightMode ? 'text-gray-800' : 'text-white'}`}>
                      Encuentra a todos los impostores para ganar
                    </p>
                  </div>
                </div>

                {/* Condiciones de victoria */}
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                  {/* Jugador */}
                  <div className={`p-3 sm:p-4 md:p-5 rounded-lg sm:rounded-xl border-2 ${isLightMode ? 'bg-yellow-50 border-yellow-400' : 'bg-gray-800 border-yellow-500'}`}>
                    <h3 className={`text-base sm:text-lg md:text-xl font-bold mb-1 sm:mb-2 ${isLightMode ? 'text-yellow-700' : 'text-yellow-400'}`}>
                      ‚úì JUGADOR
                    </h3>
                    <p className={`text-xs sm:text-sm md:text-base ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                      Los jugadores ganan si eliminan a todos los impostores
                    </p>
                  </div>

                  {/* Impostor */}
                  <div className={`p-3 sm:p-4 md:p-5 rounded-lg sm:rounded-xl border-2 ${isLightMode ? 'bg-red-50 border-red-400' : 'bg-gray-800 border-red-500'}`}>
                    <h3 className={`text-base sm:text-lg md:text-xl font-bold mb-1 sm:mb-2 ${isLightMode ? 'text-red-700' : 'text-red-400'}`}>
                      ‚úó IMPOSTOR
                    </h3>
                    <p className={`text-xs sm:text-sm md:text-base ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                      Los impostores ganan si igualan o superan a los jugadores
                    </p>
                  </div>
                </div>

                <div className="mt-4 sm:mt-6 flex justify-end">
                  <button
                    onClick={() => setShowHowToPlayModal(false)}
                    className={`px-4 sm:px-6 py-2 sm:py-3 rounded-lg sm:rounded-xl font-semibold transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 text-sm sm:text-base ${
                      isLightMode 
                        ? 'bg-gray-200 hover:bg-gray-300 text-gray-800' 
                        : 'bg-gray-700 hover:bg-gray-600 text-white'
                    }`}
                  >
                    Entendido
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
        </>
      );
    }

    // Flag para prevenir m√∫ltiples inicializaciones
    let appInitialized = false;
    let retryCount = 0;
    const MAX_RETRIES = 3; // Solo 3 reintentos

    // Verificar que todas las dependencias est√©n cargadas (SIMPLIFICADO)
    function checkDependencies() {
      return typeof React !== 'undefined' && 
             typeof ReactDOM !== 'undefined' && 
             (typeof ReactDOM.createRoot !== 'undefined' || typeof ReactDOM.render !== 'undefined');
    }

    // Mostrar mensaje de error
    function showError(message, details = '') {
      console.error('Showing error:', message, details);
      const rootEl = document.getElementById('root');
      if (rootEl) {
        // Forzar eliminar pantalla de carga primero
        const loadingScreen = document.getElementById('loading-screen');
        if (loadingScreen) {
          loadingScreen.style.display = 'none';
        }
        document.body.classList.remove('loading');
        document.documentElement.classList.remove('loading');
        
        // Mostrar error con fondo visible
        rootEl.innerHTML = `
          <div style="padding: 20px; text-align: center; color: white; background: #1a1a1a; min-height: 100vh; display: flex; align-items: center; justify-content: center; flex-direction: column; position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 999999;">
            <h1 style="color: #9333ea; margin-bottom: 20px; font-size: 24px;">‚ö†Ô∏è Error de Carga</h1>
            <p style="margin-bottom: 10px; font-size: 16px; max-width: 500px;">${message}</p>
            ${details ? `<p style="margin-bottom: 20px; font-size: 14px; color: #999; max-width: 500px;">${details}</p>` : ''}
            <button onclick="location.reload()" style="padding: 12px 24px; background: #9333ea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; margin-top: 10px; font-weight: bold;">
              üîÑ Recargar P√°gina
            </button>
            <p style="margin-top: 20px; font-size: 12px; color: #666;">Si el problema persiste, verifica tu conexi√≥n a internet</p>
          </div>
        `;
      }
    }

    // Actualizar indicador de carga (ya no se usa, pero se mantiene por compatibilidad)
    function updateLoadingMessage(message) {
      // Ya no actualizamos el mensaje, solo mantenemos la animaci√≥n
      console.log('Cargando:', message);
    }

    // Esperar a que los scripts se carguen e inicializar la app (SIMPLIFICADO)
    function initApp() {
      console.log('üîß initApp llamado, appInitialized:', appInitialized, 'retryCount:', retryCount);
      if (appInitialized) {
        console.log('‚ö†Ô∏è App ya inicializada, saliendo');
        return;
      }

      // Verificar dependencias
      const depsReady = checkDependencies();
      console.log('üì¶ Dependencias:', {
        React: typeof React !== 'undefined',
        ReactDOM: typeof ReactDOM !== 'undefined',
        createRoot: typeof ReactDOM?.createRoot !== 'undefined',
        render: typeof ReactDOM?.render !== 'undefined',
        ready: depsReady
      });
      
      if (!depsReady) {
        retryCount++;
        console.log('‚è≥ Reintentando cargar dependencias... intento', retryCount, 'de', MAX_RETRIES);
        if (retryCount > MAX_RETRIES) {
          console.error('‚ùå No se pudieron cargar las dependencias despu√©s de', MAX_RETRIES, 'intentos');
          showError('Error al cargar recursos', 'Las librer√≠as necesarias no se pudieron cargar. Por favor, verifica tu conexi√≥n a internet y recarga la p√°gina.');
          return;
        }
        setTimeout(initApp, 800);
        return;
      }

      try {
        const rootElement = document.getElementById('root');
        if (!rootElement) {
          console.error('‚ùå Root element no encontrado');
          throw new Error('Root element not found');
        }

        console.log('‚úÖ Inicializando app con React...');

        // Ocultar pantalla de carga
        const loadingScreen = document.getElementById('loading-screen');
        if (loadingScreen) {
          console.log('üåü Ocultando pantalla de carga...');
          setTimeout(() => {
            loadingScreen.classList.add('hidden');
            document.documentElement.classList.remove('loading');
            document.body.classList.remove('loading');
            setTimeout(() => {
              loadingScreen.style.display = 'none';
              console.log('‚úÖ Pantalla de carga oculta');
            }, 300);
          }, 100);
        }

        // Renderizar app
        console.log('üé® Renderizando componente ImpostorGame...');
        if (typeof ReactDOM.createRoot !== 'undefined') {
          console.log('üì± Usando ReactDOM.createRoot (React 18+)');
          const root = ReactDOM.createRoot(rootElement);
          root.render(<ImpostorGame />);
        } else {
          console.log('üì± Usando ReactDOM.render (React 17)');
          ReactDOM.render(<ImpostorGame />, rootElement);
        }
        appInitialized = true;
        console.log('‚úÖ App inicializada correctamente!');
      } catch (error) {
        console.error('‚ùå Error al inicializar:', error);
        console.error('Stack trace:', error.stack);
        showError('Error al inicializar la aplicaci√≥n', 'Detalles t√©cnicos: ' + error.message);
      }
    }

    // Estrategia de inicializaci√≥n SIMPLIFICADA
    function startInitialization() {
      console.log('üöÄ Iniciando app...');
      console.log('üåê User Agent:', navigator.userAgent);
      console.log('üíª Navegador:', {
        isChrome: /Chrome/.test(navigator.userAgent),
        isFirefox: /Firefox/.test(navigator.userAgent),
        isSafari: /Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent),
        isEdge: /Edge/.test(navigator.userAgent)
      });
      
      // FAILSAFE: Forzar ocultar pantalla despu√©s de 3 segundos
      setTimeout(() => {
        const loadingScreen = document.getElementById('loading-screen');
        if (loadingScreen && !loadingScreen.classList.contains('hidden')) {
          console.warn('‚ö†Ô∏è Timeout: forzando ocultar pantalla');
          loadingScreen.classList.add('hidden');
          document.documentElement.classList.remove('loading');
          document.body.classList.remove('loading');
          setTimeout(() => loadingScreen.style.display = 'none', 300);
        }
      }, 3000);
      
      // Inicializar cuando el DOM est√© listo
      if (document.readyState !== 'loading') {
        console.log('üìù DOM ya cargado, inicializando...');
        setTimeout(initApp, 50);
      } else {
        console.log('‚è≥ Esperando DOMContentLoaded...');
        document.addEventListener('DOMContentLoaded', () => {
          console.log('‚úÖ DOMContentLoaded disparado');
          setTimeout(initApp, 50);
        });
      }
    }

    // Iniciar el proceso
    startInitialization();

    // Service Worker - Registrar INMEDIATAMENTE (no esperar a 'load')
    if ('serviceWorker' in navigator) {
      // Registrar tan pronto como sea posible
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', registerSW);
      } else {
        registerSW();
      }
      
      function registerSW() {
        // Primero, limpiar cualquier service worker antiguo y cach√©s
        console.log('üßπ Limpiando service workers y cach√©s antiguos...');
        navigator.serviceWorker.getRegistrations().then(function(registrations) {
          for(let registration of registrations) {
            const scriptURL = registration.active?.scriptURL || '';
            console.log('üóëÔ∏è Desregistrando SW:', scriptURL);
            registration.unregister();
          }
        }).then(() => {
          console.log('üßπ Limpiando todos los cach√©s...');
          return caches.keys().then(function(cacheNames) {
            return Promise.all(
              cacheNames.map(function(cacheName) {
                console.log('üóëÔ∏è Eliminando cach√©:', cacheName);
                return caches.delete(cacheName);
              })
            );
          });
        }).then(() => {
          console.log('‚úÖ Cach√©s limpiados, registrando nuevo SW...');
          return navigator.serviceWorker.register('./sw.js', { scope: './' });
        }).then((registration) => {
            console.log('‚úÖ SW registered successfully:', registration.scope);
            
            // Verificar estado del service worker
            if (registration.installing) {
              console.log('‚è≥ Service Worker installing...');
              registration.installing.addEventListener('statechange', function() {
                console.log('üîÑ SW state changed to:', this.state);
                if (this.state === 'activated') {
                  console.log('‚úÖ Service Worker activated!');
                }
              });
            } else if (registration.waiting) {
              console.log('‚è≥ Service Worker waiting...');
            } else if (registration.active) {
              console.log('‚úÖ Service Worker active!');
            }
            
            // Forzar actualizaci√≥n inmediata y peri√≥dicamente
            registration.update();
            
            // Actualizar cada 30 segundos cuando la app est√° activa
            setInterval(() => {
              registration.update();
            }, 30000);
            
            // Escuchar actualizaciones
            registration.addEventListener('updatefound', () => {
              console.log('üîÑ Service Worker update found');
              const newWorker = registration.installing;
              if (newWorker) {
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    console.log('‚úÖ Nueva versi√≥n del Service Worker instalada');
                    // Notificar al usuario si est√° en modo standalone
                    const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
                    if (isStandalone) {
                      // En modo standalone, forzar actualizaci√≥n autom√°ticamente despu√©s de un delay
                      setTimeout(() => {
                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                        window.location.reload(true);
                      }, 2000);
                    }
                  }
                });
              }
            });
          })
          .catch((registrationError) => {
            console.error('‚ùå SW registration failed:', registrationError);
          });
      }
      
      // Tambi√©n verificar en load
      window.addEventListener('load', () => {
        navigator.serviceWorker.getRegistrations().then((registrations) => {
          console.log('üìã Existing SW registrations:', registrations.length);
          if (registrations.length === 0) {
            console.warn('‚ö†Ô∏è No service workers found, trying to register...');
            registerSW();
          } else {
            registrations.forEach((registration) => {
              if (registration.active) {
                console.log('‚úÖ Active SW:', registration.active.scriptURL);
              } else {
                console.log('‚è≥ SW not active yet');
              }
            });
          }
        });
      });
    } else {
      console.warn('‚ö†Ô∏è Service Workers not supported in this browser');
    }
  </script>
</body>
</html>
</html>
